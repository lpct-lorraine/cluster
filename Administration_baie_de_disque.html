<html>
<head><title>Administration baie de disque</title></head>
<body>
<h1>Administration baie de disque</h1><h1><span class="mw-headline" id="Extension_d.27un_LUN">Extension d'un LUN</span></h1>
<ul><li> Ajout espace sur la baie</li>
<li> Scan des devices sur le serveur</li></ul>
<pre>
# multipath -l
mpathc (3600a0980009b087a0000058d5d8104c3) dm-21 DELL    ,MD34xx          
size=5.0T features='3 queue_if_no_path pg_init_retries 50' hwhandler='1 rdac' wp=rw
|-+- policy='round-robin 0' prio=0 status=active
| `- 1:0:0:2  sdg 8:96  active undef unknown
`-+- policy='round-robin 0' prio=0 status=enabled
  `- 1:0:1:2  sdh 8:112 active undef unknown
mpathb (3600a0980009b087a000002fa57cb5c1c) dm-3 DELL    ,MD34xx          
size=15T features='3 queue_if_no_path pg_init_retries 50' hwhandler='1 rdac' wp=rw
|-+- policy='round-robin 0' prio=0 status=active
| `- 1:0:0:1  sdb 8:16  active undef unknown
`-+- policy='round-robin 0' prio=0 status=enabled
  `- 1:0:1:1  sdd 8:48  active undef unknown
mpatha (3600a0980009afa10000002ab56e8f065) dm-2 DELL    ,MD34xx          
size=64T features='3 queue_if_no_path pg_init_retries 50' hwhandler='1 rdac' wp=rw
|-+- policy='round-robin 0' prio=0 status=active
| `- 1:0:1:0  sdc 8:32  active undef unknown
`-+- policy='round-robin 0' prio=0 status=enabled
  `- 1:0:0:0  sda 8:0   active undef unknown
</pre>
<pre>echo 1 &gt;/sys/block/sdg/device/rescan
echo 1 &gt;/sys/block/sdh/device/rescan 
multipathd -k'resize map mpathc'
</pre>
<pre>
multipath -ll mpathc
mpathc (3600a0980009b087a0000058d5d8104c3) dm-21 DELL    ,MD34xx          
size=22T features='3 queue_if_no_path pg_init_retries 50' hwhandler='1 rdac' wp=rw
|-+- policy='round-robin 0' prio=14 status=active
| `- 1:0:0:2  sdg 8:96  active ready running
`-+- policy='round-robin 0' prio=9 status=enabled
  `- 1:0:1:2  sdh 8:112 active ready running
</pre>
<p><br />
</p>
<ul><li> Extension du PV</li></ul>
<pre> $ pvresize /dev/mapper/mpathc
 Physical volume "/dev/mapper/mpathc" changed
 1 physical volume(s) resized / 0 physical volume(s) not resized
</pre>
<ul><li> Extension  du VG automatique suite à l'extension du PV</li></ul>
<pre> $ vgs
 VG           #PV #LV #SN Attr   VSize   VFree  
 DATA2          1   1   0 wz--n-  15.00t      0 
 vg_md3400a     2  10   0 wz--n-  85.95t  19.00t
 vg_moselle01   1   8   0 wz--n- 276.34g 160.24g
</pre>
<ul><li> Extesnion du lv tms6</li></ul>
<pre> $ lvextend -L+5T /dev/vg_md3400a/tms6
 Size of logical volume vg_md3400a/tms6 changed from 11.00 TiB (2883584 extents) to 16.00 TiB (4194304 extents).
 Logical volume vg_md3400a/tms6 successfully resized.
</pre>
<pre> $ xfs_growfs /dev/mapper/vg_md3400a-tms6
</pre>
<pre> Avant
 /dev/mapper/vg_md3400a-tms6      xfs        11T   10T  1.1T  91% /data/tms6
</pre>
<pre> Apres
 /dev/mapper/vg_md3400a-tms6      xfs        16T   10T  6.1T  63% /data/tms6
</pre>
<h1><span class="mw-headline" id="Removing_multipath_device_.E2.80.93_map_in_use">Removing multipath device – map in use</span></h1>
<p>December 5, 2016 sysadmin Linux	
</p><p>I got in trouble when I tried to remove a multipath device from my servers. This device is on top on some lvm volumes that I am not using it any longer. I tried to remove with multipath -f, but it was not possible, it said that the map was in use:
</p>
<pre>   ~# multipath -f /dev/mapper/2554b454e79496758
   Dec 05 12:22:31 | 2554b454e79496758: map in use
   Dec 05 12:22:31 | failed to remove multipath map 2554b454e79496758
</pre>
<p>You can view how many processes are using this map with the dmsetup tool, see the open count field:
</p>
<pre>   ~# dmsetup info  /dev/mapper/2554b454e79496758
   Name:              2554b454e79496758
   State:             ACTIVE
   Read Ahead:        256
   Tables present:    LIVE
   Open count:        4
   Event number:      1086846
   Major, minor:      251, 4
   Number of targets: 1
   UUID: mpath-2554b454e79496758
</pre>
<p>First remove any LVM active devices on this device, ex: if you have a volume group “vggroup” and a lvm “vol1” on this device remove them:
</p>
<pre>   ~# lvremove /dev/vggroup/vol1
   ~# vgremove vggroup
   ~# pvremove /dev/mapper/2554b454e79496758
</pre>
<p>and if the device file is still mapped under /dev remove it:
</p>
<pre>   ~# dmsetup remove /dev/vggroup/*
</pre>
<p>At this point there shouldn’t be any processes accessing this device and we should be able to remove it with the command above, but it some cases there are still processes blocked waiting for the device. We can try to find out which processes are with lsoft command filtering by device mayor and minor number:
</p>
<pre>   ~# lsof | grep "251,4"
</pre>
<p>In my case there was some vgs processes blocked trying to access the device. We cannot kill these processes, because they are already waiting for a signal from the kernel.
</p>
<pre>   ~# ps aux | grep sbin/vgs
   root     1206972  0.0  0.0  32444  4288&#160;?        D    dic02   0:00 /sbin/vgs --separator&#160;: --noheadings --units b --unbuffered --nosuffix --options vg_name,vg_size,vg_free
   root     1213321  0.0  0.0  32444  4308&#160;?        D    dic02   0:00 /sbin/vgs --separator&#160;: --noheadings --units b --unbuffered --nosuffix --options vg_name,vg_size,vg_free
   root     1248170  0.0  0.0  32444  4196&#160;?        D    dic02   0:00 /sbin/vgs --separator&#160;: --noheadings --units b --unbuffered --nosuffix --options vg_name,vg_size,vg_free
   root     2542017  0.0  0.0  32444  4252&#160;?        D    10:46   0:00 /sbin/vgs --separator&#160;: --noheadings --units b --unbuffered --nosuffix --options vg_name,vg_size,vg_free
</pre>
<p>We can try to suspend the multipath device to force timeout to the processes:
</p>
<pre>   ~# dmsetup suspend /dev/mapper/2554b454e79496758
   ~# dmsetup info /dev/mapper/2554b454e79496758
   Name:              2554b454e79496758
   State:             SUSPENDED
   Read Ahead:        256
   Tables present:    LIVE
   Open count:        4
   Event number:      1086846
   Major, minor:      251, 4
   Number of targets: 1
   UUID: mpath-2554b454e79496758
</pre>
<p>And try to clear the device table:
</p>
<pre>   ~# dmsetup clear  /dev/mapper/2554b454e79496758
   ~# dmsetup wipe_table  /dev/mapper/2554b454e79496758
</pre>
<p>We are lucky and finally the device is not in use any longer:
</p>
<pre>   ~# dmsetup info  /dev/mapper/2554b454e79496758
   Name:              2554b454e79496758
   State:             ACTIVE
   Read Ahead:        256
   Tables present:    LIVE
   Open count:        0
   Event number:      1086846
   Major, minor:      251, 7
   Number of targets: 1
   UUID: mpath-2554b454e79496758
</pre>
<p>Now, we can remove it without problems:
</p>
<pre>   ~# mutipath -f  /dev/mapper/2554b454e79496758
</pre>
<p>To avoid multipath rediscover the device again we can blacklist it. Remove device from already discovered devices:
</p>
<pre>   ~# sed -i '/2554b454e79496758/d' /etc/multipath/wwids
</pre>
<p>In the multipath configuration file add an entry in the blacklist section withe the wwid of the deivce, if the file does not exist create it:
/etc/multipath.conf
</p>
<pre>   blacklist {
      wwid 2554b454e79496758
   }
</pre>
<p>And finally reload multipath:
</p>
<pre>   ~# systemctl reload multipath-tools
</pre>
<pre>
cat /etc/multipath.conf
...

cat /etc/multipath/bindings
# Format:
#alias   wwid
mpatha 36842b2b038b36a0013e2bd200b6a5544
mpathb 36842b2b00018fc49000002f03c6b2d04


dmesg |less
...
mpt2sas0: diag reset: SUCCESS
mpt2sas0: Allocated physical memory: size(8639 kB)
mpt2sas0: Current Controller Queue Depth(3836), Max Controller Queue Depth(3999)
mpt2sas0: Scatter Gather Elements per IO(128)
mpt2sas0: log_info(0x30030100): originator(IOP), code(0x03), sub_code(0x0100)
mpt2sas0: log_info(0x30030100): originator(IOP), code(0x03), sub_code(0x0100)
mpt2sas0: LSISAS2008: FWVersion(02.15.63.00), ChipRevision(0x02), BiosVersion(07.01.09.00)
mpt2sas0: Dell 6Gbps SAS HBA: Vendor(0x1000), Device(0x0072), SSVID(0x1028), SSDID(0x1F1C)
mpt2sas0: Protocol=(Initiator,Target), Capabilities=(Raid,TLR,EEDP,Snapshot Buffer,Diag Trace Buffer,Task Set Full,NCQ)
scsi0&#160;: Fusion MPT SAS Host
mpt2sas0: sending port enable&#160;!!
mpt2sas0: host_add: handle(0x0001), sas_addr(0x5a4badb03be78200), phys(8)
mpt2sas0: port enable: SUCCESS
scsi 0:0:0:0: Direct-Access     DELL     MD32xx           0784 PQ: 1 ANSI: 5
scsi 0:0:0:0: SSP: handle(0x0009), sas_addr(0x5842b2b418fc4610), phy(0), device_name(0xb4b242581046fc18)
scsi 0:0:0:0: SSP: enclosure_logical_id(0x5a4badb03be78200), slot(7)
scsi 0:0:0:0: qdepth(254), tagged(1), simple(1), ordered(0), scsi_level(6), cmd_que(1)
scsi 0:0:0:1: Direct-Access     DELL     MD32xx           0784 PQ: 0 ANSI: 5
scsi 0:0:0:1: SSP: handle(0x0009), sas_addr(0x5842b2b418fc4610), phy(0), device_name(0xb4b242581046fc18)
scsi 0:0:0:1: SSP: enclosure_logical_id(0x5a4badb03be78200), slot(7)
scsi 0:0:0:1: qdepth(254), tagged(1), simple(1), ordered(0), scsi_level(6), cmd_que(1)
scsi 0:0:0:31: Direct-Access     DELL     Universal Xport  0784 PQ: 0 ANSI: 5
scsi 0:0:0:31: SSP: handle(0x0009), sas_addr(0x5842b2b418fc4610), phy(0), device_name(0xb4b242581046fc18)
scsi 0:0:0:31: SSP: enclosure_logical_id(0x5a4badb03be78200), slot(7)
scsi 0:0:0:31: qdepth(254), tagged(1), simple(1), ordered(0), scsi_level(6), cmd_que(1)
scsi 0:0:1:0: Direct-Access     DELL     MD32xx           0784 PQ: 1 ANSI: 5
scsi 0:0:1:0: SSP: handle(0x000a), sas_addr(0x5842b2b418fc4910), phy(4), device_name(0xb4b242581049fc18)
scsi 0:0:1:0: SSP: enclosure_logical_id(0x5a4badb03be78200), slot(3)
scsi 0:0:1:0: qdepth(254), tagged(1), simple(1), ordered(0), scsi_level(6), cmd_que(1)
scsi 0:0:1:1: Direct-Access     DELL     MD32xx           0784 PQ: 0 ANSI: 5
scsi 0:0:1:1: SSP: handle(0x000a), sas_addr(0x5842b2b418fc4910), phy(4), device_name(0xb4b242581049fc18)
scsi 0:0:1:1: SSP: enclosure_logical_id(0x5a4badb03be78200), slot(3)
scsi 0:0:1:1: qdepth(254), tagged(1), simple(1), ordered(0), scsi_level(6), cmd_que(1)
scsi 0:0:1:31: Direct-Access     DELL     Universal Xport  0784 PQ: 0 ANSI: 5
scsi 0:0:1:31: SSP: handle(0x000a), sas_addr(0x5842b2b418fc4910), phy(4), device_name(0xb4b242581049fc18)
scsi 0:0:1:31: SSP: enclosure_logical_id(0x5a4badb03be78200), slot(3)
scsi 0:0:1:31: qdepth(254), tagged(1), simple(1), ordered(0), scsi_level(6), cmd_que(1)
scsi 0:0:0:0: Attached scsi generic sg0 type 0
sd 0:0:0:1: Attached scsi generic sg1 type 0
scsi 0:0:0:31: Attached scsi generic sg2 type 0
scsi 0:0:1:0: Attached scsi generic sg3 type 0
sd 0:0:1:1: Attached scsi generic sg4 type 0
sd 0:0:0:1: Mode parameters changed
scsi 0:0:1:31: Attached scsi generic sg5 type 0
sd 0:0:1:1: [sdb] 35153823744 512-byte logical blocks: (17.9 TB/16.3 TiB)
sd 0:0:0:1: [sda] 35153823744 512-byte logical blocks: (17.9 TB/16.3 TiB)
sd 0:0:1:1: [sdb] Write Protect is off
sd 0:0:1:1: [sdb] Mode Sense: 83 00 10 08
sd 0:0:0:1: [sda] Write Protect is off
sd 0:0:0:1: [sda] Mode Sense: 83 00 10 08
sd 0:0:1:1: [sdb] Write cache: enabled, read cache: enabled, supports DPO and FUA
sd 0:0:0:1: [sda] Write cache: enabled, read cache: enabled, supports DPO and FUA
 sdb:
 sda: sdb1 sdb2
sd 0:0:1:1: [sdb] Attached SCSI disk
 sda1 sda2
sd 0:0:0:1: [sda] Attached SCSI disk
megasas: 06.806.08.00-rh3 Thu. Sep. 4 17:00:00 PDT 2014
megasas: 0x1000:0x0079:0x1028:0x1f17: bus 3:slot 0:func 0
megaraid_sas 0000:03:00.0: PCI INT A -&gt; GSI 16 (level, low) -&gt; IRQ 16
megaraid_sas 0000:03:00.0: setting latency timer to 64
megasas: FW now in Ready state
  alloc irq_desc for 62 on node -1
  alloc kstat_irqs on node -1
megaraid_sas 0000:03:00.0: irq 62 for MSI/MSI-X
megaraid_sas 0000:03:00.0: [scsi1]: FW supports&lt;0&gt; MSIX vector,Online CPUs: &lt;16&gt;,Current MSIX &lt;1&gt;
megasas_init_mfi: fw_support_ieee=67108864
megasas: INIT adapter done
megaraid_sas 0000:03:00.0: Controller type: MR,Memory size is: 512MB
scsi1&#160;: LSI SAS based MegaRAID driver
scsi 1:2:0:0: Direct-Access     DELL     PERC H700        2.30 PQ: 0 ANSI: 5
sd 1:2:0:0: Attached scsi generic sg6 type 0
sd 1:2:0:0: [sdc] 285474816 512-byte logical blocks: (146 GB/136 GiB)
sd 1:2:0:0: [sdc] Write Protect is off
sd 1:2:0:0: [sdc] Mode Sense: 1f 00 00 08
sd 1:2:0:0: [sdc] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
 sdc: sdc1 sdc2
sd 1:2:0:0: [sdc] Attached SCSI disk
...



root@lisboa log]# df -h
Filesystem            Size   Mounted on
/dev/mapper/mpathap1   43G   /
/dev/mapper/mpathap2   94G   /home
/dev/mapper/mpathbp1  8.1T   /store
/dev/mapper/mpathbp2  8.1T   /backup


[fpascale@lisboa ~]$ mount
/dev/mapper/mpathap1 on / type ext4 (rw)
/dev/mapper/mpathap2 on /home type reiserfs (rw)
/dev/mapper/mpathbp1 on /store type ext4 (rw)
/dev/mapper/mpathbp2 on /backup type ext4 (rw)


[root@lisboa log]# dmsetup  ls --tree
mpathap1 (253:4)
 └─mpatha (253:3)
    └─ (8:32)
mpathap2 (253:5)
 └─mpatha (253:3)
    └─ (8:32)
mpathbp1 (253:1)
 └─mpathb (253:0)
    ├─ (8:0)
    └─ (8:16)
mpathbp2 (253:2)
 └─mpathb (253:0)
    ├─ (8:0)
    └─ (8:16)

[fpascale@lisboa ~]$ ls -l /dev/block/
total 0
lrwxrwxrwx 1 root root 7 Oct 14 11:17 253:0 -&gt; ../dm-0
lrwxrwxrwx 1 root root 7 Oct 14 11:17 253:1 -&gt; ../dm-1
lrwxrwxrwx 1 root root 7 Oct 14 11:17 253:2 -&gt; ../dm-2
lrwxrwxrwx 1 root root 7 Oct 14 11:17 253:3 -&gt; ../dm-3
lrwxrwxrwx 1 root root 7 Oct 14 11:17 253:4 -&gt; ../dm-4
lrwxrwxrwx 1 root root 7 Oct 14 11:17 253:5 -&gt; ../dm-5
lrwxrwxrwx 1 root root 6 Oct 14 11:16 8:0 -&gt; ../sda
lrwxrwxrwx 1 root root 7 Oct 14 11:16 8:1 -&gt; ../sda1
lrwxrwxrwx 1 root root 6 Oct 14 11:16 8:16 -&gt; ../sdb
lrwxrwxrwx 1 root root 7 Oct 14 11:16 8:17 -&gt; ../sdb1
lrwxrwxrwx 1 root root 7 Oct 14 11:16 8:18 -&gt; ../sdb2
lrwxrwxrwx 1 root root 7 Oct 14 11:16 8:2 -&gt; ../sda2
lrwxrwxrwx 1 root root 6 Oct 14 11:16 8:32 -&gt; ../sdc
lrwxrwxrwx 1 root root 7 Oct 14 11:16 8:33 -&gt; ../sdc1
lrwxrwxrwx 1 root root 7 Oct 14 11:16 8:34 -&gt; ../sdc2


[root@lisboa log]# ls -l /dev/mapper/
total 0
crw-rw---- 1 root root 10, 58 Jul 22 21:14 control
lrwxrwxrwx 1 root root      7 Jul 22 21:15 mpatha -&gt; ../dm-3
lrwxrwxrwx 1 root root      7 Jul 22 21:15 mpathap1 -&gt; ../dm-4
lrwxrwxrwx 1 root root      7 Jul 22 21:15 mpathap2 -&gt; ../dm-5
lrwxrwxrwx 1 root root      7 Jul 22 21:15 mpathb -&gt; ../dm-0
lrwxrwxrwx 1 root root      7 Jul 22 21:15 mpathbp1 -&gt; ../dm-1
lrwxrwxrwx 1 root root      7 Jul 22 21:15 mpathbp2 -&gt; ../dm-2

[root@lisboa log]# ls -l /dev/disk/by-id/
total 0
lrwxrwxrwx 1 root root 10 Jul 22 21:15 dm-name-mpatha -&gt; ../../dm-3
lrwxrwxrwx 1 root root 10 Jul 22 21:15 dm-name-mpathap1 -&gt; ../../dm-4
lrwxrwxrwx 1 root root 10 Jul 22 21:15 dm-name-mpathap2 -&gt; ../../dm-5
lrwxrwxrwx 1 root root 10 Jul 22 21:15 dm-name-mpathb -&gt; ../../dm-0
lrwxrwxrwx 1 root root 10 Jul 22 21:15 dm-name-mpathbp1 -&gt; ../../dm-1
lrwxrwxrwx 1 root root 10 Jul 22 21:15 dm-name-mpathbp2 -&gt; ../../dm-2
lrwxrwxrwx 1 root root 10 Jul 22 21:15 dm-uuid-mpath-36842b2b00018fc49000002f03c6b2d04 -&gt; ../../dm-0
lrwxrwxrwx 1 root root 10 Jul 22 21:15 dm-uuid-mpath-36842b2b038b36a0013e2bd200b6a5544 -&gt; ../../dm-3
lrwxrwxrwx 1 root root 10 Jul 22 21:15 dm-uuid-part1-mpath-36842b2b00018fc49000002f03c6b2d04 -&gt; ../../dm-1
lrwxrwxrwx 1 root root 10 Jul 22 21:15 dm-uuid-part1-mpath-36842b2b038b36a0013e2bd200b6a5544 -&gt; ../../dm-4
lrwxrwxrwx 1 root root 10 Jul 22 21:15 dm-uuid-part2-mpath-36842b2b00018fc49000002f03c6b2d04 -&gt; ../../dm-2
lrwxrwxrwx 1 root root 10 Jul 22 21:15 dm-uuid-part2-mpath-36842b2b038b36a0013e2bd200b6a5544 -&gt; ../../dm-5

[root@lisboa log]# parted /dev/mapper/mpatha print
Model: Linux device-mapper (multipath) (dm)
Disk /dev/mapper/mpatha: 146GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  46.2GB  46.2GB  primary  ext4         boot
 2      46.2GB  146GB   100GB   primary  reiserfs

[root@lisboa log]# parted /dev/mapper/mpathb print
Model: Linux device-mapper (multipath) (dm)
Disk /dev/mapper/mpathb: 18.0TB
Sector size (logical/physical): 512B/512B
Partition Table: gpt

Number  Start   End     Size    File system  Name     Flags
 1      17.4kB  8999GB  8999GB  ext4         primary
 2      8999GB  18.0TB  8999GB  ext4         primary

[root@lisboa log]# cat /etc/fstab 

#
# /etc/fstab
# Created by anaconda on Tue Apr 24 16:24:34 2012
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
UUID=8d821dea-5729-4fa2-85b2-8fcfd11ded40 /                       ext4    defaults        1 1
UUID=f0496527-b78d-475f-8b6b-8f409e1e231b /home                   reiserfs defaults       1 2
UUID=39df7c4e-a0c3-4c2d-b314-cf26dab821f4 /store                  ext4           defaults 1 2
UUID=167c66d0-f00e-42db-b60c-c02a9f262a74 /backup                 ext4           defaults 1 2


[fpascale@lisboa ~]$ ls -l /sys/class/scsi_disk/
total 0
lrwxrwxrwx 1 root root 0 Oct 29 15:49 0:0:0:1 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:0/end_device-0:0/target0:0:0/0:0:0:1/scsi_disk/0:0:0:1
lrwxrwxrwx 1 root root 0 Oct 29 15:49 0:0:1:1 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:1/end_device-0:1/target0:0:1/0:0:1:1/scsi_disk/0:0:1:1
lrwxrwxrwx 1 root root 0 Oct 29 15:49 1:2:0:0 -&gt; ../../devices/pci0000:00/0000:00:1c.0/0000:03:00.0/host1/target1:2:0/1:2:0:0/scsi_disk/1:2:0:0


[fpascale@lisboa ~]$ ls -l /sys/class/scsi_generic/
total 0
lrwxrwxrwx 1 root root 0 Oct 29 15:50 sg0 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:0/end_device-0:0/target0:0:0/0:0:0:0/scsi_generic/sg0
lrwxrwxrwx 1 root root 0 Oct 29 15:50 sg1 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:0/end_device-0:0/target0:0:0/0:0:0:1/scsi_generic/sg1
lrwxrwxrwx 1 root root 0 Oct 29 15:50 sg2 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:0/end_device-0:0/target0:0:0/0:0:0:31/scsi_generic/sg2
lrwxrwxrwx 1 root root 0 Oct 29 15:50 sg3 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:1/end_device-0:1/target0:0:1/0:0:1:0/scsi_generic/sg3
lrwxrwxrwx 1 root root 0 Oct 29 15:50 sg4 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:1/end_device-0:1/target0:0:1/0:0:1:1/scsi_generic/sg4
lrwxrwxrwx 1 root root 0 Oct 29 15:50 sg5 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:1/end_device-0:1/target0:0:1/0:0:1:31/scsi_generic/sg5
lrwxrwxrwx 1 root root 0 Oct 29 15:50 sg6 -&gt; ../../devices/pci0000:00/0000:00:1c.0/0000:03:00.0/host1/target1:2:0/1:2:0:0/scsi_generic/sg6
lrwxrwxrwx 1 root root 0 Oct 29 15:50 sg7 -&gt; ../../devices/pci0000:00/0000:00:1f.2/host2/target2:0:0/2:0:0:0/scsi_generic/sg7

[fpascale@lisboa ~]$ ls -l /sys/class/scsi_device/
total 0
lrwxrwxrwx 1 root root 0 Oct 29 15:48 0:0:0:0 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:0/end_device-0:0/target0:0:0/0:0:0:0/scsi_device/0:0:0:0
lrwxrwxrwx 1 root root 0 Oct 29 15:48 0:0:0:1 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:0/end_device-0:0/target0:0:0/0:0:0:1/scsi_device/0:0:0:1
lrwxrwxrwx 1 root root 0 Oct 29 15:48 0:0:0:31 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:0/end_device-0:0/target0:0:0/0:0:0:31/scsi_device/0:0:0:31
lrwxrwxrwx 1 root root 0 Oct 29 15:48 0:0:1:0 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:1/end_device-0:1/target0:0:1/0:0:1:0/scsi_device/0:0:1:0
lrwxrwxrwx 1 root root 0 Oct 29 15:48 0:0:1:1 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:1/end_device-0:1/target0:0:1/0:0:1:1/scsi_device/0:0:1:1
lrwxrwxrwx 1 root root 0 Oct 29 15:48 0:0:1:31 -&gt; ../../devices/pci0000:00/0000:00:07.0/0000:04:00.0/host0/port-0:1/end_device-0:1/target0:0:1/0:0:1:31/scsi_device/0:0:1:31
lrwxrwxrwx 1 root root 0 Oct 29 15:48 1:2:0:0 -&gt; ../../devices/pci0000:00/0000:00:1c.0/0000:03:00.0/host1/target1:2:0/1:2:0:0/scsi_device/1:2:0:0
lrwxrwxrwx 1 root root 0 Oct 29 15:48 2:0:0:0 -&gt; ../../devices/pci0000:00/0000:00:1f.2/host2/target2:0:0/2:0:0:0/scsi_device/2:0:0:0


[fpascale@lisboa ~]$ sudo multipath -ll
mpathb (36842b2b00018fc49000002f03c6b2d04) dm-0 DELL,MD32xx
size=16T features='3 queue_if_no_path pg_init_retries 50' hwhandler='1 rdac' wp=rw
|-+- policy='round-robin 0' prio=14 status=active
| `- 0:0:1:1 sdb 8:16 active ready running
`-+- policy='round-robin 0' prio=9 status=enabled
  `- 0:0:0:1 sda 8:0  active ready running
mpatha (36842b2b038b36a0013e2bd200b6a5544) dm-1 DELL,PERC H700
size=136G features='0' hwhandler='0' wp=rw
`-+- policy='round-robin 0' prio=1 status=active
  `- 1:2:0:0 sdc 8:32 active ready running


[fpascale@lisboa ~]$ sudo multipath -v3 -ll
Oct 29 16:04:16 | ram0: device node name blacklisted
Oct 29 16:04:16 | ram1: device node name blacklisted
Oct 29 16:04:16 | ram2: device node name blacklisted
Oct 29 16:04:16 | ram3: device node name blacklisted
Oct 29 16:04:16 | ram4: device node name blacklisted
Oct 29 16:04:16 | ram5: device node name blacklisted
Oct 29 16:04:16 | ram6: device node name blacklisted
Oct 29 16:04:16 | ram7: device node name blacklisted
Oct 29 16:04:16 | ram8: device node name blacklisted
Oct 29 16:04:16 | ram9: device node name blacklisted
Oct 29 16:04:16 | ram10: device node name blacklisted
Oct 29 16:04:16 | ram11: device node name blacklisted
Oct 29 16:04:16 | ram12: device node name blacklisted
Oct 29 16:04:16 | ram13: device node name blacklisted
Oct 29 16:04:16 | ram14: device node name blacklisted
Oct 29 16:04:16 | ram15: device node name blacklisted
Oct 29 16:04:16 | loop0: device node name blacklisted
Oct 29 16:04:16 | loop1: device node name blacklisted
Oct 29 16:04:16 | loop2: device node name blacklisted
Oct 29 16:04:16 | loop3: device node name blacklisted
Oct 29 16:04:16 | loop4: device node name blacklisted
Oct 29 16:04:16 | loop5: device node name blacklisted
Oct 29 16:04:16 | loop6: device node name blacklisted
Oct 29 16:04:16 | loop7: device node name blacklisted
Oct 29 16:04:16 | sdb: not found in pathvec
Oct 29 16:04:16 | sdb: mask = 0x25
Oct 29 16:04:16 | sdb: dev_t = 8:16
Oct 29 16:04:16 | sdb: size = 35153823744
Oct 29 16:04:16 | sdb: subsystem = scsi
Oct 29 16:04:16 | sdb: vendor = DELL
Oct 29 16:04:16 | sdb: product = MD32xx
Oct 29 16:04:16 | sdb: rev = 0784
Oct 29 16:04:16 | sdb: h:b:t:l = 0:0:1:1
Oct 29 16:04:16 | sdb: get_state
Oct 29 16:04:16 | loading /lib64/multipath/libcheckrdac.so checker
Oct 29 16:04:16 | sdb: path checker = rdac (controller setting)
Oct 29 16:04:16 | sdb: checker timeout = 30000 ms (sysfs setting)
Oct 29 16:04:16 | sdb: state = running
Oct 29 16:04:16 | sdb: state = 3
Oct 29 16:04:16 | sda: not found in pathvec
Oct 29 16:04:16 | sda: mask = 0x25
Oct 29 16:04:16 | sda: dev_t = 8:0
Oct 29 16:04:16 | sda: size = 35153823744
Oct 29 16:04:16 | sda: subsystem = scsi
Oct 29 16:04:16 | sda: vendor = DELL
Oct 29 16:04:16 | sda: product = MD32xx
Oct 29 16:04:16 | sda: rev = 0784
Oct 29 16:04:16 | sda: h:b:t:l = 0:0:0:1
Oct 29 16:04:16 | sda: get_state
Oct 29 16:04:16 | sda: path checker = rdac (controller setting)
Oct 29 16:04:16 | sda: checker timeout = 30000 ms (sysfs setting)
Oct 29 16:04:16 | sda: state = running
Oct 29 16:04:16 | sda: state = 3
Oct 29 16:04:16 | sdc: not found in pathvec
Oct 29 16:04:16 | sdc: mask = 0x25
Oct 29 16:04:16 | sdc: dev_t = 8:32
Oct 29 16:04:16 | sdc: size = 285474816
Oct 29 16:04:16 | sdc: subsystem = scsi
Oct 29 16:04:16 | sdc: vendor = DELL
Oct 29 16:04:16 | sdc: product = PERC H700
Oct 29 16:04:16 | sdc: rev = 2.30
Oct 29 16:04:16 | sdc: h:b:t:l = 1:2:0:0
Oct 29 16:04:16 | sdc: get_state
Oct 29 16:04:16 | sdc: path checker = directio (config file default)
Oct 29 16:04:16 | sdc: checker timeout = 90000 ms (sysfs setting)
Oct 29 16:04:16 | sdc: state = running
Oct 29 16:04:16 | directio: starting new request
Oct 29 16:04:16 | directio: io finished 4096/0
Oct 29 16:04:16 | sdc: state = 3
Oct 29 16:04:16 | dm-0: device node name blacklisted
Oct 29 16:04:16 | dm-1: device node name blacklisted
Oct 29 16:04:16 | sr0: device node name blacklisted
Oct 29 16:04:16 | dm-2: device node name blacklisted
Oct 29 16:04:16 | dm-3: device node name blacklisted
Oct 29 16:04:16 | dm-4: device node name blacklisted
Oct 29 16:04:16 | dm-5: device node name blacklisted
===== paths list =====
uuid hcil    dev dev_t pri dm_st chk_st vend/prod/rev  dev_st 
     0:0:1:1 sdb 8:16  -1  undef ready  DELL,MD32xx    running
     0:0:0:1 sda 8:0   -1  undef ready  DELL,MD32xx    running
     1:2:0:0 sdc 8:32  -1  undef ready  DELL,PERC H700 running
Oct 29 16:04:16 | params = 3 queue_if_no_path pg_init_retries 50 1 rdac 2 1 round-robin 0 1 1 8:16 1 round-robin 0 1 1 8:0 1 
Oct 29 16:04:16 | status = 2 0 1 0 2 1 A 0 1 0 8:16 A 0 E 0 1 0 8:0 A 0 
Oct 29 16:04:16 | sdb: mask = 0x8
Oct 29 16:04:16 | sdb: state = running
Oct 29 16:04:16 | sdb: detect_prio = 1 (config file default)
Oct 29 16:04:16 | loading /lib64/multipath/libpriordac.so prioritizer
Oct 29 16:04:16 | sdb: prio = rdac (controller setting)
Oct 29 16:04:16 | sdb: rdac prio = 14
Oct 29 16:04:16 | sda: mask = 0x8
Oct 29 16:04:16 | sda: state = running
Oct 29 16:04:16 | sda: detect_prio = 1 (config file default)
Oct 29 16:04:16 | sda: prio = rdac (controller setting)
Oct 29 16:04:16 | sda: rdac prio = 9
mpathb (36842b2b00018fc49000002f03c6b2d04) dm-0 DELL,MD32xx
size=16T features='3 queue_if_no_path pg_init_retries 50' hwhandler='1 rdac' wp=rw
|-+- policy='round-robin 0' prio=14 status=active
| `- 0:0:1:1 sdb 8:16 active ready running
`-+- policy='round-robin 0' prio=9 status=enabled
  `- 0:0:0:1 sda 8:0  active ready running
Oct 29 16:04:16 | params = 0 0 1 1 round-robin 0 1 1 8:32 1 
Oct 29 16:04:16 | status = 2 0 0 0 1 1 A 0 1 0 8:32 A 0 
Oct 29 16:04:16 | sdc: mask = 0x8
Oct 29 16:04:16 | sdc: state = running
Oct 29 16:04:16 | sdc: detect_prio = 1 (config file default)
Oct 29 16:04:16 | sdc: prio = const (config file default)
Oct 29 16:04:16 | sdc: const prio = 1
mpatha (36842b2b038b36a0013e2bd200b6a5544) dm-1 DELL,PERC H700
size=136G features='0' hwhandler='0' wp=rw
`-+- policy='round-robin 0' prio=1 status=active
  `- 1:2:0:0 sdc 8:32 active ready running

</pre>




</body></html>