<html>
<head><title>VASP</title></head>
<body>
<h1>VASP</h1><p><br />
VASP is available only for a defined group.
</p><p>See <a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://www.vasp.at/">https://www.vasp.at/</a>
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Licence"><span class="tocnumber">1</span> <span class="toctext">Licence</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Referent"><span class="tocnumber">2</span> <span class="toctext">Referent</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#versions_available"><span class="tocnumber">3</span> <span class="toctext">versions available</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#SLURM_script"><span class="tocnumber">4</span> <span class="toctext">SLURM script</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#cluster_LPCT"><span class="tocnumber">4.1</span> <span class="toctext">cluster LPCT</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#EXPLOR"><span class="tocnumber">4.2</span> <span class="toctext">EXPLOR</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Compilation_of_vasp_5.4.4"><span class="tocnumber">5</span> <span class="toctext">Compilation of vasp 5.4.4</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Compilation_of_vasp_6.1.2"><span class="tocnumber">6</span> <span class="toctext">Compilation of vasp 6.1.2</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Plugin_wannier90-1.2"><span class="tocnumber">7</span> <span class="toctext">Plugin wannier90-1.2</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#documentation"><span class="tocnumber">7.1</span> <span class="toctext">documentation</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Installation_avec_Lamejed_Debbichi."><span class="tocnumber">7.2</span> <span class="toctext">Installation avec Lamejed Debbichi.</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#test_vasp.2Fsio2-3_S.C3.A9bastien"><span class="tocnumber">8</span> <span class="toctext">test_vasp/sio2-3 Sébastien</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#vasp_std"><span class="tocnumber">8.1</span> <span class="toctext">vasp_std</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#vasp_gam"><span class="tocnumber">8.2</span> <span class="toctext">vasp_gam</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#vasp_std_:_test_des_nouveaux_noeuds_taras4_ou_taras3"><span class="tocnumber">8.3</span> <span class="toctext">vasp_std&#160;: test des nouveaux noeuds taras4 ou taras3</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#vasp_gam_:_test_des_nouveaux_noeuds_taras4_ou_taras3"><span class="tocnumber">8.4</span> <span class="toctext">vasp_gam&#160;: test des nouveaux noeuds taras4 ou taras3</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="#Documentation_2"><span class="tocnumber">9</span> <span class="toctext">Documentation</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#Troubleshooting_Omnipath"><span class="tocnumber">10</span> <span class="toctext">Troubleshooting Omnipath</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Licence">Licence</span></h1>
<pre>
private
Compilation from sources
</pre>
<h1><span class="mw-headline" id="Referent">Referent</span></h1>
<p>Sébastien Lebegue
</p>
<h1><span class="mw-headline" id="versions_available">versions available</span></h1>
<p>Version VAASP 5.4.4 avec Wannier90
</p><p>module load vasp/5.4.4
</p>
<h1><span class="mw-headline" id="SLURM_script">SLURM script</span></h1>
<pre>
In your submission directory. The files that you will need to run vasp are:
-rw-r--r-- 1 user    group      313 Aug 20 08:35 INCAR
-rw-r--r-- 1 user    group      271 Aug 20 08:35 KPOINTS
-rw-r--r-- 1 user    group      238 Aug 20 08:35 POSCAR
-rw-r--r-- 1 user    group     129K Aug 20 08:35 POTCAR
-rwxr-xr-x 1 user    group     1.7K Aug 20 08:35 runscript.bash
–
POTCAR:
pseudopotential file generated by concatenation of individual POTCAR files from the data-
base
–KPOINTS:
Brillouin zone sampling describes which k-points are used
–POSCAR: 
structural data basis vectors and positions
– INCAR:
steering the calculations
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="cluster_LPCT">cluster LPCT</span></h2>
<p>Exemple de script "submit_slurm.sh"&#160;:
</p>
<pre>
#!/bin/bash
#SBATCH --comment=vasp-test
#SBATCH --ntasks=64
#SBATCH --job-name=vasp-test
#SBATCH --output=output.%j.vasp-test
#SBATCH --error=error.%j.vasp-test
#SBATCH -p taras
#SBATCH -N 2

module purge
module load vasp/5.4.4

ulimit -s unlimited

export OMP_NUM_THREADS=1
export I_MPI_FABRICS=shm:tmi
export I_MPI_TMI_PROVIDER=psm2 


export ORIGDIR=${SLURM_SUBMIT_DIR}
export WORKDIR=/scratch/${USER}/tmp_${SLURM_JOB_ID}/

NODELIST=$(scontrol show hostnames $SLURM_JOB_NODELIST)
echo $NODELIST
for node in $NODELIST; do
  echo ssh $node mkdir -pv "$WORKDIR" 
  ssh $node mkdir -pv "$WORKDIR" 
done

for file in  POSCAR KPOINTS INCAR POTCAR&#160;;  do
  for node in $NODELIST; do
   ssh $node cp ${ORIGDIR}/$file $WORKDIR
  done
done

cd $WORKDIR

##### LANCEMENT de ton application ############
mpirun -genv I_MPI_DEBUG=5 -genv I_MPI_FABRICS shm:tmi -np 64  vasp_std 

# Récupération de tes fichiers de sortie en fin de calcul
mkdir -p $ORIGDIR/out

for file in OUTCAR POSCAR OSZICAR&#160;;
do
  cp $file $ORIGDIR/out
done
cd $ORIGDIR
# rm -rf $WORKDIR 
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="EXPLOR">EXPLOR</span></h2>
<pre>
#!/bin/bash
#SBATCH -N 2
#SBATCH -p sky
#SBATCH -J testseb  
#SBATCH -n 64 
#SBATCH -t 16-00:00:00
#SBATCH --ntasks-per-node=32

module load vasp/5.4.4/std

export OMP_NUM_THREADS=1

## Creating temporary directory in $SCRATCHDIR
WORKDIR=$SCRATCHDIR/job.$SLURM_JOB_ID.$USER
mkdir -p $WORKDIR

## Copying files to $WORKDIR 
cp -rf *  $WORKDIR

## Moving to $WORKDIR
cd $WORKDIR
## Calculation
srun vasp_std

## Copying back files to submit directory
cp -rf * $SLURM_SUBMIT_DIR/.
</pre>
<p>A soumettre avec la commande&#160;:
</p>
<pre>sbatch submit_slurm.sh
</pre>
<h1><span class="mw-headline" id="Compilation_of_vasp_5.4.4">Compilation of vasp 5.4.4</span></h1>
<p>File "makefile"
</p>
<pre>
VERSIONS = std gam ncl gpu gpu_ncl

.PHONY: all veryclean versions $(VERSIONS)

all: std gam ncl

versions: $(VERSIONS)

$(VERSIONS):
	mkdir build/$@&#160;; \
	cp src/makefile src/.objects makefile.include build/$@&#160;; \
	$(MAKE) -C build/$@ VERSION=$@ all
#	$(MAKE) -C build/$@ VERSION=$@ dependencies -j1&#160;; \
#	$(MAKE) -C build/$@ VERSION=$@ all


veryclean: 
	rm -rf build/*

</pre>
<p>File "makefile.include" used  
</p>
<pre>
# Precompiler options
CPP_OPTIONS= -DHOST=\"LinuxIFC\"\
             -DMPI -DMPI_BLOCK=8000 \
             -Duse_collective \
             -DscaLAPACK \
             -DCACHE_SIZE=4000 \
             -Davoidalloc \
             -Duse_bse_te \
             -Dtbdyn \
             -Duse_shmem 

CPP        = fpp -f_com=no -free -w0  $*$(FUFFIX) $*$(SUFFIX) $(CPP_OPTIONS)

FC         = mpiifort
FCL        = mpiifort -mkl=cluster -lstdc++

FREE       = -free -names lowercase

FFLAGS     = -assume byterecl -w
OFLAG      = -O2 -xHost
OFLAG_IN   = $(OFLAG)
DEBUG      = -O0

#MKL_PATH   = $(MKLROOT)/lib/intel64
MKL_PATH   = 
BLAS       =
LAPACK     =
#BLACS      = -lmkl_blacs_intelmpi_lp64
#SCALAPACK  = $(MKL_PATH)/libmkl_scalapack_lp64.a $(BLACS)
BLACS      = 
SCALAPACK  = 

OBJECTS    = fftmpiw.o fftmpi_map.o fft3dlib.o fftw3d.o

INCS       =-I$(MKLROOT)/include/fftw

LLIBS      = $(SCALAPACK) $(LAPACK) $(BLAS)


OBJECTS_O1 += fftw3d.o fftmpi.o fftmpiw.o
OBJECTS_O2 += fft3dlib.o

# For what used to be vasp.5.lib
CPP_LIB    = $(CPP)
FC_LIB     = $(FC)
CC_LIB     = icc
CFLAGS_LIB = -O
FFLAGS_LIB = -O1
FREE_LIB   = $(FREE)

OBJECTS_LIB= linpack_double.o getshmem.o

# For the parser library
CXX_PARS   = icpc

LIBS       += parser
LLIBS      += -Lparser -lparser -lstdc++

# Normally no need to change this
SRCDIR     = ../../src
BINDIR     = ../../bin

#================================================
# GPU Stuff

CPP_GPU    = -DCUDA_GPU -DRPROMU_CPROJ_OVERLAP -DUSE_PINNED_MEMORY -DCUFFT_MIN=28 -UscaLAPACK

OBJECTS_GPU = fftmpiw.o fftmpi_map.o fft3dlib.o fftw3d_gpu.o fftmpiw_gpu.o

CC         = icc
CXX        = icpc
CFLAGS     = -fPIC -DADD_ -Wall -qopenmp -DMAGMA_WITH_MKL -DMAGMA_SETAFFINITY -DGPUSHMEM=300 -DHAVE_CUBLAS

CUDA_ROOT &#160;?= /usr/local/cuda/
NVCC      &#160;:= $(CUDA_ROOT)/bin/nvcc -ccbin=icc
CUDA_LIB  &#160;:= -L$(CUDA_ROOT)/lib64 -lnvToolsExt -lcudart -lcuda -lcufft -lcublas

GENCODE_ARCH   &#160;:= -gencode=arch=compute_30,code=\"sm_30,compute_30\" \
                   -gencode=arch=compute_35,code=\"sm_35,compute_35\" \
                   -gencode=arch=compute_60,code=\"sm_60,compute_60\"

MPI_INC    = $(I_MPI_ROOT)/include64/
</pre>
<h1><span class="mw-headline" id="Compilation_of_vasp_6.1.2">Compilation of vasp 6.1.2</span></h1>
<pre>
VERSIONS = std gam ncl gpu gpu_ncl
.PHONY: all veryclean test test_all versions $(VERSIONS)
all: versions 
versions: $(VERSIONS)
$(VERSIONS):
	if [&#160;! -d build/$@ ]&#160;; then mkdir build/$@ &#160;; fi; \
	cp src/makefile src/.objects makefile.include build/$@&#160;; \
	$(MAKE) -C build/$@ VERSION=$@ all
#	$(MAKE) -C build/$@ VERSION=$@ dependencies -j1&#160;; 
#	$(MAKE) -C build/$@ VERSION=$@ all

veryclean:
	rm -rf build/*

test:
	$(MAKE) -C testsuite test

test_all:
	$(MAKE) -C testsuite test_all
</pre>
<p>File makefile.include
</p>
<pre>
# Precompiler options
CPP_OPTIONS= -DHOST=\"LinuxIFC\"\
             -DMPI -DMPI_BLOCK=8000 -Duse_collective \
             -DscaLAPACK \
             -DCACHE_SIZE=4000 \
             -Davoidalloc \
             -Dvasp6 \
             -Duse_bse_te \
             -Dtbdyn \
             -Dfock_dblbuf \
             -Dsol_compat

CPP        = fpp -f_com=no -free -w0  $*$(FUFFIX) $*$(SUFFIX) $(CPP_OPTIONS)

FC         = mpiifort
FCL        = mpiifort -mkl=sequential

FREE       = -free -names lowercase

FFLAGS     = -assume byterecl -w -xHOST
OFLAG      = -O2 -xCORE-AVX512 -xCORE-AVX2
OFLAG_IN   = $(OFLAG)
DEBUG      = -O0

MKL_PATH   = $(MKLROOT)/lib/intel64
BLAS       =
LAPACK     =
BLACS      = -lmkl_blacs_intelmpi_lp64
SCALAPACK  = $(MKL_PATH)/libmkl_scalapack_lp64.a $(BLACS)

OBJECTS    = fftmpiw.o fftmpi_map.o fft3dlib.o fftw3d.o

INCS       =-I$(MKLROOT)/include/fftw

LLIBS      = $(SCALAPACK) $(LAPACK) $(BLAS)


OBJECTS_O1 += fftw3d.o fftmpi.o fftmpiw.o
OBJECTS_O2 += fft3dlib.o

# For what used to be vasp.5.lib
CPP_LIB    = $(CPP)
FC_LIB     = $(FC)
CC_LIB     = icc
CFLAGS_LIB = -O
FFLAGS_LIB = -O1
FREE_LIB   = $(FREE)

OBJECTS_LIB= linpack_double.o getshmem.o

# For the parser library
CXX_PARS   = icpc
LLIBS      += -lstdc++

# Normally no need to change this
SRCDIR     = ../../src
BINDIR     = ../../bin

#================================================
# GPU Stuff

CPP_GPU    = -DCUDA_GPU -DRPROMU_CPROJ_OVERLAP -DUSE_PINNED_MEMORY -DCUFFT_MIN=28 -UscaLAPACK -Ufock_dblbuf

OBJECTS_GPU= fftmpiw.o fftmpi_map.o fft3dlib.o fftw3d_gpu.o fftmpiw_gpu.o

CC         = icc
CXX        = icpc
CFLAGS     = -fPIC -DADD_ -Wall -qopenmp -DMAGMA_WITH_MKL -DMAGMA_SETAFFINITY -DGPUSHMEM=300 -DHAVE_CUBLAS

CUDA_ROOT &#160;?= /usr/local/cuda/
NVCC      &#160;:= $(CUDA_ROOT)/bin/nvcc -ccbin=icc
CUDA_LIB  &#160;:= -L$(CUDA_ROOT)/lib64 -lnvToolsExt -lcudart -lcuda -lcufft -lcublas

GENCODE_ARCH   &#160;:= -gencode=arch=compute_30,code=\"sm_30,compute_30\" \
                   -gencode=arch=compute_35,code=\"sm_35,compute_35\" \
                   -gencode=arch=compute_60,code=\"sm_60,compute_60\" \
                   -gencode=arch=compute_70,code=\"sm_70,compute_70\" \
                   -gencode=arch=compute_72,code=\"sm_72,compute_72\"

MPI_INC    = $(I_MPI_ROOT)/include64/

</pre>
<h1><span class="mw-headline" id="Plugin_wannier90-1.2">Plugin wannier90-1.2</span></h1>
<h2><span class="mw-headline" id="documentation">documentation</span></h2>
<p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://www.slideshare.net/jmskelton/vasp-and-wannier90-a-quick-tutorial">https://www.slideshare.net/jmskelton/vasp-and-wannier90-a-quick-tutorial</a>
</p><p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://www.wannier.org/">http://www.wannier.org/</a>
</p><p><br />
<a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://www.wannier.org/doc/tutorial.pdf">http://www.wannier.org/doc/tutorial.pdf</a>
</p>
<h2><span class="mw-headline" id="Installation_avec_Lamejed_Debbichi.">Installation avec Lamejed Debbichi.</span></h2>
<p>Makefile utilisé&#160;:
</p>
<pre>
cat model_wannier_makefile.txt
# Precompiler options
CPP_OPTIONS= -DMPI -DHOST=\"IFC91_ompi\" -DIFC \
             -DCACHE_SIZE=4000 -DPGF90 -Davoidalloc \
             -DMPI_BLOCK=8000 -DscaLAPACK -Duse_collective \
             -DnoAugXCmeta -Duse_bse_te \
             -Duse_shmem -Dtbdyn -Dseballoc -DVASP2WANNIER90

CPP        = fpp -f_com=no -free -w0  $*$(FUFFIX) $*$(SUFFIX) $(CPP_OPTIONS)

FC         = mpif90
FCL        = mpif90 -mkl

FREE       = -free -names lowercase

#FFLAGS     = -assume byterecl
OFLAG      = -O2 -ip -ftz
#OFLAG      = -O2
OFLAG_IN   = $(OFLAG)
DEBUG      = -O0

MKL_PATH   = $(MKLROOT)/lib/intel64
BLAS       = -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lpthread
#BLAS       =
LAPACK     =
BLACS      = -lmkl_blacs_openmpi_lp64
SCALAPACK  = -L$(MKL_PATH) -lmkl_scalapack_lp64 $(BLACS)
#SCALAPACK  = $(MKL_PATH)/libmkl_scalapack_lp64.a $(BLACS)

OBJECTS    = fftmpiw.o fftmpi_map.o fftw3d.o fft3dlib.o \
             $(MKLROOT)/interfaces/fftw3xf/libfftw3xf_intel.a
INCS       =-I$(MKLROOT)/include/fftw

LLIBS      = /home/debbichi/Wannier_vasp/wannier90-1.2/libwannier.a $(SCALAPACK) $(LAPACK) $(BLAS)

OBJECTS_O1 += fft3dfurth.o fftw3d.o fftmpi.o fftmpiw.o
OBJECTS_O2 += fft3dlib.o

# For what used to be vasp.5.lib
CPP_LIB    = $(CPP)
FC_LIB     = $(FC)
CC_LIB     = icc
CFLAGS_LIB = -O
FFLAGS_LIB = -O1
FREE_LIB   = $(FREE)

OBJECTS_LIB= linpack_double.o getshmem.o

# Normally no need to change this
SRCDIR     = ../../src
BINDIR     = ../../bin

</pre>
<p>Comiplation avec intel18u3
</p>
<pre>
cat make.sys 

#=================================================
# For Linux with intel version 8/9 
#=================================================
F90 = ifort
FCOPTS = -O2
#LDOPTS = -O2 -Vaxlib 
LDOPTS = -O2 

#========================================================
# Intel mkl libraries. Set LIBPATH if not in default path
#========================================================

LIBDIR = $(MKLROOT)/lib/intel64
#LIBS   =  -L$(LIBDIR) -lmkl_lapack  -lmkl_ia32 -lguide -lpthread
LIBS   =  -L$(LIBDIR) -mkl -lpthread

#=======================
# ATLAS Blas and LAPACK
#=======================
#LIBDIR = /usr/local/lib
#LIBS = -L$(LIBDIR)  -llapack -lf77blas -lcblas -latlas

[tmssoft@cns09 wannier90-1.2]$ make all
(cd src&#160;; make prog)
make[1]: Entering directory `/auto/soft/vasp/wannier90-1.2/src'
ifort wannier_prog.F90 -O2  constants.o io.o utility.o parameters.o hamiltonian.o overlap.o kmesh.o disentangle.o wannierise.o plot.o transport.o -L/auto/soft/compiler/intel/psxe-18.3/compilers_and_libraries_2018.3.222/linux/mkl/lib/intel64 -mkl -lpthread -o ../wannier90.x
make[1]: Leaving directory `/auto/soft/vasp/wannier90-1.2/src'
(cd src&#160;; make libs)
make[1]: Entering directory `/auto/soft/vasp/wannier90-1.2/src'
ifort -O2 -c wannier_lib.F90
ar rv ../libwannier.a wannier_lib.o constants.o io.o utility.o parameters.o hamiltonian.o overlap.o kmesh.o disentangle.o wannierise.o plot.o transport.o
ar: creating ../libwannier.a
a - wannier_lib.o
a - constants.o
a - io.o
a - utility.o
a - parameters.o
a - hamiltonian.o
a - overlap.o
a - kmesh.o
a - disentangle.o
a - wannierise.o
a - plot.o
a - transport.o
make[1]: Leaving directory `/auto/soft/vasp/wannier90-1.2/src'
[tmssoft@cns09 wannier90-1.2]$ ls -ltr
total 4724
-rw-r--r--  1 tmssoft users   17990 Oct 29  2009 LICENCE
-rw-r--r--  1 tmssoft users    4558 Oct 29  2009 README.install
-rw-r--r--  1 tmssoft users    3104 Nov 30  2009 README
-rw-r--r--  1 tmssoft users    2505 Dec 21  2009 Makefile
-rw-r--r--  1 tmssoft users    4369 Jan 16  2010 CHANGE.log
drwxr-xr-x  3 tmssoft users      41 Jan 24  2010 utility
drwxr-xr-x  5 tmssoft users      54 Jan 24  2010 pwscf
drwxr-xr-x  2 tmssoft users    4096 Jan 24  2010 pseudo
drwxr-xr-x 17 tmssoft users    4096 Jan 24  2010 examples
drwxr-xr-x  4 tmssoft users      38 Jan 24  2010 doc
drwxr-xr-x  4 tmssoft users      63 Jan 26  2010 tests
drwxr-xr-x  2 tmssoft users    4096 Jan 24 09:19 config
-rw-------  1 tmssoft users     669 Jan 24 09:32 make.sys
-rwxr-xr-x  1 tmssoft users 2691240 Jan 24 09:35 wannier90.x
drwxr-xr-x  2 tmssoft users    4096 Jan 24 09:35 src
-rw-r--r--  1 tmssoft users 2075636 Jan 24 09:35 libwannier.a
</pre>
<pre>
make veryclean

make all
</pre>
<h1><span class="mw-headline" id="test_vasp.2Fsio2-3_S.C3.A9bastien">test_vasp/sio2-3 Sébastien</span></h1>
<h2><span class="mw-headline" id="vasp_std">vasp_std</span></h2>
<pre>
Les premiers résultats des tests avec 64 coeurs et vasp_std&#160;:


= au LPCT sur la partition taras =

Les dernières lignes 

out/OSZICAR: 170 F= -.27940496E+04 E0= -.27940496E+04  d E =-.569642E-04
out/OSZICAR: 171 F= -.27940496E+04 E0= -.27940496E+04  d E =-.638521E-04
out/OSZICAR: 172 F= -.27940497E+04 E0= -.27940497E+04  d E =-.525409E-04
out/OSZICAR: 173 F= -.27940497E+04 E0= -.27940497E+04  d E =-.532296E-04
out/OSZICAR: 174 F= -.27940497E+04 E0= -.27940497E+04  d E =-.333497E-04
out/OSZICAR: 175 F= -.27940497E+04 E0= -.27940497E+04  d E =-.334200E-04
out/OSZICAR: 176 F= -.27940498E+04 E0= -.27940498E+04  d E =-.441527E-04

==&gt; out/OUTCAR &lt;==
                            User time (sec):    34661.063
                          System time (sec):     1280.052
                         Elapsed time (sec):    36025.974
  
                   Maximum memory used (kb):      425324.
                   Average memory used (kb):           0.
  
                          Minor page faults:      6620107
                          Major page faults:            8
                 Voluntary context switches:       252897


= au mésocentre partition sky =

../../test_saber/test-saber-mesocentre/OSZICAR: 163 F= -.27940501E+04 E0= -.27940501E+04  d E =-.682094E-04
../../test_saber/test-saber-mesocentre/OSZICAR: 164 F= -.27940501E+04 E0= -.27940501E+04  d E =-.683995E-04
../../test_saber/test-saber-mesocentre/OSZICAR: 165 F= -.27940502E+04 E0= -.27940502E+04  d E =-.626082E-04
../../test_saber/test-saber-mesocentre/OSZICAR: 166 F= -.27940502E+04 E0= -.27940502E+04  d E =-.636142E-04
../../test_saber/test-saber-mesocentre/OSZICAR: 167 F= -.27940502E+04 E0= -.27940502E+04  d E =-.625284E-04
../../test_saber/test-saber-mesocentre/OSZICAR: 168 F= -.27940502E+04 E0= -.27940502E+04  d E =-.634017E-04
../../test_saber/test-saber-mesocentre/OSZICAR: 169 F= -.27940503E+04 E0= -.27940503E+04  d E =-.491734E-04

==&gt; ../../test_saber/test-saber-mesocentre/OUTCAR &lt;==
                            User time (sec):    33715.306
                          System time (sec):     1226.373
                         Elapsed time (sec):    35003.171
  
                   Maximum memory used (kb):      378408.
                   Average memory used (kb):           0.
  
                          Minor page faults:      3784772
                          Major page faults:           11
                 Voluntary context switches:       254799

= Comparaison des temps =

Je suppose que le temps passé pour chaque itération est le même.

&gt;&gt;&gt; 36025/176.
204.6875 

&gt;&gt;&gt; 35003/169.
207.11834319526628
</pre>
<h2><span class="mw-headline" id="vasp_gam">vasp_gam</span></h2>
<pre>


test_saber/vasp_gam/OSZICAR: 115 F= -.27940441E+04 E0= -.27940441E+04  d E =-.231596E-03
test_saber/vasp_gam/OSZICAR: 116 F= -.27940442E+04 E0= -.27940442E+04  d E =-.282354E-03
test_saber/vasp_gam/OSZICAR: 117 F= -.27940443E+04 E0= -.27940443E+04  d E =-.162302E-03
test_saber/vasp_gam/OSZICAR: 118 F= -.27940444E+04 E0= -.27940444E+04  d E =-.212128E-03
test_saber/vasp_gam/OSZICAR: 119 F= -.27940445E+04 E0= -.27940445E+04  d E =-.161625E-03
test_saber/vasp_gam/OSZICAR: 120 F= -.27940446E+04 E0= -.27940446E+04  d E =-.194825E-03
test_saber/vasp_gam/OSZICAR: 121 F= -.27940447E+04 E0= -.27940447E+04  d E =-.138333E-03
test_saber/vasp_gam/OSZICAR: 122 F= -.27940447E+04 E0= -.27940447E+04  d E =-.157260E-03
test_saber/vasp_gam/OSZICAR: 123 F= -.27940448E+04 E0= -.27940448E+04  d E =-.992818E-04
test_saber/vasp_gam/OSZICAR: 124 F= -.27940448E+04 E0= -.27940448E+04  d E =-.124222E-03
test_saber/vasp_gam/OSZICAR: 125 F= -.27940450E+04 E0= -.27940450E+04  d E =-.119871E-03



vasp_gam-taras/out/OSZICAR: 230 F= -.27940523E+04 E0= -.27940523E+04  d E =-.788519E-04
vasp_gam-taras/out/OSZICAR: 231 F= -.27940523E+04 E0= -.27940523E+04  d E =-.787606E-04
vasp_gam-taras/out/OSZICAR: 232 F= -.27940523E+04 E0= -.27940523E+04  d E =-.915583E-04
vasp_gam-taras/out/OSZICAR: 233 F= -.27940523E+04 E0= -.27940523E+04  d E =-.916778E-04
vasp_gam-taras/out/OSZICAR: 234 F= -.27940524E+04 E0= -.27940524E+04  d E =-.623461E-04
vasp_gam-taras/out/OSZICAR: 235 F= -.27940524E+04 E0= -.27940524E+04  d E =-.704710E-04
vasp_gam-taras/out/OSZICAR: 236 F= -.27940525E+04 E0= -.27940525E+04  d E =-.727374E-04
vasp_gam-taras/out/OSZICAR: 237 F= -.27940525E+04 E0= -.27940525E+04  d E =-.758555E-04
vasp_gam-taras/out/OSZICAR: 238 F= -.27940526E+04 E0= -.27940526E+04  d E =-.587734E-04
vasp_gam-taras/out/OSZICAR: 239 F= -.27940526E+04 E0= -.27940526E+04  d E =-.608237E-04
vasp_gam-taras/out/OSZICAR: 240 F= -.27940526E+04 E0= -.27940526E+04  d E =-.539769E-04



 tail -15  ../test_saber/vasp_gam/OUTCAR 
  
 General timing and accounting informations for this job:
 ========================================================
  
                  Total CPU time used (sec):    17375.264
                            User time (sec):    16794.145
                          System time (sec):      581.119
                         Elapsed time (sec):    17405.256
  
                   Maximum memory used (kb):      298084.
                   Average memory used (kb):           0.
  
                          Minor page faults:      8749467
                          Major page faults:           13
                 Voluntary context switches:       163254




$ tail -15 vasp_gam-taras/out/OUTCAR 
  
 General timing and accounting informations for this job:
 ========================================================
  
                  Total CPU time used (sec):    28652.441
                            User time (sec):    27873.560
                          System time (sec):      778.880
                         Elapsed time (sec):    28713.497
  
                   Maximum memory used (kb):      338176.
                   Average memory used (kb):           0.
  
                          Minor page faults:      5727253
                          Major page faults:           16
                 Voluntary context switches:       232975


Si on considère que chaque itération coute le même temps&#160;:


&gt;&gt;&gt; 28652/240. =  119.4 s par itération pour taras

&gt;&gt;&gt; 17375/125. =  139.0 s par itération pour le mésocentre

</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="vasp_std_:_test_des_nouveaux_noeuds_taras4_ou_taras3">vasp_std&#160;: test des nouveaux noeuds taras4 ou taras3</span></h2>
<pre>
mpirun -genv I_MPI_DEBUG=5 -genv I_MPI_FABRICS shm:tmi -np 80  vasp_std 

grep "=" test_vasp/sio2-3/test_npar/vasp_std-taras4-opa/out/OSZICAR   |tail 

 150 F= -.27940464E+04 E0= -.27940464E+04  d E =-.213759E-03
 151 F= -.27940465E+04 E0= -.27940465E+04  d E =-.162053E-03
 152 F= -.27940466E+04 E0= -.27940466E+04  d E =-.190462E-03
 153 F= -.27940467E+04 E0= -.27940467E+04  d E =-.181670E-03
 154 F= -.27940467E+04 E0= -.27940467E+04  d E =-.191446E-03
 155 F= -.27940469E+04 E0= -.27940469E+04  d E =-.134887E-03
 156 F= -.27940469E+04 E0= -.27940469E+04  d E =-.135670E-03
 157 F= -.27940470E+04 E0= -.27940470E+04  d E =-.117711E-03
 158 F= -.27940470E+04 E0= -.27940470E+04  d E =-.134442E-03
 159 F= -.27940472E+04 E0= -.27940472E+04  d E =-.143624E-03



tail -15 test_vasp/sio2-3/test_npar/vasp_std-taras4-opa/out/OUTCAR

 General timing and accounting informations for this job:
 ========================================================
  
                  Total CPU time used (sec):    29974.961
                            User time (sec):    29023.692
                          System time (sec):      951.269
                         Elapsed time (sec):    29974.436
  
                   Maximum memory used (kb):      410080.
                   Average memory used (kb):           0.
  
                          Minor page faults:      6671185
                          Major page faults:           87
                 Voluntary context switches:       198376

&gt;&gt;&gt; 29974/159.
188.5
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="vasp_gam_:_test_des_nouveaux_noeuds_taras4_ou_taras3">vasp_gam&#160;: test des nouveaux noeuds taras4 ou taras3</span></h2>
<pre>
module purge&#160;; module load vasp/5.4.4
ulimit -s unlimited
export OMP_NUM_THREADS=1
export I_MPI_FABRICS=shm:tmi
export I_MPI_TMI_PROVIDER=psm2 

mpirun -genv I_MPI_DEBUG=5 -genv I_MPI_FABRICS shm:tmi -np 80  vasp_gam


cd /auto/store/fpascale/test_vasp/sio2-3/test_npar

==&gt; GAM/taras3-opa/out/OSZICAR &lt;==
RMM:   6    -0.276949908088E+04   -0.21391E-07   -0.23609E-08   603   0.206E-04
 205 F= -.27940502E+04 E0= -.27940502E+04  d E =-.751646E-04
       N       E                     dE             d eps       ncg     rms          rms(c)
DAV:   1    -0.276949913599E+04   -0.55135E-04   -0.21756E-03  2280   0.503E-02    0.127E-02
RMM:   2    -0.276949914033E+04   -0.43430E-05   -0.53142E-05  2233   0.711E-03    0.542E-03
RMM:   3    -0.276949913975E+04    0.58700E-06   -0.12334E-06  1331   0.108E-03    0.327E-03
RMM:   4    -0.276949913958E+04    0.16676E-06   -0.16654E-06  1343   0.111E-03    0.894E-04
RMM:   5    -0.276949913958E+04    0.58208E-10   -0.18654E-07  1217   0.419E-04    0.415E-04
RMM:   6    -0.276949913959E+04   -0.93132E-08   -0.44102E-08   681   0.224E-04
 206 F= -.27940503E+04 E0= -.27940503E+04  d E =-.651252E-04

==&gt; GAM/taras4-opa/out/OSZICAR &lt;==
RMM:   6    -0.276949908088E+04   -0.21391E-07   -0.23609E-08   603   0.206E-04
 205 F= -.27940502E+04 E0= -.27940502E+04  d E =-.751646E-04
       N       E                     dE             d eps       ncg     rms          rms(c)
DAV:   1    -0.276949913599E+04   -0.55135E-04   -0.21756E-03  2280   0.503E-02    0.127E-02
RMM:   2    -0.276949914033E+04   -0.43430E-05   -0.53142E-05  2233   0.711E-03    0.542E-03
RMM:   3    -0.276949913975E+04    0.58700E-06   -0.12334E-06  1331   0.108E-03    0.327E-03
RMM:   4    -0.276949913958E+04    0.16676E-06   -0.16654E-06  1343   0.111E-03    0.894E-04
RMM:   5    -0.276949913958E+04    0.58208E-10   -0.18654E-07  1217   0.419E-04    0.415E-04
RMM:   6    -0.276949913959E+04   -0.93132E-08   -0.44102E-08   681   0.224E-04
 206 F= -.27940503E+04 E0= -.27940503E+04  d E =-.651252E-04


 tail  -15 GAM/taras3-opa/out/OUTCAR
  
 General timing and accounting informations for this job:
 ========================================================
  
                  Total CPU time used (sec):    23153.607
                            User time (sec):    22549.649
                          System time (sec):      603.958
                         Elapsed time (sec):    23161.468
  
                   Maximum memory used (kb):      330852.
                   Average memory used (kb):           0.
  
                          Minor page faults:      3707252
                          Major page faults:           95
                 Voluntary context switches:       183618

 tail  -15 GAM/taras4-opa/out/OUTCAR
  
 General timing and accounting informations for this job:
 ========================================================
  
                  Total CPU time used (sec):    22830.168
                            User time (sec):    22239.414
                          System time (sec):      590.754
                         Elapsed time (sec):    22837.981
  
                   Maximum memory used (kb):      330412.
                   Average memory used (kb):           0.
  
                          Minor page faults:      4898896
                          Major page faults:           64
                 Voluntary context switches:       231253

&gt;&gt;&gt; 22830/206.
110.8 secondes par itération
</pre>
<h1><span class="mw-headline" id="Documentation_2">Documentation</span></h1>
<p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://www.vasp.at/">https://www.vasp.at/</a>
</p><p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://www.nvidia.com/en-us/data-center/gpu-accelerated-applications/vasp/">https://www.nvidia.com/en-us/data-center/gpu-accelerated-applications/vasp/</a>
</p><p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://software.intel.com/en-us/articles/building-vasp-with-intel-mkl-and-intel-compilers">https://software.intel.com/en-us/articles/building-vasp-with-intel-mkl-and-intel-compilers</a>
</p><p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://fossil.boisestate.edu/hpc-software/doc/trunk/pdf/vasp/VASP-RunBook.pdf">https://fossil.boisestate.edu/hpc-software/doc/trunk/pdf/vasp/VASP-RunBook.pdf</a>
</p><p><br />
</p>
<h1><span class="mw-headline" id="Troubleshooting_Omnipath">Troubleshooting Omnipath</span></h1>
<pre>

Memory limits

OmniPath requires all user processes to have unlimited locked memory. For normal users starting a shell, this is configured in /etc/security/limits.conf by adding the lines:

* hard memlock unlimited
* soft memlock unlimited

This file is read by PAM when users log in. However, system daemons started during the boot process do not use /etc/security/limits.conf, and the correct memory limits must be set inside the daemon startup scripts. This is especially important for batch job services.

Users may verify the correct locked memory limits by the command:

# ulimit -l
unlimited

If the locked memory limit is too low, a rather strange error will be printed by the PSM2 library:

PSM2 can't open hfi unit: -1 (err=23)
PSM2 was unable to open an endpoint. Please make sure that the network link is
active on the node and the hardware is functioning.
  Error: Failure in initializing endpoint
hfi_userinit: mmap of rcvhdrq at dabbad0004030000 failed: Resource temporarily unavailable

There will be system syslog messages as well like:

psm2-demo: (hfi/PSM)[4982]: PSM2 can't open hfi unit: -1 (err=23)
kernel: cache_from_obj: Wrong slab cache. kmalloc-64(382:step_batch) but object is from kmem_cache_node

In the libpsm2 source code the error originate from the function hfi_userinit() in the file libpsm2-10.*/opa/opa_proto.c.

</pre>




</body></html>