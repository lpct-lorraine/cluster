<html>
<head><title>Slurm cluster explor</title></head>
<body>
<h1>Slurm cluster explor</h1><p><br />
</p>
<h2><span class="mw-headline" id="utilisation_d.27un_makefile_pour_lancer_plusieurs_jobs_mono_coeurs">utilisation d'un makefile pour lancer plusieurs jobs mono coeurs</span></h2>
<ul><li> fichier <b>makefile</b></li></ul>
<pre>
#Inclusion des fichiers source
SOURCE1=$(wildcard /home/piquet4u/spce/ladd10-svanberg/thermalisations/*/*/newrun/*/newboxrun)

# Date d'exécution du Makefile (pas de démarrage des jobs!)
DATE:=$(shell date +'%Y-%m-%d_%H-%M-%S')

TARGET1=${SOURCE1}/${DATE}/out.txt
TARGETDIRECTORY=${SOURCE1}/${DATE}

ALL: $(TARGET1)

${TARGET1}: ${SOURCE1}/spce.dat ${SOURCE1}/new_conf
	mkdir -v ${SOURCE1}/${DATE}
	cp -v ${SOURCE1}/mdmol_new ${TARGETDIRECTORY}/mdmol_new
	cp -v ${SOURCE1}/spce.dat ${TARGETDIRECTORY}/spce.dat
	cp -v ${SOURCE1}/new_conf ${TARGETDIRECTORY}/new_conf
	chmod +x ${TARGETDIRECTORY}/mdmol_new
	cd ${TARGETDIRECTORY}; ./mdmol_new &gt; $@
</pre>
<ul><li>Obtenir la date d'exécution de make dans un Makefile</li></ul>
<pre>DATE:=$(shell date +'%Y-%m-%d_%H-%M-%S')
</pre>
<p><b>Exemple de script slurm invoquant make</b>
</p>
<pre><b> sbatch exemple_slurm.sh</b>
</pre>
<pre>
#!/bin/sh

# Ficher exemple_slurm.sh avec exécution d'un makefile sur 16 threads

#SBATCH --mail-user user_name@domain.org
#SBATCH --mail-type=ALL
#SBATCH -J test_slurm
#SBATCH -o slurm.out
#SBATCH -e slurm.err
#SBATCH -p defq
#SBATCH -vvv

echo "Running sysstat capture"
eval $(`sar -o ${HOSTNAME}_stat.sar 10 600 &gt;/dev/null 2&gt;&amp;1 &amp;`)
sleep 60
echo "-------------------"

make -j 16

echo "Killing program sar..."
sleep 60
pkill sar
echo "-------------------"

</pre>




</body></html>