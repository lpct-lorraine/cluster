<html>
<head><title>Commande linux</title></head>
<body>
<h1>Commande linux</h1><p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Commande_find"><span class="tocnumber">1</span> <span class="toctext">Commande find</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Trouver_l.27espace_utilis.C3.A9_par_tous_les_fichiers_fortran_dans_une_arborescence_linux"><span class="tocnumber">1.1</span> <span class="toctext">Trouver l'espace utilisé par tous les fichiers fortran dans une arborescence linux</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Trouver_les_derniers_fichiers_modifi.C3.A9s_dans_une_arborescence"><span class="tocnumber">1.2</span> <span class="toctext">Trouver les derniers fichiers modifiés dans une arborescence</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Taille_des_r.C3.A9pertoires_d.27une_arborescence.2C_tri_et_affiche_les_20_plus_important"><span class="tocnumber">2</span> <span class="toctext">Taille des répertoires d'une arborescence, tri et affiche les 20 plus important</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Get_in_a_tree_structure_all_file_names_containing_a_given_string"><span class="tocnumber">3</span> <span class="toctext">Get in a tree structure all file names containing a given string</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Command_rsync_and_check_the_transfer_with_md5sum"><span class="tocnumber">4</span> <span class="toctext">Command rsync and check the transfer with md5sum</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Commande_find">Commande find</span></h1>
<h2><span class="mw-headline" id="Trouver_l.27espace_utilis.C3.A9_par_tous_les_fichiers_fortran_dans_une_arborescence_linux">Trouver l'espace utilisé par tous les fichiers fortran dans une arborescence linux</span></h2>
<pre>find . -name "fort.*"  -print0 | du --files0-from=- -hc | tail -n1
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Trouver_les_derniers_fichiers_modifi.C3.A9s_dans_une_arborescence">Trouver les derniers fichiers modifiés dans une arborescence</span></h2>
<pre>find -type f -printf '%T@&#160;%p\0' |
sort -zk 1nr |
sed -z 's/^[^ ]* //' | tr '\0' '\n' | head -n 10
</pre>
<h1><span class="mw-headline" id="Taille_des_r.C3.A9pertoires_d.27une_arborescence.2C_tri_et_affiche_les_20_plus_important">Taille des répertoires d'une arborescence, tri et affiche les 20 plus important</span></h1>
<pre>find . -xdev -type d -name '[!.]*' -exec du -sh {} + | sort -h | tail -20
</pre>
<pre>find / -xdev  -type d -name '[!.]*' -maxdepth 1 -exec du -hs {} \; | sort -h file 
</pre>
<h1><span class="mw-headline" id="Get_in_a_tree_structure_all_file_names_containing_a_given_string">Get in a tree structure all file names containing a given string</span></h1>
<pre>find . -name '*' -exec grep -l "string" {} \;
</pre>
<h1><span class="mw-headline" id="Command_rsync_and_check_the_transfer_with_md5sum">Command rsync and check the transfer with md5sum</span></h1>
<p>To transfer data with rsync to visu-lia, use the command:
</p><p>/usr/bin/rsync -avz --info=progress2 -aPSHv remote_username@remote_host:/remote/path/to/data /local/path/to/store/data 
</p><p>If you need first to create a tunnel between local_host and remote_host through an intermediate host (bastion), add in your .ssh/config file the following lines:
</p><p>Host *
</p>
<pre> IdentitiesOnly yes
 ControlMaster auto
</pre>
<pre> # the following line assumes that you have created the folder ~/.ssh/proxyjump-remote_machine_name: 
</pre>
<pre> ControlPath ~/.ssh/proxyjump-remote_machine_name/remote_user_name-%h-%r-%p
</pre>
<pre>Host bastion
</pre>
<pre>Hostname bastion_host_name
 User bastion_username
 ProxyCommand none
</pre>
<pre>Host remotehost
    Hostname remotehost.domain
</pre>
<pre>    User remote_username
    ProxyJump bastion
</pre>
<p>Once .ssh/config is saved, type "ssh remote_host" to connect to the remote_host, and you will be asked to give 
first the bastion password, and then the remote_host password.
</p><p>Once the tunnel is started in one tab, you can open another tab and enter the rsync command given above. 
</p><p>Please note:
</p><p>(a) it is also possible to use ssh keys, but I did not test it
</p><p>(b) this information is given "as it", without garanteeing to work
</p><p>Once the transfert is finished, to check that all files have between copired without corruption, use the bash function md5sums 
</p><p>to run md5sum on a whole file tree hacked  in <a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://stackoverflow.com/questions/36920307/md5-all-files-in-a-directory-tree">https://stackoverflow.com/questions/36920307/md5-all-files-in-a-directory-tree</a>
</p><p>The bash function has been imported to this wiki under the name: Bash_md5sums.bash.txt
</p><p>The function md5sums can be inserted in the file .bashrc before running again: source .bashrc. The output of md5sums is the file: checksums.md5. To compare two runs of md5sums on the remote and the copied data, the files checksums.md5  have to be sorted: sort -k 1,1 checksums.md5 &gt; checksums.md5.sorted. If the transfer was succesful, the remote and local files checksums.md5.sorted should not display differences (to check difference use the Linux cmmand diff). Nevertheless, collisions (same mdsum5 code for two different files) are observed if too many files are contained in the transferred directory: in that case, one should divide the data and test mdsum5 on sub-directories.
</p>



</body></html>