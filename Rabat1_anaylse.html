<html>
<head><title>Rabat1 anaylse</title></head>
<body>
<h1>Rabat1 anaylse</h1><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Echange_mail_Mouinir"><span class="tocnumber">1</span> <span class="toctext">Echange mail Mouinir</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Etude_smartcl"><span class="tocnumber">2</span> <span class="toctext">Etude  smartcl</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Manual"><span class="tocnumber">2.1</span> <span class="toctext">Manual</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#dmesg"><span class="tocnumber">2.2</span> <span class="toctext">dmesg</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#twa0"><span class="tocnumber">2.3</span> <span class="toctext">twa0</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#twa1"><span class="tocnumber">2.4</span> <span class="toctext">twa1</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#twa2"><span class="tocnumber">2.5</span> <span class="toctext">twa2</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#tw_cli"><span class="tocnumber">3</span> <span class="toctext">tw_cli</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#modele_des_disques_controleurs_c6"><span class="tocnumber">3.1</span> <span class="toctext">modele des disques controleurs c6</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#modele_des_disques_controleurs_c7"><span class="tocnumber">3.2</span> <span class="toctext">modele des disques controleurs c7</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#Aide"><span class="tocnumber">4</span> <span class="toctext">Aide</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Echange_mail_Mouinir">Echange mail Mouinir</span></h1>
<p>On 12/01/18 10:43, Fabien PASCALE wrote:
</p><p>Bonjour Mounir,
</p><p>Pour l'instant, seul la sauvegarde du répertoire /backup1 a été sauvé sur rabat1.
</p>
<pre>
16G    /bacula-disk1/tmp_rabat1/backup1/audreyd
184G    /bacula-disk1/tmp_rabat1/backup1/backup
12K    /bacula-disk1/tmp_rabat1/backup1/campomanes
2.0T    /bacula-disk1/tmp_rabat1/backup1/delem_copy
160G    /bacula-disk1/tmp_rabat1/backup1/gorkovets
4.4T    /bacula-disk1/tmp_rabat1/backup1/jgarrec
8.6T    /bacula-disk1/tmp_rabat1/backup1/mkasimova
256G    /bacula-disk1/tmp_rabat1/backup1/rucinska
562G    /bacula-disk1/tmp_rabat1/backup1/sara
415G    /bacula-disk1/tmp_rabat1/backup1/sautot
509G    /bacula-disk1/tmp_rabat1/backup1/schulz
225G    /bacula-disk1/tmp_rabat1/backup1/tarek
</pre>
<p><br />
On 10/01/18 16:35, Mounir Tarek wrote:
</p><p>Merci Fabien et Christian
</p><p>je fais maintenant mes bilans
</p><p>il me faut absolument le listing de ce qui a ete deja sauvegarde svp de votre cote
</p><p>Merci
</p>
<hr /> Le 5 Jan 18, à 16:18, Fabien PASCALE &lt;fabien.pascale@univ-lorraine.fr&gt; a écrit&#160;:
<pre>
/dev/sdc1              19T   18T  883G  96% /data1     =&gt; c6
/dev/sdd1              19T   16T  2,3T  88% /data2     =&gt; c6
/dev/sde1              20T   20T   99G 100% /backup1   =&gt; c7
/dev/sde2              20T   19T  743G  97% /backup2   =&gt; c7

lrwxrwxrwx 1 root root  9 oct  2 12:59 scsi-3600050e00ba4e3002e4b000017b90000 -&gt; ../../sdd
lrwxrwxrwx 1 root root  9 oct  2 12:59 scsi-3600050e00ba4ca00e8d10000380b0000 -&gt; ../../sdc
lrwxrwxrwx 1 root root 10 oct  2 12:59 scsi-3600050e00ba4e3002e4b000017b90000-part1 -&gt; ../../sdd1
lrwxrwxrwx 1 root root 10 oct  2 12:59 scsi-3600050e00ba4ca00e8d10000380b0000-part1 -&gt; ../../sdc1

lrwxrwxrwx 1 root root  9 oct  2 12:59 pci-0000:04:00.0-scsi-0:0:1:0 -&gt; ../../sdd
lrwxrwxrwx 1 root root  9 oct  2 12:59 pci-0000:04:00.0-scsi-0:0:0:0 -&gt; ../../sdc
lrwxrwxrwx 1 root root 10 oct  2 12:59 pci-0000:04:00.0-scsi-0:0:1:0-part1 -&gt; ../../sdd1
lrwxrwxrwx 1 root root 10 oct  2 12:59 pci-0000:04:00.0-scsi-0:0:0:0-part1 -&gt; ../../sdc1

lrwxrwxrwx 1 root root  9 oct  2 12:59 pci-0000:04:00.0-scsi-0:0:1:0 -&gt; ../../sdd
lrwxrwxrwx 1 root root  9 oct  2 12:59 pci-0000:04:00.0-scsi-0:0:0:0 -&gt; ../../sdc
lrwxrwxrwx 1 root root 10 oct  2 12:59 pci-0000:04:00.0-scsi-0:0:1:0-part1 -&gt; ../../sdd1
lrwxrwxrwx 1 root root 10 oct  2 12:59 pci-0000:04:00.0-scsi-0:0:0:0-part1 -&gt; ../../sdc1


o
lrwxrwxrwx 1 root root  9 oct  2 12:58 /dev/disk/by-id/scsi-3600050e0d8d7c40064d8000010c20000 -&gt; ../../sde
lrwxrwxrwx 1 root root 10 oct  2 12:58 /dev/disk/by-id/scsi-3600050e0d8d7c40064d8000010c20000-part1 -&gt; ../../sde1
lrwxrwxrwx 1 root root 10 oct  2 12:58 /dev/disk/by-id/scsi-3600050e0d8d7c40064d8000010c20000-part2 -&gt; ../../sde2
lrwxrwxrwx 1 root root  9 oct  2 12:59 /dev/disk/by-id/scsi-3600050e00ba4e3002e4b000017b90000 -&gt; ../../sdd
lrwxrwxrwx 1 root root  9 oct  2 12:59 /dev/disk/by-id/scsi-3600050e00ba4ca00e8d10000380b0000 -&gt; ../../sdc
lrwxrwxrwx 1 root root 10 oct  2 12:59 /dev/disk/by-id/scsi-3600050e00ba4e3002e4b000017b90000-part1 -&gt; ../../sdd1
lrwxrwxrwx 1 root root 10 oct  2 12:59 /dev/disk/by-id/scsi-3600050e00ba4ca00e8d10000380b0000-part1 -&gt; ../../sdc1

/sys/class/scsi_disk/6:0:0:0/device:
block:sdc    driver           iorequest_cnt  rescan           scsi_level  uevent
bus        generic        model          rev           state       vendor
delete        iocounterbits  power          scsi_device:6:0:0:0  subsystem
device_blocked    iodone_cnt     queue_depth    scsi_disk:6:0:0:0    timeout
dh_state    ioerr_cnt      queue_type     scsi_generic:sg2       type

/sys/class/scsi_disk/6:0:1:0/device:
block:sdd    driver           iorequest_cnt  rescan           scsi_level  uevent
bus        generic        model          rev           state       vendor
delete        iocounterbits  power          scsi_device:6:0:1:0  subsystem
device_blocked    iodone_cnt     queue_depth    scsi_disk:6:0:1:0    timeout
dh_state    ioerr_cnt      queue_type     scsi_generic:sg3       type

/sys/class/scsi_disk/7:0:0:0/device:
block:sde    driver           iorequest_cnt  rescan           scsi_level  uevent
bus        generic        model          rev           state       vendor
delete        iocounterbits  power          scsi_device:7:0:0:0  subsystem
device_blocked    iodone_cnt     queue_depth    scsi_disk:7:0:0:0    timeout
dh_state    ioerr_cnt      queue_type     scsi_generic:sg4       type



lspci
02:00.0 RAID bus controller: 3ware Inc 9650SE SATA-II RAID PCIe (rev 01)
04:00.0 RAID bus controller: 3ware Inc 9650SE SATA-II RAID PCIe (rev 01)

lspci -vv

02:00.0 RAID bus controller: 3ware Inc 9650SE SATA-II RAID PCIe (rev 01)
     Subsystem: 3ware Inc 9650SE SATA-II RAID PCIe
     Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr+ Stepping- SERR+ FastB2B-
     Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR-
     Latency: 0, Cache Line Size: 256 bytes
     Interrupt: pin A routed to IRQ 74
     Region 0: Memory at f4000000 (64-bit, prefetchable) [size=32M]
     Region 2: Memory at faddf000 (64-bit, non-prefetchable) [size=4K]
     Region 4: I/O ports at c800 [size=256]
     Expansion ROM at fade0000 [disabled] [size=128K]
     Capabilities: [40] Power Management version 2
         Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
         Status: D0 PME-Enable- DSel=0 DScale=0 PME-
     Capabilities: [50] Message Signalled Interrupts: 64bit+ Queue=0/5 Enable-
         Address: 0000000000000000  Data: 0000
     Capabilities: [70] Express Legacy Endpoint IRQ 0
         Device: Supported: MaxPayload 512 bytes, PhantFunc 0, ExtTag-
         Device: Latency L0s &lt;128ns, L1 &lt;2us
         Device: AtnBtn- AtnInd- PwrInd-
         Device: Errors: Correctable- Non-Fatal- Fatal- Unsupported-
         Device: RlxdOrd+ ExtTag- PhantFunc- AuxPwr- NoSnoop+
         Device: MaxPayload 256 bytes, MaxReadReq 512 bytes
         Link: Supported Speed 2.5Gb/s, Width x8, ASPM L0s L1, Port 0
         Link: Latency L0s &lt;512ns, L1 &lt;64us
         Link: ASPM Disabled RCB 128 bytes CommClk- ExtSynch-
         Link: Speed 2.5Gb/s, Width x8
     Capabilities: [100] Advanced Error Reporting

04:00.0 RAID bus controller: 3ware Inc 9650SE SATA-II RAID PCIe (rev 01)
     Subsystem: 3ware Inc 9650SE SATA-II RAID PCIe
     Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr+ Stepping- SERR+ FastB2B-
     Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR-
     Latency: 0, Cache Line Size: 256 bytes
     Interrupt: pin A routed to IRQ 66
     Region 0: Memory at f6000000 (64-bit, prefetchable) [size=32M]
     Region 2: Memory at faedf000 (64-bit, non-prefetchable) [size=4K]
     Region 4: I/O ports at d800 [size=256]
     Expansion ROM at faee0000 [disabled] [size=128K]
     Capabilities: [40] Power Management version 2
         Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
         Status: D0 PME-Enable- DSel=0 DScale=0 PME-
     Capabilities: [50] Message Signalled Interrupts: 64bit+ Queue=0/5 Enable-
         Address: 0000000000000000  Data: 0000
     Capabilities: [70] Express Legacy Endpoint IRQ 0
         Device: Supported: MaxPayload 512 bytes, PhantFunc 0, ExtTag-
         Device: Latency L0s &lt;128ns, L1 &lt;2us
         Device: AtnBtn- AtnInd- PwrInd-
         Device: Errors: Correctable- Non-Fatal- Fatal- Unsupported-
         Device: RlxdOrd+ ExtTag- PhantFunc- AuxPwr- NoSnoop+
         Device: MaxPayload 256 bytes, MaxReadReq 512 bytes
         Link: Supported Speed 2.5Gb/s, Width x8, ASPM L0s L1, Port 0
         Link: Latency L0s &lt;512ns, L1 &lt;64us
         Link: ASPM Disabled RCB 128 bytes CommClk- ExtSynch-
         Link: Speed 2.5Gb/s, Width x8
     Capabilities: [100] Advanced Error Reporting

[root@rabat1 ~]# cat /sys/class/scsi_host/host7/device/target7\:0\:0/7\:0\:0\:0/model
9650SE-24M DISK
[root@rabat1 ~]# cat /sys/class/scsi_host/host6/device/target6\:0\:0/6\:0\:0\:0/model
9650SE-24M DISK

[root@rabat1 ~]# tw_cli  show

Ctl   Model        (V)Ports  Drives   Units   NotOpt  RRate   VRate  BBU
------------------------------------------------------------------------
c6    9650SE-24M8  24        24       2       1       1       1      OK
c7    9650SE-24M8  24        23       2       2       3       2      OK

[root@rabat1 ~]# tw_cli  /c6 show all
/c6 Driver Version = 2.26.08.003-2.6.18RH
/c6 Model = 9650SE-24M8
/c6 Available Memory = 448MB
/c6 Firmware Version = FE9X 4.10.00.007
/c6 Bios Version = BE9X 4.08.00.002
/c6 Boot Loader Version = BL9X 3.08.00.001
/c6 Serial Number = L323307A0101430
/c6 PCB Version = Rev 032
/c6 PCHIP Version = 2.00
/c6 ACHIP Version = 1.90
/c6 Number of Ports = 24
/c6 Number of Drives = 24
/c6 Number of Units = 2
/c6 Total Optimal Units = 1
/c6 Not Optimal Units = 1
/c6 JBOD Export Policy = off
/c6 Disk Spinup Policy = 1
/c6 Spinup Stagger Time Policy (sec) = 1
/c6 Auto-Carving Policy = off
/c6 Auto-Carving Size = 2048 GB
/c6 Auto-Rebuild Policy = on
/c6 Rebuild Mode = Adaptive
/c6 Rebuild Rate = 1
/c6 Verify Mode = Adaptive
/c6 Verify Rate = 1
/c6 Controller Bus Type = PCIe
/c6 Controller Bus Width = 8 lanes
/c6 Controller Bus Speed = 2.5 Gbps/lane

Unit  UnitType  Status        &#160;%RCmpl &#160;%V/I/M  Stripe  Size(GB)  Cache  AVrfy
------------------------------------------------------------------------------
u0    RAID-6    DEGRADED       -       -       256K    18626.3   RiW    ON
u1    RAID-6    OK             -       -       256K    18626.3   RiW    ON

Port   Status           Unit   Size        Blocks        Serial
---------------------------------------------------------------
p0     OK               u0     1.82 TB     3907029168    WD-WCC4M2PLA6NA
p1     DEVICE-ERROR     u0     1.82 TB     3907029168    MN1220F32LNSND
p2     DEVICE-ERROR     u0     1.82 TB     3907029168    MN1220F32M254D
p3     OK               u0     1.82 TB     3907029168    WD-WCC4M4KCCLCE
p4     OK               u0     1.82 TB     3907029168    MSHH215Q02P01P
p5     OK               u0     1.82 TB     3907029168    WD-WCC4M4KAC0U8
p6     OK               u0     1.82 TB     3907029168    MN1220F32LRD8D
p7     OK               u0     1.82 TB     3907029168    MN5221F305VDRF
p8     OK               u0     1.82 TB     3907029168    MN1220F32M1P1D
p9     OK               u0     1.82 TB     3907029168    MN1220F32HULUD
p10    OK               u0     1.82 TB     3907029168    WD-WCC4M2PLASZL
p11    OK               u0     1.82 TB     3907029168    MN1240F33S13VD
p12    OK               u1     1.82 TB     3907029168    53SB728GS
p13    OK               u1     1.82 TB     3907029168    MN1220F32N5GWD
p14    OK               u1     1.82 TB     3907029168    WD-WCC4M5ELED6P
p15    OK               u1     1.82 TB     3907029168    MN1220F32LLJDD
p16    OK               u1     1.82 TB     3907029168    MN3220F33GWVGE
p17    OK               u1     1.82 TB     3907029168    55CAKBLAS
p18    OK               u1     1.82 TB     3907029168    MN1220F32LLJYD
p19    OK               u1     1.82 TB     3907029168    WD-WCC4M5EEHN06
p20    OK               u1     1.82 TB     3907029168    WD-WCC4M1XX0X8U
p21    OK               u1     1.82 TB     3907029168    MSHH215Q028E7N
p22    OK               u1     1.82 TB     3907029168    MN1220F32LLXKD
p23    OK               u1     1.82 TB     3907029168    MN1220F32LLBUD

Name  OnlineState  BBUReady  Status    Volt     Temp     Hours  LastCapTest
---------------------------------------------------------------------------
bbu   On           Yes       OK        OK       OK       0      xx-xxx-xxxx


[root@rabat1 ~]# tw_cli  /c7 show all
/c7 Driver Version = 2.26.08.003-2.6.18RH
/c7 Model = 9650SE-24M8
/c7 Available Memory = 448MB
/c7 Firmware Version = FE9X 4.10.00.021
/c7 Bios Version = BE9X 4.08.00.003
/c7 Boot Loader Version = BL9X 3.08.00.001
/c7 Serial Number = R323305A8190004
/c7 PCB Version = Rev 032
/c7 PCHIP Version = 2.00
/c7 ACHIP Version = 1.90
/c7 Number of Ports = 24
/c7 Number of Drives = 23
/c7 Number of Units = 2
/c7 Total Optimal Units = 0
/c7 Not Optimal Units = 2
/c7 JBOD Export Policy = off
/c7 Disk Spinup Policy = 1
/c7 Spinup Stagger Time Policy (sec) = 1
/c7 Auto-Carving Policy = off
/c7 Auto-Carving Size = 2048 GB
/c7 Auto-Rebuild Policy = on
/c7 Rebuild Mode = Low Latency
/c7 Rebuild Rate = 3
/c7 Verify Mode = Low Latency
/c7 Verify Rate = 2
/c7 Controller Bus Type = PCIe
/c7 Controller Bus Width = 8 lanes
/c7 Controller Bus Speed = 2.5 Gbps/lane

Unit  UnitType  Status        &#160;%RCmpl &#160;%V/I/M  Stripe  Size(GB)  Cache  AVrfy
------------------------------------------------------------------------------
u0    RAID-6    DEGRADED-INIT  -       0%(A)   256K    39115.3   RiW    ON
u1    UNKNOWN   INOPERABLE     -       -       -       0         Ri     OFF

Port   Status           Unit   Size        Blocks        Serial
---------------------------------------------------------------
p0     OK               u0     1.82 TB     3907029168    MSHH215Q036XZV
p1     OK               u0     1.82 TB     3907029168    MSHH215Q030JEV
p2     OK               u0     1.82 TB     3907029168    MN1220F32LRBZD
p3     OK               u0     1.82 TB     3907029168    MN1220F32M1MDD
p4     OK               u0     1.82 TB     3907029168    MN1240FA18LJSD
p5     NOT-PRESENT      -      -           -             -
p6     OK               u0     1.82 TB     3907029168    55CAYD3AS
p7     OK               u0     1.82 TB     3907029168    MN1220FA0ELMAD
p8     OK               u0     1.82 TB     3907029168    MN1220F32M268D
p9     OK               u0     1.82 TB     3907029168    WD-WCC4M5VX6A61
p10    OK               u0     1.82 TB     3907029168    MN1220F32LAS3D
p11    OK               u0     1.82 TB     3907029168    53SDAJ1AS
p12    OK               u0     1.82 TB     3907029168    MN1220F32LRDKD
p13    OK               u0     1.82 TB     3907029168    MN5210F330LUVK
p14    OK               u0     1.82 TB     3907029168    53SB949AS
p15    OK               u0     1.82 TB     3907029168    WD-WCC4M1FF3C81
p16    SMART-FAILURE    u?     1.82 TB     3907029168    53SB0YAAS
p17    OK               u0     1.82 TB     3907029168    55CB03UAS
/backup1/backup/data3/save_accounts/p18    OK               u0     1.82 TB     3907029168    MN1220F32M37ND
p19    OK               u0     1.82 TB     3907029168    MN1220F32M365D
p20    OK               u0     1.82 TB     3907029168    55CAYBBAS
p21    OK               u0     1.82 TB     3907029168    MN1220F32LD7KD
p22    OK               u0     1.82 TB     3907029168    MN1240FA0BMHSD
p23    OK               u0     1.82 TB     3907029168    55CAYD2AS

Name  OnlineState  BBUReady  Status    Volt     Temp     Hours  LastCapTest
---------------------------------------------------------------------------
bbu   On           Yes       OK        OK       OK       0      xx-xxx-xxxx




[root@rabat1 ~]# du -hs /backup2/*
113G    /backup2/andraz
2,1T    /backup2/bonhenry
3,8T    /backup2/delem
1,2T    /backup2/jgarrec
734G    /backup2/mauracasciola
9,0T    /backup2/mkasimova
55M    /backup2/MOZART
240G    /backup2/RABAT1
1,4T    /backup2/RABAT2

[root@rabat1 ~]# du -hs /backup1/*
16G    /backup1/audreyd
343G    /backup1/backup
12K    /backup1/campomanes
2,0T    /backup1/delem_copy
160G    /backup1/gorkovets
4,4T    /backup1/jgarrec
0    /backup1/Library
0    /backup1/mauracasciola
8,6T    /backup1/mkasimova
9,7G    /backup1/RABAT2
256G    /backup1/rucinska
562G    /backup1/sara
415G    /backup1/sautot
509G    /backup1/schulz
2,0T    /backup1/tarek
164K    /backup1/TW

[root@rabat1 ~]# du -hs /data1/*
937G    /data1/Backup_MEssina_Dec_2015
17T    /data1/backup_rabat2_data

[root@rabat1 ~]# du -hs /data2/*
16T    /data2/backup_rabat2_data

[root@rabat1 ~]# du -hs /data1/backup_rabat2_data/*
1,1T    /data1/backup_rabat2_data/andraz
544G    /data1/backup_rabat2_data/bonhenry
2,1T    /data1/backup_rabat2_data/campomanes
948G    /data1/backup_rabat2_data/jgarrec
2,0T    /data1/backup_rabat2_data/learems
4,4T    /data1/backup_rabat2_data/mauracasciola
58G    /data1/backup_rabat2_data/MEssina-saves
35G    /data1/backup_rabat2_data/michal
99G    /data1/backup_rabat2_data/milena
5,5T    /data1/backup_rabat2_data/mkasimova--
</pre>
<p><br />
</p>
<h1><span class="mw-headline" id="Etude_smartcl">Etude  smartcl</span></h1>
<h2><span class="mw-headline" id="Manual">Manual</span></h2>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
For disks behind 3ware controllers you may need "/dev/sd[a-z]" or "/dev/twe[0-9]" or "/dev/twa[0-9]

smartctl -a -d 3ware,2 /dev/sda
              smartctl -a -d 3ware,0 /dev/twe0
              smartctl -a -d 3ware,1 /dev/twa0
              where  in  the argument 3ware,N, the integer N is the disk number (3ware ´port´) within the 3ware ATA RAID controller.  The allowed values of N are from 0 to
              31 inclusive.  The first two forms, which refer to devices /dev/sda-z and /dev/twe0-15, may be used with 3ware series 6000, 7000, and 8000 series controllers
              that  use  the  3x-xxxx  driver.  Note that the /dev/sda-z form is deprecated starting with the Linux 2.6 kernel series and may not be supported by the Linux
              kernel in the near future. The final form, which refers to devices /dev/twa0-15, must be used with 3ware 9000  series  controllers,  which  use  the  3w-9xxx
              driver.
              Note  that  if  the  special  character  device nodes /dev/twa? and /dev/twe? do not exist, or exist with the incorrect major or minor numbers, smartctl will
              recreate them on the fly.  Typically /dev/twa0 refers to the first 9000-series controller, /dev/twa1 refers to the second 9000 series controller, and so  on.
              Likewise /dev/twe0 refers to the first 6/7/8000-series controller, /dev/twa1 refers to the second 6/7/8000 series controller, and so on.

              Note  that for the 6/7/8000 controllers, any of the physical disks can be queried or examined using any of the 3ware’s SCSI logical device /dev/sd?  entries.
              Thus, if logical device /dev/sda is made up of two physical disks (3ware ports zero and one) and logical device /dev/sdb is made up  of  two  other  physical
              disks  (3ware  ports  two and three) then you can examine the SMART data on any of the four physical disks using either SCSI device /dev/sda or /dev/sdb.  If
              you need to know which logical SCSI device a particular physical disk (3ware port) is associated with, use the dmesg or SYSLOG output to show which  SCSI  ID
              corresponds  to  a  particular  3ware  unit,  and then use the 3ware CLI or 3dm tool to determine which ports (physical disks) correspond to particular 3ware
              units.

              If the value of N corresponds to a port that does not exist on the 3ware controller, or to a port that does not physically have a disk attached  to  it,  the
              behavior  of smartctl depends upon the specific controller model, firmware, Linux kernel and platform.  In some cases you will get a warning message that the
              device does not exist. In other cases you will be presented with ´void´ data for a non-existent device.

              Note that if the /dev/sd? addressing form is used, then older 3w-xxxx drivers do not pass the "Enable Autosave" (´-S on´) and "Enable Automatic Offline" (´-o
              on´) commands to the disk, and produce these types of harmless syslog error messages instead: "3w-xxxx: tw_ioctl(): Passthru size (123392) too big". This can
              be fixed by upgrading to version 1.02.00.037 or later of the 3w-xxxx driver, or by applying a  patch  to  older  versions.  See  http://smartmontools.source-
              forge.net/ for instructions.  Alternatively, use the character device /dev/twe0-15 interface.

              The  selective  self-test  functions  (´-t select,A-B´) are only supported using the character device interface /dev/twa0-15 and /dev/twe0-15.  The necessary
              WRITE LOG commands can not be passed through the SCSI interface.

</pre>
<h2><span class="mw-headline" id="dmesg">dmesg</span></h2>
<pre>
[root@rabat1 ~]# dmesg |grep disk -i
VFS: Disk quotas dquot_6.5.1
md: md driver 0.90.3 MAX_MD_DEVS=256, MD_SB_DISKS=27
sd 0:0:0:0: Attached scsi disk sda
sd 1:0:0:0: Attached scsi disk sdb
  Vendor: AMCC      Model: 9650SE-24M DISK   Rev: 4.10
sd 6:0:0:0: Attached scsi disk sdc
  Vendor: AMCC      Model: 9650SE-24M DISK   Rev: 4.10
sd 6:0:1:0: Attached scsi disk sdd
  Vendor: AMCC      Model: 9650SE-24M DISK   Rev: 4.10
sd 7:0:0:0: Attached scsi disk sde

</pre>
<h2><span class="mw-headline" id="twa0">twa0</span></h2>
<pre>
smartctl --all --device=3ware,2 /dev/twa0
smartctl version 5.38 [x86_64-redhat-linux-gnu] Copyright (C) 2002-8 Bruce Allen
Home page is http://smartmontools.sourceforge.net/

=== START OF INFORMATION SECTION ===
Device Model:     Hitachi HDS723020BLA642
Serial Number:    MN1220F32M254D
Firmware Version: MN6OA5C0
User Capacity:    2,000,398,934,016 bytes
Device is:        Not in smartctl database [for details use: -P showall]
ATA Version is:   8
ATA Standard is:  ATA-8-ACS revision 4
Local Time is:    Fri Jan 19 09:29:05 2018 CET
SMART support is: Available - device has SMART capability.
SMART support is: Enabled
</pre>
<h2><span class="mw-headline" id="twa1">twa1</span></h2>
<pre>
[root@rabat1 ~]# smartctl -i --device=3ware,1 /dev/twa1
smartctl version 5.38 [x86_64-redhat-linux-gnu] Copyright (C) 2002-8 Bruce Allen
Home page is http://smartmontools.sourceforge.net/

=== START OF INFORMATION SECTION ===
Device Model:     Hitachi HDS723020BLE640
Serial Number:    MSHH215Q030JEV
Firmware Version: MX4OAAB0
User Capacity:    2,000,398,934,016 bytes
Device is:        Not in smartctl database [for details use: -P showall]
ATA Version is:   8
ATA Standard is:  ATA-8-ACS revision 4
Local Time is:    Fri Jan 19 09:48:50 2018 CET
SMART support is: Available - device has SMART capability.
SMART support is: Enabled
</pre>
<h2><span class="mw-headline" id="twa2">twa2</span></h2>
<h1><span class="mw-headline" id="tw_cli">tw_cli</span></h1>
<p>tw_cli  help info c6 p0 
</p>
<pre>
[root@rabat1 ~]# tw_cli  help info c6 p0 

  info 
  info c&lt;c&gt; [driver|model|firmware|bios|monitor|serial|pcb|pchip|achip
             numports|numunits|numdrives|unitstatus|drivestatus|allunitstatus
             ondegrade|spinup|stagger]
  info c&lt;c&gt; u&lt;u&gt; [status|rebuildstatus|verifystatus|initializestatus]
  info c&lt;c&gt; p&lt;p&gt; [status|model|serial|capacity|smart|firmware]
  info c&lt;c&gt; diag

[root@rabat1 ~]# tw_cli  info c6 p0 model
/c6/p0 Model = WDC WD20EFRX-68EUZN0

</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="modele_des_disques_controleurs_c6">modele des disques controleurs c6</span></h2>
<pre>
[root@rabat1 ~]# tw_cli info c6  

Unit  UnitType  Status        &#160;%RCmpl &#160;%V/I/M  Stripe  Size(GB)  Cache  AVrfy
------------------------------------------------------------------------------
u0    RAID-6    DEGRADED       -       -       256K    18626.3   RiW    ON     
u1    RAID-6    OK             -       -       256K    18626.3   RiW    ON     

Port   Status           Unit   Size        Blocks        Serial
---------------------------------------------------------------
p0     OK               u0     1.82 TB     3907029168    WD-WCC4M2PLA6NA     
p1     SMART-FAILURE    u0     1.82 TB     3907029168    MN1220F32LNSND      
p2     SMART-FAILURE    u0     1.82 TB     3907029168    MN1220F32M254D      
p3     OK               u0     1.82 TB     3907029168    WD-WCC4M4KCCLCE     
p4     OK               u0     1.82 TB     3907029168    MSHH215Q02P01P      
p5     OK               u0     1.82 TB     3907029168    WD-WCC4M4KAC0U8     
p6     OK               u0     1.82 TB     3907029168    MN1220F32LRD8D      
p7     OK               u0     1.82 TB     3907029168    MN5221F305VDRF      
p8     OK               u0     1.82 TB     3907029168    MN1220F32M1P1D      
p9     OK               u0     1.82 TB     3907029168    MN1220F32HULUD      
p10    OK               u0     1.82 TB     3907029168    WD-WCC4M2PLASZL     
p11    OK               u0     1.82 TB     3907029168    MN1240F33S13VD      
p12    OK               u1     1.82 TB     3907029168    53SB728GS           
p13    OK               u1     1.82 TB     3907029168    MN1220F32N5GWD      
p14    OK               u1     1.82 TB     3907029168    WD-WCC4M5ELED6P     
p15    OK               u1     1.82 TB     3907029168    MN1220F32LLJDD      
p16    OK               u1     1.82 TB     3907029168    MN3220F33GWVGE      
p17    OK               u1     1.82 TB     3907029168    55CAKBLAS           
p18    OK               u1     1.82 TB     3907029168    MN1220F32LLJYD      
p19    OK               u1     1.82 TB     3907029168    WD-WCC4M5EEHN06     
p20    OK               u1     1.82 TB     3907029168    WD-WCC4M1XX0X8U     
p21    OK               u1     1.82 TB     3907029168    MSHH215Q028E7N      
p22    OK               u1     1.82 TB     3907029168    MN1220F32LLXKD      
p23    OK               u1     1.82 TB     3907029168    MN1220F32LLBUD      

Name  OnlineState  BBUReady  Status    Volt     Temp     Hours  LastCapTest
---------------------------------------------------------------------------
bbu   On           Yes       OK        OK       OK       0      xx-xxx-xxxx  

[root@rabat1 ~]# for i in `seq 0 23`; do tw_cli  info c6 p$i model;done
/c6/p0 Model = WDC WD20EFRX-68EUZN0
/c6/p1 Model = Hitachi HDS723020BLA642
/c6/p2 Model = Hitachi HDS723020BLA642
/c6/p3 Model = WDC WD20EFRX-68EUZN0
/c6/p4 Model = Hitachi HDS723020BLE640
/c6/p5 Model = WDC WD20EFRX-68EUZN0
/c6/p6 Model = Hitachi HDS723020BLA642
/c6/p7 Model = Hitachi HDS723020BLA642
/c6/p8 Model = Hitachi HDS723020BLA642
/c6/p9 Model = Hitachi HDS723020BLA642
/c6/p10 Model = WDC WD20EFRX-68EUZN0
/c6/p11 Model = Hitachi HDS723020BLA642
/c6/p12 Model = TOSHIBA DT01ACA200
/c6/p13 Model = Hitachi HDS723020BLA642
/c6/p14 Model = WDC WD20EFRX-68EUZN0
/c6/p15 Model = Hitachi HDS723020BLA642
/c6/p16 Model = Hitachi HDS723020BLA642
/c6/p17 Model = TOSHIBA DT01ACA200
/c6/p18 Model = Hitachi HDS723020BLA642
/c6/p19 Model = WDC WD20EFRX-68EUZN0
/c6/p20 Model = WDC WD20EFRX-68EUZN0
/c6/p21 Model = Hitachi HDS723020BLE640
/c6/p22 Model = Hitachi HDS723020BLA642
/c6/p23 Model = Hitachi HDS723020BLA642
</pre>
<h2><span class="mw-headline" id="modele_des_disques_controleurs_c7">modele des disques controleurs c7</span></h2>
<pre>
[root@rabat1 ~]# tw_cli info c7

Unit  UnitType  Status        &#160;%RCmpl &#160;%V/I/M  Stripe  Size(GB)  Cache  AVrfy
------------------------------------------------------------------------------
u0    RAID-6    REBUILD-INIT   76%(A)  76%(P)  256K    39115.3   RiW    ON     
u1    UNKNOWN   INOPERABLE     -       -       -       0         Ri     OFF    
u2    RAID-6    INOPERABLE     76%(P)  -       256K    39115.3   Ri     ON     

Port   Status           Unit   Size        Blocks        Serial
---------------------------------------------------------------
p0     OK               u0     1.82 TB     3907029168    MSHH215Q036XZV      
p1     OK               u0     1.82 TB     3907029168    MSHH215Q030JEV      
p2     OK               u0     1.82 TB     3907029168    MN1220F32LRBZD      
p3     OK               u0     1.82 TB     3907029168    MN1220F32M1MDD      
p4     OK               u0     1.82 TB     3907029168    MN1240FA18LJSD      
p5     DEGRADED         u0     1.82 TB     3907029168    WD-WCC4M3CNSRKR     
p6     OK               u0     1.82 TB     3907029168    55CAYD3AS           
p7     OK               u0     1.82 TB     3907029168    MN1220FA0ELMAD      
p8     OK               u0     1.82 TB     3907029168    MN1220F32M268D      
p9     OK               u0     1.82 TB     3907029168    WD-WCC4M5VX6A61     
p10    OK               u0     1.82 TB     3907029168    MN1220F32LAS3D      
p11    OK               u0     1.82 TB     3907029168    53SDAJ1AS           
p12    OK               u0     1.82 TB     3907029168    MN1220F32LRDKD      
p13    OK               u0     1.82 TB     3907029168    MN5210F330LUVK      
p14    OK               u0     1.82 TB     3907029168    53SB949AS           
p15    OK               u0     1.82 TB     3907029168    WD-WCC4M1FF3C81     
p16    SMART-FAILURE    u2     1.82 TB     3907029168    53SB0YAAS           
p17    OK               u0     1.82 TB     3907029168    55CB03UAS           
p18    OK               u0     1.82 TB     3907029168    MN1220F32M37ND      
p19    OK               u0     1.82 TB     3907029168    MN1220F32M365D      
p20    OK               u0     1.82 TB     3907029168    55CAYBBAS           
p21    OK               u0     1.82 TB     3907029168    MN1220F32LD7KD      
p22    OK               u0     1.82 TB     3907029168    MN1240FA0BMHSD      
p23    OK               u0     1.82 TB     3907029168    55CAYD2AS           

Name  OnlineState  BBUReady  Status    Volt     Temp     Hours  LastCapTest
---------------------------------------------------------------------------
^[[Abbu   On           Yes       OK        OK       OK       0      xx-xxx-xxxx  

[root@rabat1 ~]# for i in `seq 0 23`; do tw_cli  info c7 p$i model;done
/c7/p0 Model = Hitachi HDS723020BLE640

/c7/p1 Model = Hitachi HDS723020BLE640

/c7/p2 Model = Hitachi HDS723020BLA642

/c7/p3 Model = Hitachi HDS723020BLA642

/c7/p4 Model = Hitachi HDS723020BLA642

/c7/p5 Model = WDC WD20EFRX-68EUZN0

/c7/p6 Model = TOSHIBA DT01ACA200

/c7/p7 Model = Hitachi HDS723020BLA642

/c7/p8 Model = Hitachi HDS723020BLA642

/c7/p9 Model = WDC WD20EFRX-68EUZN0

/c7/p10 Model = Hitachi HDS723020BLA642

/c7/p11 Model = TOSHIBA DT01ACA200

/c7/p12 Model = Hitachi HDS723020BLA642

/c7/p13 Model = Hitachi HDS723020BLA642

/c7/p14 Model = TOSHIBA DT01ACA200

/c7/p15 Model = WDC WD20EFRX-68EUZN0

/c7/p16 Model = TOSHIBA DT01ACA200

/c7/p17 Model = TOSHIBA DT01ACA200

/c7/p18 Model = Hitachi HDS723020BLA642

/c7/p19 Model = Hitachi HDS723020BLA642

/c7/p20 Model = TOSHIBA DT01ACA200

/c7/p21 Model = Hitachi HDS723020BLA642

/c7/p22 Model = Hitachi HDS723020BLA642

/c7/p23 Model = TOSHIBA DT01ACA200

</pre>
<h1><span class="mw-headline" id="Aide">Aide</span></h1>
<pre>

Nazeem's Tech Blog
Linux addiktz

    HOME
    About
    Photo Gallery
    About Me

tw_cli: 3ware Commandline utility

tw_cli:

It is a Command Line Interface Storage Management Software for AMCC/3ware ATA RAID Controller(s). It is a RAID monitoring utility which help to maintain the 3Ware RAID array

We can use this tocheck the health of my 3ware RAID array under any Linux distribution.

We can either run it as as program with its own command line.

—————-

# ./tw_cli

&gt; 

/&gt; show

Ctl Model (V)Ports Drives Units NotOpt RRate VRate BBU

————————————————————————

c2 9550SX-4LP 4 4 2 0 1 1 –

This means controller c2 has 4 drives on 4 ports, and all are working fine sinve NotOpt=0

To get the status of the controller c2

//&gt; info c2

Unit UnitType Status&#160;%RCmpl&#160;%V/I/M Stripe Size(GB) Cache AVrfy

——————————————————————————

u0 RAID-5 OK – – 16K 596.025 ON OFF

u1 SINGLE OK – – – 372.519 ON OFF

Port Status Unit Size Blocks Serial

—————————————————————

p0 OK u0 298.09 GB 625142448 5QF0EKAT

p1 OK u0 298.09 GB 625142448 5QF0EKB6

p2 OK u0 298.09 GB 625142448 5QF0EKPP

p3 OK u1 372.61 GB 781422768 WD-WMAMY1596298

Or wecan run it as a shell utility as follows.

———————

# ./tw_cli show

Ctl Model (V)Ports Drives Units NotOpt RRate VRate BBU

————————————————————————

c2 9550SX-4LP 4 4 2 0 1 1 –

# ./tw_cli info c2

Unit UnitType Status&#160;%RCmpl&#160;%V/I/M Stripe Size(GB) Cache AVrfy

——————————————————————————

u0 RAID-5 OK – – 16K 596.025 ON OFF

u1 SINGLE OK – – – 372.519 ON OFF

Port Status Unit Size Blocks Serial

—————————————————————

p0 OK u0 298.09 GB 625142448 5QF0EKAT

p1 OK u0 298.09 GB 625142448 5QF0EKB6

p2 OK u0 298.09 GB 625142448 5QF0EKPP

p3 OK u1 372.61 GB 781422768 WD-WMAMY1596298

root@pi [/usr/local/ysa/bin]#

To get a detailed output , we use the command as follows.

  ./tw_cli info c2 u0 

--------------

# ./tw_cli info c2 u0

Unit UnitType Status&#160;%RCmpl&#160;%V/I/M Port Stripe Size(GB)

————————————————————————

u0 RAID-5 OK – – – 16K 596.025

u0-0 DISK OK – – p2 – 298.013

u0-1 DISK OK – – p1 – 298.013

u0-2 DISK OK – – p0 – 298.013

————————-

Here u0-0 means unit u0, port p0

The above outputs show there are 4 drives in our RAID array, Our array has two units – u0, u1.

Check the below output:

./tw_cli info

Ctl Model (V)Ports Drives Units NotOpt RRate VRate BBU

————————————————————————

c0 8006-2LP 2 2 1 1 3 – –

This means controller c0 has two drives on two ports, one of which has a problem(NotOpt=1).

./tw_cli info c0

Unit UnitType Status&#160;%RCmpl&#160;%V/I/M Stripe Size(GB) Cache AVrfy

——————————————————————————

u0 RAID-1 DEGRADED – – – 139.735 ON –

Port Status Unit Size Blocks Serial

—————————————————————

p0 DEGRADED u0 139.73 GB 293046768 WD-WMAP41084290

p1 OK u0 139.73 GB 293046768 WD-WXC0CA9D2877

Status of the unit uo is DEGRADED

To get the more details.

./tw_cli info c0 u0

we get a slightly different result

Unit UnitType Status&#160;%RCmpl&#160;%V/I/M Port Stripe Size(GB)

————————————————————————

u0 RAID-1 DEGRADED – – – – 139.735

u0-0 DISK DEGRADED – – – – 139.735

u0-1 DISK OK – – p1 – 139.735

from the it is clear that the disk on port p0 is itself degraded.

This probably means it has errors, but it may just mean it has stopped working properly for another reason, so it may be worth trying to rebuild the array again as follows. Sometimes a rescan will bring the drive back into the array.

./tw_cli maint remove c0 p0

This removes the degraded disk from the array, producing the following output

Removing port /c0/p0 … Done.

If we now run:

 ./tw_cli info c0 u0

we get a slightly different result

Unit UnitType Status&#160;%RCmpl&#160;%V/I/M Port Stripe Size(GB)

————————————————————————

u0 RAID-1 DEGRADED – – – – 139.735

u0-0 DISK DEGRADED – — – – 139.735

u0-1 DISK OK – – p1 – 139.735

The only difference here is that disk u0-0 is no longer assigned to port 0. Now you have to find the disk again…

./tw_cli maint rescan c0

Gives the bleak output:

Rescanning controller /c0 for units and drives …Done.
Found the following unit(s): [none].
Found the following drive(s): [none].

This suggests it hasn’t just lost track of the disk, but it really has failed. It may be unseated of course, so get someone to remove it and plug it in again, if possible. Trying the following:

./tw_cli maint remove c0 p0

Gives the output:

Removing port /c0/p0 … Failed.
(0x0B:0x002E): Port empty

Yes. It’s really not there, and it really can’t find it. So either it has become unseated or it is dead.

Another meaning for NOT-PRESENT might be that there is a disk there but it hasn’t been added to any array, or it has failed and is therefore not part of an array, but is still okay. In that case do this:

./tw_cli /c0/p0 export

This comes back with:

Removing /c0/p0 will take the disk offline.
Do you want to continue&#160;? Y|N [N]:

Respond Y and if the disk is okay, you’ll get:

Exporting port /c0/p0 … Done.

Then you can add it to the array again with a maint rescan followed by a maint rebuild.

In our case it responded with:

Removing port /c0/p0 … Failed.
(0x0B:0x002E): Port empty

Which confirms the deadness of the disk.

To check CLI version

//pi&gt; show ver

CLI Version = 2.01.09.004

API Version = 2.06.01.006

//pi&gt;

Resacn &amp; rebuild a DEGRADED RAID array.

tw_cli maint rescan c0
Rescanning controller /c0 for units and drives …Done.
Found the following unit(s): [none].
Found the following drive(s): [/c0/p0].

    tw_cli
    //localhost&gt; focus /c0/u1
    //localhost/c0/u1&gt; show all
    /c0/u1 status = DEGRADED
    /c0/u1 is not rebuilding, its current state is DEGRADED
    /c0/u1 is not verifying, its current state is DEGRADED
    /c0/u1 is not initializing. Its current state is DEGRADED

Unit UnitType Status&#160;%Cmpl Port Stripe Size(GB) Blocks
———————————————————————–
u1 RAID-1 DEGRADED – – – 111.79 234439600
u1-0 DISK DEGRADED – – – 111.79 234439600
u1-1 DISK OK – p1 – 111.79 234439600

//localhost/c0/u1&gt; maint rebuild c0 u1 p0
Sending rebuild start request to /c0/u1 on 1 disk(s) [0] … Done.

//localhost/c0/u1&gt; show

Unit UnitType Status&#160;%Cmpl Port Stripe Size(GB) Blocks
———————————————————————–
u1 RAID-1 OK – – – 111.79 234439600
u1-0 DISK OK – p0 – 111.79 234439600
u1-1 DISK OK – p1 – 111.79 234439600
Advertisements
Report this ad
Report this ad
Related

3ware RAID maintenance with tw_cliIn "General"

Hard Disk Not Showing in fdisk after replacement.In "General"

Megaraid commandsIn "General"

2012
    02/09
CATEGORY
    General
    RAID
TAGS
    RAID
Write comment

    Write comment
    Comments RSS

    Trackback ( 0 )
    Comments ( 0 )

Leave a Reply
Linux addiktz
Change this sentence and title from admin Theme option page.
RSS FEED
TAG LIST
Hit Counter

    118,516 hits

Categories
Categories
Cloud
Apache Bash Cloud Linux cPanel/WHM CSF DDOS deflate Exim ext3/ext4 Iptables Kernel Linux ModSec MySQL Nagios Named OpenVZ PHP PostgreSQL R1soft RAID RDNS Rkhunter Scripts SELinux Software Installations SSH SVN VPN WordPress
Freemarket.com Marketplace
February 2012 M 	T 	W 	T 	F 	S 	S
«&#160;Jan
	  	
Mar&#160;»
 	1	2	3	4	5
6	7	8	
9
	
10
	11	12
13	14	
15
	16	17	18	19
20	21	
22
	23	24	25	
26
27	28	29 	 
Recent Comments
	Seemab Saleem on Increase /tmp Partition Size i…
	Tanner Williamson on Commands to Check SSL cert’s v…
	Tanner Williamson on Commands to Check SSL cert’s v…
	Sagar Desai on How to Fix /cgi-sys/defaultweb…
	Hans B. (@hanscoach) on Htscanner Install for enabling…
Top Clicks

    pecl.php.net/get/htscanne…
    domain.com:2086

Archives
Archives
Recent Posts

    Grub re-install
    Install and patch Nethog
    MySQL repair
    Df -h and du showing different result
    Dns issue rndc: connect failed: 127.0.0.1#953: connection refused

Flickr Photos
Ice Tree
Zoz enjoying his morning walk
Room for two
Kånken
Camion
Desert sand dunes in the Tibetan Himalayas, Tibet 2017
_D2_4743.jpg
snow fall
Highland Stag
Great Blue Heron Nest
More Photos
Pages

    About
    About Me
    Photo Gallery

Create a free website or blog at WordPress.com.
:)
</pre>




</body></html>