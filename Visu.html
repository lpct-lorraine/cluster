<html>
<head><title>Visu</title></head>
<body>
<h1>Visu</h1><p><br />
You can use a dedicated VM (visa1 or visa2) with a real GPU to run pymol or VMD
</p><p><br />
</p><p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Pymol"><span class="tocnumber">1</span> <span class="toctext">Pymol</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#VMD"><span class="tocnumber">2</span> <span class="toctext">VMD</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Troubleshooting"><span class="tocnumber">3</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#no_display"><span class="tocnumber">3.1</span> <span class="toctext">no display</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#check_nvidia"><span class="tocnumber">3.2</span> <span class="toctext">check nvidia</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#seg_fault_after_OS_update"><span class="tocnumber">3.3</span> <span class="toctext">seg fault after  OS update</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#tips"><span class="tocnumber">3.4</span> <span class="toctext">tips</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="Pymol">Pymol</span></h1>
<p>To run pymol&#160;:
</p>
<ul><li> open an x2go session on your frontend machine</li>
<li> open a terminal</li>
<li> load the module visu/std&#160;:  </li></ul>
<pre>
$ module load visu/std
</pre>
<ul><li> execute directly from your terminal the pymol command&#160;:</li></ul>
<pre>
$ pymol
</pre>
<p>You should get&#160;:
</p>
<pre>
[fpascale@visa1 ~]$ vglrun /opt/pymol-svn/pymol
 PyMOL(TM) Molecular Graphics System, Version 1.9.0.0.
 Copyright (c) Schrodinger, LLC.
 All Rights Reserved.
 
    Created by Warren L. DeLano, Ph.D. 
 
    PyMOL is user-supported open-source software.  Although some versions
    are freely available, PyMOL is not in the public domain.
 
    If PyMOL is helpful in your work or study, then please volunteer 
    support for our ongoing efforts to create open and affordable scientific
    software by purchasing a PyMOL Maintenance and/or Support subscription.

    More information can be found at "http://www.pymol.org".
 
    Enter "help" for a list of commands.
    Enter "help &lt;command-name&gt;" for information on a specific command.

 Hit ESC anytime to toggle between text and graphics.

 Detected OpenGL version 2.0 or greater. Shaders available.
 Detected GLSL version 4.60.
 OpenGL graphics engine:
  GL_VENDOR:   NVIDIA Corporation
  GL_RENDERER: Quadro K620/PCIe/SSE2
  GL_VERSION:  4.6.0 NVIDIA 450.66
 Adapting to Quadro hardware.

</pre>
<h1><span class="mw-headline" id="VMD">VMD</span></h1>
<p>To run VMD&#160;:
</p>
<ul><li> open an x2go session on your frontend machine</li>
<li> open a terminal</li>
<li> load the module visu/std&#160;:  </li></ul>
<pre>
$ module load visu/std
</pre>
<ul><li> follow the 2 following steps&#160;:</li></ul>
<pre>
$ connect-visa1

$ vmd
</pre>
<p>You should get the following output&#160;:
</p>
<pre>
Info) VMD for LINUXAMD64, version 1.9.3 (November 30, 2016)
Info) http://www.ks.uiuc.edu/Research/vmd/                        
Info) Email questions and bug reports to vmd@ks.uiuc.edu          
Info) Please include this reference in published work using VMD:  
Info)    Humphrey, W., Dalke, A. and Schulten, K., `VMD - Visual  
Info)    Molecular Dynamics', J. Molec. Graphics 1996, 14.1, 33-38.
Info) -------------------------------------------------------------
Info) Multithreading available, 4 CPUs detected.
Info)   CPU features: SSE2 AVX AVX2 FMA
Info) Free system memory: 7556MB (96%)
Info) Creating CUDA device pool and initializing hardware...
Info) Detected 1 available CUDA accelerator:
Info) [0] Quadro K620         3 SM_5.0 @ 1.12 GHz, 2.0GB RAM, KTO, AE1, ZCP
Info) OpenGL renderer: Mesa GLX Indirect
Info)   Features: STENCIL MDE MTX PP PS
Info)   GLSL rendering mode is NOT available.
Info)   Textures: 2-D (2048x2048), Multitexture (8)
Info) Detected 1 available TachyonL/OptiX ray tracing accelerator
Info)   Compiling 1 OptiX shaders on 1 target GPU...
Info) Dynamically loaded 2 plugins in directory:
Info) /opt/vmd/lib/plugins/LINUXAMD64/molfile 
</pre>
<h1><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h1>
<h2><span class="mw-headline" id="no_display">no display</span></h2>
<p>Sometimes you can get an error of type&#160;:
</p>
<pre>
[VGL] ERROR: Could not open display&#160;:0
 PyMOL: abrupt program termination.
</pre>
<p>It's necessary to start the lightdm service on visa[12] VM. Ask to the administrator.
</p>
<pre>
sudo systemctl restart lightdm
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="check_nvidia">check nvidia</span></h2>
<pre>
[fpascale@visa1 X11]# nvidia-smi 
Tue Nov 10 08:43:45 2020       
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 450.66       Driver Version: 450.66       CUDA Version: 11.0     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  Quadro K620         Off  | 00000000:00:06.0 Off |                  N/A |
| 34%   38C    P8     1W /  30W |     20MiB /  2002MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
                                                                               
+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|    0   N/A  N/A     30041      G   /usr/bin/X                         18MiB |
+-----------------------------------------------------------------------------+
</pre>
<h2><span class="mw-headline" id="seg_fault_after_OS_update">seg fault after  OS update</span></h2>
<p>After an OS update, the nvidia driver could give a "Segmentation fault" error.
</p>
<pre>
sh ./NVIDIA-Linux-x86_64-450.66.run  --uninstall
yum  reinstall xorg-x11-server-Xorg xorg-x11-server-common
sh /root/NVIDIA-Linux-x86_64-450.66.run -a
</pre>
<p>On visa1 and visa2, we haven't an attached screen  
</p>
<pre>
nvidia-xconfig --use-display-device=none --busid="PCI:0:6:0"
</pre>
<p>The /etc/X11/xorg.conf configuration file&#160;:
</p>
<pre>
# nvidia-xconfig: X configuration file generated by nvidia-xconfig
# nvidia-xconfig:  version 450.66


Section "ServerLayout"
    Identifier     "Layout0"
    Screen      0  "Screen0" 0 0
    InputDevice    "Keyboard0" "CoreKeyboard"
    InputDevice    "Mouse0" "CorePointer"
EndSection

Section "Files"
EndSection

Section "InputDevice"

    # generated from default
    Identifier     "Mouse0"
    Driver         "mouse"
    Option         "Protocol" "auto"
    Option         "Device" "/dev/input/mice"
    Option         "Emulate3Buttons" "no"
    Option         "ZAxisMapping" "4 5"
EndSection

Section "InputDevice"

    # generated from default
    Identifier     "Keyboard0"
    Driver         "kbd"
EndSection

Section "Monitor"
    Identifier     "Monitor0"
    VendorName     "Unknown"
    ModelName      "Unknown"
    HorizSync       28.0 - 33.0
    VertRefresh     43.0 - 72.0
    Option         "DPMS"
EndSection

Section "Device"
    Identifier     "Device0"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    BusID          "PCI:0:6:0"
EndSection

Section "Screen"
    Identifier     "Screen0"
    Device         "Device0"
    Monitor        "Monitor0"
    DefaultDepth    24
    Option         "UseDisplayDevice" "none"
    SubSection     "Display"
        Depth       24
    EndSubSection
EndSection

</pre>
<h2><span class="mw-headline" id="tips">tips</span></h2>
<pre>
systemctl stop firewalld
vglserver_config -config +s +f -t
systemctl restart lightdm

</pre>




</body></html>