<html>
<head><title>Modules</title></head>
<body>
<h1>Modules</h1><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#What_are_Environment_Modules.3F"><span class="tocnumber">1</span> <span class="toctext">What are Environment Modules?</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#modulefiles"><span class="tocnumber">2</span> <span class="toctext">modulefiles</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#root_for_a_particular_version"><span class="tocnumber">2.1</span> <span class="toctext">root for a particular version</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Installing"><span class="tocnumber">3</span> <span class="toctext">Installing</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Installing_Environment_Modules_on_Linux_using_yum"><span class="tocnumber">3.1</span> <span class="toctext">Installing Environment Modules on Linux using yum</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Installing_Environment_Modules_on_Linux_from_source"><span class="tocnumber">3.2</span> <span class="toctext">Installing Environment Modules on Linux from source</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#External_links"><span class="tocnumber">4</span> <span class="toctext">External links</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Installation_sur_le_serveur_NFS_du_cluster"><span class="tocnumber">5</span> <span class="toctext">Installation sur le serveur NFS du cluster</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Intel_compiler"><span class="tocnumber">6</span> <span class="toctext">Intel compiler</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Bash_error"><span class="tocnumber">6.1</span> <span class="toctext">Bash error</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="What_are_Environment_Modules.3F">What are Environment Modules?</span></h2>
<p>The Environment Modules package provides for the dynamic modification of a user's environment via modulefiles.
</p><p>Each modulefile contains the information needed to configure the shell for an application. Once the Modules package is initialized, the environment can be modified on a per-module basis using the module command which interprets modulefiles. Typically modulefiles instruct the module command to alter or set shell environment variables such as PATH, MANPATH, etc. modulefiles may be shared by many users on a system and users may have their own collection to supplement or replace the shared modulefiles.
</p><p>Modules can be loaded and unloaded dynamically and atomically, in an clean fashion. All popular shells are supported, including bash, ksh, zsh, sh, csh, tcsh, as well as some scripting languages such as perl and python.
</p><p>Modules are useful in managing different versions of applications. Modules can also be bundled into metamodules that will load an entire suite of different applications.
</p>
<h2><span class="mw-headline" id="modulefiles">modulefiles</span></h2>
<p>The modules system is based on modulefiles,[6] which specify groups of environment settings that need to be made together. Modulefiles can be installed in a central location for general use, or in a user directory for personal use. Environment Modules modulefiles are written in the Tcl (Tool Command Language) and are interpreted by the modulecmd program via the module[7] user interface.
</p><p>The key advantage of Environment Modules is that it is shell independent and supports all major shells such as bash, ksh, zsh, sh, tcsh, and csh. The second key advantage is that it allows to use multiple versions of the program or package from the same account by just loading proper module. Those two advantages were instrumental in making Environment Modules a part of most HPC cluster setups. It also inspired several alternative implementation such as lmod from University of Texas, which is written in LUA instead of TCL.
</p><p>modulefiles are created on per application per version basis. They can be dynamically loaded, unloaded, or switched. Along with the capability of using multiple versions of the same software it also can be used to implement site policies regarding the access and use of applications
</p><p>Decide where you will place your local module files and the root for the module package.  It should be a file system separate from your system root, else it may get wiped out with every OS upgrade.
The default is /usr/local/Modules/modulefiles/. You will use the <b>--with-module-path=&lt;path&gt;</b> option to the configure script to set this directory.  The default is $prefix/Modules/modulefiles, where $prefix is set by the the --prefix configure option.  (The default is /usr/local.) After the initial hardwork of getting the module commandworking, all of your future effort will be in maintaining the modulefiles themselves.
</p><p><br />
</p>
<h3><span class="mw-headline" id="root_for_a_particular_version">root for a particular version</span></h3>
<p>The root for a particular version of modules should have an indicative name, such as /usr/local/Modules/3.1.6/. Once the installation is done, put a symbolic link in the
/usr/local/Modules directory named default pointing to the version (e.g. "cd /usr/local/Modules; ln -s 3.1.6 default"). The default path to the installation directory is /usr/local.  It is NOT recommended to keep this default!
</p>
<h2><span class="mw-headline" id="Installing">Installing</span></h2>
<h3><span class="mw-headline" id="Installing_Environment_Modules_on_Linux_using_yum">Installing Environment Modules on Linux using yum</span></h3>
<p>On Scientific Linux, CentOS, and RHEL distributions Environment Modules is in the environment-modules package which can be installed with:
</p><p>sudo yum install environment-modules
</p><p>Once installed the package information can be viewed with:
</p><p>rpm -qi environment-modules
rpm -ql environment-modules
</p><p><br />
</p>
<h3><span class="mw-headline" id="Installing_Environment_Modules_on_Linux_from_source">Installing Environment Modules on Linux from source</span></h3>
<p>Although installing from a Linux distributions repository using that distributions update manager is the easiest the software can be installed from source. Resolve dependencies is the most difficult task for an installation from source. The typical configure, make, install cycle can become painfully slow as each configure improvement reveals another dependency not available in your default environment. This section includes the steps to install the Environment Modules package on source including compiling the Tcl (Tool Command Language) from source as a dependency.
</p>
<pre>   Installing Environment Modules
</pre>
<p><b>8.6.1 version of Tcl (Tool Command Language) built from /usr/local/src</b>
</p><p>Although the PCLinuxOS 64-bit repositories include Tcl (Tool Command Language) they do not include a development package with the configuration files required to build Environment Modules on Linux from source. Building Tcl from source will make the required files available.
</p><p>Tcl Source: <a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://sourceforge.net/projects/tcl/files/Tcl/">http://sourceforge.net/projects/tcl/files/Tcl/</a>
</p><p>Extract source after downloading
</p>
<pre>cd /usr/local/src
tar -xvzf ~/Downloads/tcl8.6.1-src.tar.gz
</pre>
<p>Configure, make, install
</p>
<pre>cd /usr/local/src/tcl8.6.1
unix/configure
make
sudo make install
</pre>
<p><b>3.2.10 version of modules built from /usr/local/src</b>
</p><p>Extract source after downloading
</p>
<pre>cd /opt
tar -xvzf ~/Downloads/modules-3.2.10.tar.gz
</pre>
<p>Configure, make, install
</p>
<pre>cd /opt/modules-3.2.10
</pre>
<p><b> To specify where the module files are located, AND to install the binaries/man pages elsewhere (you probably</b>
do, since that is what modules is good for!), the two relevant options you must specify for configure are --with-module-path and
--prefix&#160;: 
</p>
<pre>./configure --with-module-path=/auto/soft/ --prefix=/opt/
make
sudo make install
</pre>
<p>Sur EXPLOR
</p>
<pre>./configure --with-module-path=/cm/shared/modulefiles  --prefix=/cm/local/apps/environment-modules
</pre>
<h2><span class="mw-headline" id="External_links">External links</span></h2>
<p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://en.wikipedia.org/wiki/Environment_Modules_%28software%29">https://en.wikipedia.org/wiki/Environment_Modules_%28software%29</a>
</p><p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://lmod.sourceforge.net">http://lmod.sourceforge.net</a> - alternative implementation using LUA instead of Tcl
</p><p><br />
</p>
<h2><span class="mw-headline" id="Installation_sur_le_serveur_NFS_du_cluster">Installation sur le serveur NFS du cluster</span></h2>
<pre>
yum install Lmod
</pre>
<p><br />
Ajouter une ligne dans <b>/etc/auto.auto</b> avec <b>soft                                &#160;:/backup/soft</b> 
</p>
<pre>yum install gcc tcl tclx tcl-devel
cd /auto/soft
./configure --with-module-path=/auto/soft/modulefiles --prefix=/opt/environment-modules
make
sudo make install
cd /opt/environment-modules/Modules/
ln -s 3.2.10 default
ln -s /opt/environment-modules/Modules/default/init/csh /etc/profile.d/modules.csh
ln -s /opt/environment-modules/Modules/default/init/sh /etc/profile.d/modules.sh
</pre>
<h1><span class="mw-headline" id="Intel_compiler">Intel compiler</span></h1>
<p>The 'env2' utility executes a script, capturing the changes it makes to the environment, and echoes those env vars and settings in a format suitable for a modulefile.  This output can be captured to create your module file. in order to get the correct information you will need to redirect the output from stdout to a file. 
</p><p>The 'env2' utility can be found at  <a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://env2.sourceforge.net/">http://env2.sourceforge.net/</a>
Creating a module file for any Intel Development Tool:
</p><p>First you place a special comment at the beginning of the file so that module will recognize it as a module file with following command:
</p>
<pre>
echo "#%Module" &gt; my_module_file
&lt;/pre

then you will need to use the env2 command like below, for example:

&lt;pre&gt;
perl env2 -from bash -to modulecmd "[install-dir]/parallel_studio_xe_201m.0.nnn/psxevars.sh &lt;intel64|ia-32&gt;" &gt;&gt; my_module_file 
</pre>
<p>This will create a module file that has all the correct information need to run the compiler and tools correctly. 
</p><p>Now following the 'module' instructions to use the compiler tools through module file.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Bash_error">Bash error</span></h2>
<pre>Also have this problem in a wrapper script that uses

qsub -shell no -b yes -cwd -V somescript.bash arg1 arg2 etc

if you use it to submit another bash shell script. It produces the annonying

/bin/sh: module: line 1: syntax error: unexpected end of file
/bin/sh: error importing function definition for `BASH_FUNC_module'

(this is Sun Grid Engine 211.11 running on CentOS 6.6) Turns out things are solved by simply putting the following on top of the wrapper script (not of the wrapped script):

unset module

</pre>




</body></html>