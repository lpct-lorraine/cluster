<html>
<head><title>Caracterisation</title></head>
<body>
<h1>Caracterisation</h1><p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#R.C3.A9seau"><span class="tocnumber">1</span> <span class="toctext">Réseau</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#iperf"><span class="tocnumber">1.1</span> <span class="toctext">iperf</span></a>
<ul>
<li class="toclevel-3 tocsection-3"><a href="#Fonctionnement"><span class="tocnumber">1.1.1</span> <span class="toctext">Fonctionnement</span></a></li>
<li class="toclevel-3 tocsection-4"><a href="#Pr.C3.A9vention_d.27attaque_DDOS"><span class="tocnumber">1.1.2</span> <span class="toctext">Prévention d'attaque DDOS</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-5"><a href="#Latence"><span class="tocnumber">1.2</span> <span class="toctext">Latence</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Syst.C3.A8me"><span class="tocnumber">2</span> <span class="toctext">Système</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#htop"><span class="tocnumber">2.1</span> <span class="toctext">htop</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="R.C3.A9seau">Réseau</span></h1>
<h2><span class="mw-headline" id="iperf">iperf</span></h2>
<p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://iperf.fr/iperf-doc.php">https://iperf.fr/iperf-doc.php</a>
</p>
<h3><span class="mw-headline" id="Fonctionnement">Fonctionnement</span></h3>
<p>Tests iperf dans la fenêtre côté client et dans celle côté serveur il y a des différence de débit.
</p>
<pre>=&gt; l’émetteur va envoyer plus de données que la capacité du tuyau&#160;: il remplit les buffers, c'est ce qui permet à l'algorithme de congestion TCP de déterminer le débit du lien.
</pre>
<p>Pour éviter ce problème, iPerf3 à une option bien pratique&#160;: l'option -O (-O, --omit n    Omit the first n seconds of the test, to skip past the TCP slow-start period)
</p><p>Voici une ligne de commande pour tester le débit en download pendant 10 secondes en excluant les 3 premières secondes du test&#160;: iperf3 -c 193.50.239.65 -p 5202 -t 10 -R -P 10 -O 3
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
 [root@arnor fpascale]# firewall-cmd --zone=public --add-rich-rule='rule family="ipv4" source address="193.50.239.70" port protocol="tcp" port="5001" log prefix="iperf" level="info" limit value="1/s" accept'
 [root@arnor fpascale]# iperf -s
 ------------------------------------------------------------
 Server listening on TCP port 5001
 TCP window size: 85.3 KByte (default)

 [fpascale@tetra fpascale]$ firewall-cmd --zone=public --add-rich-rule='rule family="ipv4" source address="193.50.239.65" port protocol="tcp" port="36666" log prefix="iperf" level="info" limit value="1/s" accept'
 [fpascale@tetra fpascale]$ iperf -c 193.50.239.65 -p 5001 -t 10 -R -P 10
 ------------------------------------------------------------
Client connecting to 193.50.239.65, TCP port 5001
TCP window size: 85.0 KByte (default)
------------------------------------------------------------
[ 12] local 193.50.239.70 port 36484 connected with 193.50.239.65 port 5001
[  3] local 193.50.239.70 port 36468 connected with 193.50.239.65 port 5001
[  8] local 193.50.239.70 port 36472 connected with 193.50.239.65 port 5001
[  4] local 193.50.239.70 port 36466 connected with 193.50.239.65 port 5001
[  6] local 193.50.239.70 port 36470 connected with 193.50.239.65 port 5001
[  5] local 193.50.239.70 port 36474 connected with 193.50.239.65 port 5001
[  7] local 193.50.239.70 port 36476 connected with 193.50.239.65 port 5001
[ 10] local 193.50.239.70 port 36480 connected with 193.50.239.65 port 5001
[  9] local 193.50.239.70 port 36478 connected with 193.50.239.65 port 5001
[ 11] local 193.50.239.70 port 36482 connected with 193.50.239.65 port 5001
[ ID] Interval       Transfer     Bandwidth
[  4]  0.0-10.0 sec   112 MBytes  94.2 Mbits/sec
[  6]  0.0-10.0 sec   112 MBytes  94.2 Mbits/sec
[  5]  0.0-10.0 sec   112 MBytes  94.2 Mbits/sec
[  7]  0.0-10.0 sec   112 MBytes  94.1 Mbits/sec
[ 11]  0.0-10.0 sec   112 MBytes  94.2 Mbits/sec
[ 12]  0.0-10.0 sec   112 MBytes  94.2 Mbits/sec
[  3]  0.0-10.0 sec   112 MBytes  94.2 Mbits/sec
[ 10]  0.0-10.0 sec   112 MBytes  94.2 Mbits/sec
[  9]  0.0-10.0 sec   113 MBytes  94.2 Mbits/sec
[  8]  0.0-10.0 sec   113 MBytes  94.3 Mbits/sec
[SUM]  0.0-10.0 sec  1.10 GBytes   940 Mbits/sec

 [fpascale@tetra fpascale]$firewall-cmd --reload

Nouvelle session

[root@arnor fpascale]# iperf -s -i 2
------------------------------------------------------------
Server listening on TCP port 5001
TCP window size: 85.3 KByte (default)
------------------------------------------------------------
[  4] local 193.50.239.65 port 5001 connected with 193.50.239.70 port 36938
[ ID] Interval       Transfer     Bandwidth
[  4]  0.0- 2.0 sec   223 MBytes   936 Mbits/sec
[  4]  2.0- 4.0 sec   223 MBytes   937 Mbits/sec
[  4]  0.0- 4.0 sec   449 MBytes   936 Mbits/sec
------------------------------------------------------------
Client connecting to 193.50.239.70, TCP port 5001
TCP window size:  221 KByte (default)
------------------------------------------------------------
[  4] local 193.50.239.65 port 54861 connected with 193.50.239.70 port 5001
[  4]  0.0- 2.0 sec   224 MBytes   938 Mbits/sec
[  4]  2.0- 4.0 sec   223 MBytes   935 Mbits/sec
[  4]  0.0- 4.0 sec   447 MBytes   936 Mbits/sec

[fpascale@tetra fpascale]$ sudo firewall-cmd --zone=external --add-rich-rule='rule family="ipv4" source address="193.50.239.65" port protocol="tcp" port="5001" log prefix="iperf" level="info" limit value="1/s" accept'
success
[fpascale@tetra fpascale]$ iperf -c 193.50.239.65 -i 2 -t 4 -r 
------------------------------------------------------------
Server listening on TCP port 5001
TCP window size: 85.3 KByte (default)
------------------------------------------------------------
------------------------------------------------------------
Client connecting to 193.50.239.65, TCP port 5001
TCP window size:  510 KByte (default)
------------------------------------------------------------
[  5] local 193.50.239.70 port 36938 connected with 193.50.239.65 port 5001
[ ID] Interval       Transfer     Bandwidth
[  5]  0.0- 2.0 sec   225 MBytes   943 Mbits/sec
[  5]  2.0- 4.0 sec   224 MBytes   939 Mbits/sec
[  5]  0.0- 4.0 sec   449 MBytes   939 Mbits/sec
[  4] local 193.50.239.70 port 5001 connected with 193.50.239.65 port 54861
[  4]  0.0- 2.0 sec   223 MBytes   934 Mbits/sec
[  4]  2.0- 4.0 sec   223 MBytes   935 Mbits/sec
[  4]  0.0- 4.0 sec   447 MBytes   934 Mbits/sec
[fpascale@tetra fpascale]$ sudo firewall-cmd --reload

[root@arnor fpascale]# firewall-cmd --reload
success
</pre>
<h3><span class="mw-headline" id="Pr.C3.A9vention_d.27attaque_DDOS">Prévention d'attaque DDOS</span></h3>
<p>Suite à des abus (il est facile de faire un DDOS avec Iperf sur sa propre IP et avec des débits de 10 Gb/s cela peut impacter beaucoup plus qu'un client, mais un NRA entier ou en hébergement plusieurs baies de serveurs), j'ai désactivé l'UDP.
</p><p>Voici les 2 règles à rajouter dans le fichier /etc/rc.local&#160;: (je suppose que le serveur n'a pas de script iptables)
Code: [Sélectionner]
</p><p>/sbin/iptables -A INPUT -p udp --dport 5201:5209 -j DROP
/sbin/iptables -A OUTPUT -p udp --dport 5201:5209 -j DROP
/home/scripts/restart_iperf.sh
</p>
<h2><span class="mw-headline" id="Latence">Latence</span></h2>
<ul><li> Latency?</li></ul>
<p>Bandwidth is just one element of what a person perceives as the speed of a network. Latency is another element that contributes to network speed. The term latency refers to any of several kinds of delays typically incurred in processing of network data. A so-called low latency network connection is one that generally experiences small delay times, while a high latency connection generally suffers from long delays.
</p>
<ul><li> Latency vs. Bandwidth</li></ul>
<p>Although the theoretical peak bandwidth of a network connection is fixed according to the technology used, the actual bandwidth you will obtain varies over time and is affected by high latencies. Excessive latency creates bottlenecks that prevent data from filling the network pipe, thus decreasing effective bandwidth. The impact of latency on network bandwidth can be temporary
</p>
<ul><li> Measuring Network Latency</li></ul>
<p>Network tools like ping tests and traceroute measure latency by determining the time it takes a given network packet to travel from source to destination and back, the so-called round-trip time. Round-trip time is not the only way to specify latency, but it is the most common.
On DSL or cable Internet connections, latencies of less than 100 milliseconds (ms) are typical and less than 25 ms desired.
</p>
<ul><li> Ping</li></ul>
<p>The results of a ping test vary depending on the quality of the Internet / network connection. A good broadband Internet connection (wired or wireless) typically results in ping test latency of less than 100 ms, often less than 30 ms. A satellite Internet connection normally suffers from latency above 500 ms.
</p>
<ul><li> Traceroute</li></ul>
<p>Traceroute programs take the name or IP address of a remote computer on the command line. When run, traceroute sends a series test messages over the network (using ICMP) to each intermediate router progressing until the last message finally reaches its destination.
</p><p><br />
</p>
<ul><li> Smokeping</li></ul>
<p>SmokePing To Find Network Latency
</p><p>SmokePing is free and open source software which keeps track of your network latency:
</p>
<pre>   Best of breed latency visualisation.
   Interactive graph explorer.
   Wide range of latency measurment plugins.
   Master/Slave System for distributed measurement.
   Highly configurable alerting system.
   Live Latency Charts with the most 'interesting' graphs.
</pre>
<h1><span class="mw-headline" id="Syst.C3.A8me">Système</span></h1>
<h2><span class="mw-headline" id="htop">htop</span></h2>
<p>Les définitions&#160;:
</p>
<pre>VIRT  --  Image virtuelle (Ko) La  quantité  totale  de  mémoire virtuelle utilisée par la tâche, à savoir l’ensemble des codes,  données,  bibliothèques  partagées  et pages qui ont été transférées sur l’espace d’échange («&#160;swap&#160;»). VIRT = SWAP + RES.
</pre>
<pre>RES  --  Taille résidente (Ko) La mémoire physique «&#160;non swappée&#160;» qu’une tâche a utilisée. RES = CODE + DATA.
</pre>
<pre>SHR  --  Taille mémoire partagée (Ko) La quantité de mémoire partagé utilisée par une tâche. Elle reflète simplement la quantité de  mémoire qui peut être potentiellement partagée avec d’autres processus.

TIME  --  Temps CPU Le temps CPU total utilisé par la tâche depuis son lancement.  Quand le  «&#160;mode Cumulatif&#160;» est Actif, chaque processus est listé avec le temps cpu que lui et ses fils tués ont utilisé. =&gt; Le temps CPU est le même pour perf et la commande "top" que ce soit en mode Cumulatif ou non. Dans la copie d'écran ci-dessous le mode cumulatif n'est pas utilisé&#160;:
</pre>



</body></html>