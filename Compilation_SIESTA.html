<html>
<head><title>Compilation SIESTA</title></head>
<body>
<h1>Compilation SIESTA</h1><p><br />
Compiling Siesta code on lisboa / bolo / lecce nodes
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Requirements"><span class="tocnumber">1</span> <span class="toctext">Requirements</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Cmake"><span class="tocnumber">2</span> <span class="toctext">Cmake</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#HDF5"><span class="tocnumber">3</span> <span class="toctext">HDF5</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#NETCDF"><span class="tocnumber">4</span> <span class="toctext">NETCDF</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#BLAS"><span class="tocnumber">5</span> <span class="toctext">BLAS</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#LAPACK"><span class="tocnumber">6</span> <span class="toctext">LAPACK</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#OPENMPI"><span class="tocnumber">7</span> <span class="toctext">OPENMPI</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#SCALAPACK"><span class="tocnumber">8</span> <span class="toctext">SCALAPACK</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#SIESTA"><span class="tocnumber">9</span> <span class="toctext">SIESTA</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Requirements">Requirements</span></h1>
<h1><span class="mw-headline" id="Cmake">Cmake</span></h1>
<pre>
wget https://cmake.org/files/v3.5/cmake-3.5.0.tar.gz
tar -zxvf cmake-3.5.0.tar.gz
cd cmake-3.5.0
mkdir -p /auto/soft/cmake/3.5.0-local-gnu-4.4.7/
./bootstrap --prefix=/auto/soft/cmake/3.5.0-local-gnu-4.4.7/
gmake
make install
export PATH=/home/tmssoft/cmake-3.5.0/bin/:$PATH
</pre>
<h1><span class="mw-headline" id="HDF5">HDF5</span></h1>
<pre>
wget http://www.hdfgroup.org/ftp/HDF5/current/src/hdf5-1.10.5.tar.gz
tar -zxf hdf5-1.10.5.tar.gz
cd hdf5-1.10.5/
CC=gcc F9X=gfortran CXX=gcc ./configure --prefix=/auto/soft/hdf5/1.8.15-gnu5.2.0 --enable-fortran --enable-cxx
make	... watch for fatal errors ...
make check ... verify that all tests return "PASS"
make install
</pre>
<h1><span class="mw-headline" id="NETCDF">NETCDF</span></h1>
<pre>
wget ftp://ftp.unidata.ucar.edu/pub/netcdf/netcdf-4.4.0.tar.gz
tar -zxvf netcdf-4.4.0.tar.gz
cd netcdf-4.4.0

</pre>
<pre>
wget https://github.com/Unidata/netcdf-fortran/archive/v4.4.3.tar.gz

</pre>
<h1><span class="mw-headline" id="BLAS">BLAS</span></h1>
<pre>
wget http://www.netlib.org/blas/blas-3.6.0.tgz
tar xzvf blas-3.6.0.tgz
cd BLAS-3.6.0
cat make.inc
make 
make clean
ln -s blas_LINUX.a libblas.a
export BLAS=/usr/local/BLAS/libblas.a
</pre>
<h1><span class="mw-headline" id="LAPACK">LAPACK</span></h1>
<pre>
wget http://www.netlib.org/lapack/lapack-3.6.0.tgz
tar -zxvf lapack-3.6.0.tgz 
ln -s lapack-3.6.0 lapack
cd lapack
cp INSTALL/make.inc.gfortran make.inc
make lapacklib
make clean
</pre>
<h1><span class="mw-headline" id="OPENMPI">OPENMPI</span></h1>
<pre>
wget https://www.open-mpi.org/software/ompi/v1.10/downloads/openmpi-1.10.2.tar.bz2
tar -jxf openmpi-1.10.2.tar.bz2 
cd openmpi-1.10.2/
./configure --prefix=/home/tmssoft/openmpi
make -j4
make install
export PATH=/home/tmssoft/openmpi/bin/:$PATH
export LD_LIBRARY_PATH=/home/tmssoft/openmpi/lib:$LD_LIBRARY_PATH
</pre>
<h1><span class="mw-headline" id="SCALAPACK">SCALAPACK</span></h1>
<pre>
wget http://www.netlib.org/scalapack/scalapack-2.0.2.tgz
tar xvf scalapack-2.0.2.tgz
ln -s scalapack-2.0.2 scalapack
cd scalapack
cp SLmake.inc.example SLmake.inc
vim SLmake.inc
    BLASLIB       = -lblas -L/home/tmssoft/include
    LAPACKLIB     = -llapack -L/home/tmssoft/include
    LIBS          = $(LAPACKLIB) $(BLASLIB)
make
export SCALAPACK=/home/tmssoft//scalapack/libscalapack.a

</pre>
<h1><span class="mw-headline" id="SIESTA">SIESTA</span></h1>
<pre>
tar -zxf siesta-4.0b-485.tgz
cd siesta-4.0b-485/Obj
</pre>
<pre>
vi arche.make
SIESTA_ARCH=westmere-openmpi
#
#
FC=mpif90
#
FC_ASIS=$(FC)
#
FFLAGS=-O2
FFLAGS_DEBUG= -g -Wall -Wextra -O0 -g -fbacktrace -fbounds-check
LDFLAGS=
RANLIB=echo
LIBS=
SYS=nag
DUMMY_FOX=--disable-dummy
#
# --- Edit the location of your netcdf files
#
#NETCDF_ROOT=$(HOME)/lib/netcdf-3.6.2-gfortran
#INCFLAGS=-I$(NETCDF_ROOT)/include
#DEFS_CDF=-DCDF
#
DEFS=-DGFORTRAN  -DFC_HAVE_FLUSH -DFC_HAVE_ABORT -DDEBUG    # Note this&#160;!!
COMP_LIBS=
#
#NETCDF_LIBS= -L$(NETCDF_ROOT)/lib -lnetcdf
#
MPI_INTERFACE=libmpi_f90.a
MPI_INCLUDE=.      # Note . for no-op
DEFS_MPI=-DMPI
#
# Specify full paths to avoid picking up the veclib versions..
#
METIS=
LIBPATH=/home/tmssoft/include

BLAS_LIBS=-L$(LIBPATH) -lblas
LAPACK_LIBS=-L$(LIBPATH) -llapack
BLACS_LIBS=-L$(LIBPATH) -lblacsF77 -lblacsC -lblacs
SCALAPACK_LIBS=-L$(LIBPATH) -lscalapack


DEFS:=$(DEFS_MPI) $(DEFS_CDF) $(DEFS)
LIBS=$(SCALAPACK_LIBS) $(LAPACK_LIBS) $(BLAS_LIBS) $(NETCDF_LIBS) $(METIS)

#
.F.o:
        $(FC) -c $(FFLAGS) $(INCFLAGS)  $(DEFS) $&lt;
.f.o:
        $(FC) -c $(FFLAGS) $(INCFLAGS)   $&lt;
.F90.o:
        $(FC) -c $(FFLAGS) $(INCFLAGS)  $(DEFS) $&lt;
.f90.o:
        $(FC) -c $(FFLAGS) $(INCFLAGS)   $&lt;
#
</pre>
<pre>
make -j4 siesta
</pre>




</body></html>