<html>
<head><title>Amber</title></head>
<body>
<h1>Amber</h1><p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Web_site"><span class="tocnumber">2</span> <span class="toctext">Web site</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Compatibilit.C3.A9_Version_-_Cuda_-_Cartes"><span class="tocnumber">3</span> <span class="toctext">Compatibilité Version - Cuda - Cartes</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Compilation"><span class="tocnumber">4</span> <span class="toctext">Compilation</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Plumed"><span class="tocnumber">5</span> <span class="toctext">Plumed</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Conseil"><span class="tocnumber">6</span> <span class="toctext">Conseil</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Quick_example_with_a_SLURM_script"><span class="tocnumber">7</span> <span class="toctext">Quick example with a SLURM script</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Small_example"><span class="tocnumber">8</span> <span class="toctext">Small example</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#Sander_inputs"><span class="tocnumber">8.1</span> <span class="toctext">Sander inputs</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Amber_script"><span class="tocnumber">8.2</span> <span class="toctext">Amber script</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Description">Description</span></h2>
<p><b>AMBER</b> (an <a href="page_not_existing.html" style='color:red' class="new" title="Acronym (page does not exist)">acronym</a> for <b>Assisted Model Building with Energy Refinement</b>) is a family of <a href="page_not_existing.html" style='color:red' class="new" title="Force field (chemistry) (page does not exist)">force fields</a> for <a href="page_not_existing.html" style='color:red' class="new" title="Molecular dynamics (page does not exist)">molecular dynamics</a> of <a href="page_not_existing.html" style='color:red' class="new" title="Biomolecules (page does not exist)">biomolecules</a> originally developed by <a href="page_not_existing.html" style='color:red' class="new" title="Peter Kollman (page does not exist)">Peter Kollman</a>'s group at the <a href="page_not_existing.html" style='color:red' class="new" title="University of California, San Francisco (page does not exist)">University of California, San Francisco</a>.  <b>AMBER</b> is also the name for the molecular dynamics software <a href="page_not_existing.html" style='color:red' class="new" title="Software package (installation) (page does not exist)">package</a> that simulates these force fields. It is maintained by an active collaboration between David Case at <a href="page_not_existing.html" style='color:red' class="new" title="Rutgers University (page does not exist)">Rutgers University</a>, Tom Cheatham at the <a href="page_not_existing.html" style='color:red' class="new" title="University of Utah (page does not exist)">University of Utah</a>, Tom Darden at NIEHS, Ken Merz at Michigan State University, <a href="page_not_existing.html" style='color:red' class="new" title="Carlos Simmerling (page does not exist)">Carlos Simmerling</a> at <a href="page_not_existing.html" style='color:red' class="new" title="State University of New York at Stony Brook (page does not exist)">Stony Brook University</a>, Ray Luo at <a href="page_not_existing.html" style='color:red' class="new" title="UC Irvine (page does not exist)">UC Irvine</a>, and Junmei Wang at Encysive Pharmaceuticals.
</p><p><br />
</p>
<ul><li> AmberTools (partie gratuite), une nouvelle version tous les ans&#160;:</li></ul>
<pre>suffisant pour lancer des dynamiques moléculaires. Executable: sander, cpptraj, ...
</pre>
<ul><li> Amber (partie payante), une nouvelle version tous les 2 ans (12-&gt;2012, 14-&gt;2014, 16-&gt;2016) </li></ul>
<pre>pmemd équivalent plus ou moins à sander -&gt; amélioration des performances sur CPU, ajoute le support GPU
N'intègre pas toutes les fonctionnalités de sander. Par exemple, il ne prend pas en compte la partie QM.
</pre>
<h2><span class="mw-headline" id="Web_site">Web site</span></h2>
<p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://ambermd.org/">http://ambermd.org/</a>
</p><p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://jswails.wikidot.com/#toc10">http://jswails.wikidot.com/#toc10</a>
</p><p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://twitter.com/adrian_roitberg">https://twitter.com/adrian_roitberg</a>
</p><p><br />
<a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://ambermd.org/pmwiki/">http://ambermd.org/pmwiki/</a>
</p>
<h2><span class="mw-headline" id="Compatibilit.C3.A9_Version_-_Cuda_-_Cartes">Compatibilité Version - Cuda - Cartes</span></h2>
<p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://ambermd.org/gpus16/index.htm">http://ambermd.org/gpus16/index.htm</a>
</p><p>Supported GPUs
</p><p>GPU accelerated PMEMD has been implemented using CUDA and thus will only run on NVIDIA GPUs at present although we are working on supporting AMD GPUs. Due to accuracy concerns with pure single precision the code uses a custom designed hybrid single / double / fixed precision model termed SPFP. This places the requirement that the GPU hardware supports both double precision and integer atomics meaning only GPUs with hardware revision 2.0 and later can be used. Support for hardware revision 1.3 was present in previous versions of the code but for code complexity and maintenance reasons has been deprecated as of AMBER 14. For price/performance reasons at this time we highly recommend the GeForce cards over the significantly more expensive Tesla variants. At the time of writing the following cards are supported by AMBER 16:
</p><p>Volta (V100 - SM_70) based cards require CUDA 9.0.
</p>
<h2><span class="mw-headline" id="Compilation">Compilation</span></h2>
<pre>
tar -jxf amber20.source.tar.bz2
mkdir 20
cd 20
lndir ../amber20_src .
</pre>
<p>Recréer une arborescence avec des liens symboliques&#160;: <b>lndir</b>  (voir <a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://linux.die.net/man/1/lndir">https://linux.die.net/man/1/lndir</a> )
</p><p><br />
</p>
<pre>
Compe tmssoft
machine gpu4-02

[tmssoft@gpu4-02 16]$ module list 
Currently Loaded Modules:
  1) cuda/9.0   2) compiler/gnu-5.2.0/std

module load cuda/10.2_gnu-4.8.5
module load openmpi/4.1.0-gnu-10.2.0
export INCLUDE_PATH=$INCLUDE_PATH:/auto/soft/boost1.69/include/
export LIBRARY_PATH=$LIBRARY_PATH:/auto/soft/boost1.69/include/
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/auto/soft/boost1.69/include/


cd build
export FFLAGS="-std=legacy -fallow-argument-mismatch"
export CFLAGS="-std=legacy -fallow-argument-mismatch"
export FC="mpifort -std=legacy -fallow-argument-mismatch"
export CC="mpicc -std=legacy -fallow-argument-mismatch "
export CXX="mpicxx -std=legacy -fallow-argument-mismatch"

yum install bzip2-libs.x86_64 bzip2-devel.x86_64 bzip2.x86_64 zlib-devel
CC="mpicc -std=legacy -fallow-argument-mismatch" FC="mpifort -std=legacy -fallow-argument-mismatch" ./run_cmake  2&gt;&amp;1 |tee log

Edition du script run_cmake

</pre>
<pre>
-- plumed - used as an alternate MD backend for Sander 
-- mkl - alternate implementation of lapack and blas that is tuned for speed 
-- perlmol - chemistry library used by FEW 

--                                Features: 
-- MPI:                     OFF 
-- OpenMP:                  OFF 
-- CUDA:                    OFF 
-- Build Shared Libraries:  ON 
-- Build GUI Interfaces:    ON 
-- Build Python Programs:   ON 
--  -Python Interpreter:    Internal Miniconda (version 3.8) 
-- Build Perl Programs:     ON 
-- Build configuration:     RELEASE 
-- Target Processor:        x86_64 
-- Build Documentation:     OFF 
-- Sander Variants:         normal LES API LES-API 
-- Install location:        /auto/soft/amber/amber20/ 
-- Installation of Tests:   ON 

--                               Compilers: 
--         C: GNU 10.2.0 (/auto/soft/compiler/gnu-10.2.0/bin/gcc) 
--       CXX: GNU 10.2.0 (/auto/soft/compiler/gnu-10.2.0/bin/g++) 
--   Fortran: GNU 10.2.0 (/auto/soft/compiler/gnu-10.2.0/bin/gfortran) 

--                              Building Tools: 
-- addles amberlite ambpdb antechamber cifparse cphstats cpptraj emil etc gbnsr6 gem.pmemd leap lib mdgx mm_pbsa mmpbsa_py moft nab ndiff-2.00 nfe-umbrella-slice nmode nmr_aux packmol_memgen paramfit parmed pbsa pdb4amber pymsmt pysander pytraj reduce rism sander saxs sebomd sff sqm xray xtalutil 

--                            NOT Building Tools: 
-- FEW - FEW requires perlmol 
-- quick - In-development programs are disabled. 
-- pymdgx - In-development programs are disabled. 
-- gpu_utils - Not included in AmberTools 
-- pmemd - Not included in AmberTools 
-- ************************************************************************** 
-- Environment resource files are provided to set the proper environment
-- variables to use AMBER and AmberTools. This is required to run any Python
-- programs (like MMPBSA.py, ParmEd, MCPB.py, and pytraj)
-- 
-- If you use a Bourne shell (e.g., bash, sh, zsh, etc.), source the
-- /auto/soft/amber/amber20//amber.sh file in your shell. Consider adding the line
--   test -f /auto/soft/amber/amber20//amber.sh &amp;&amp; source /auto/soft/amber/amber20//amber.sh
-- to your startup file (e.g., ~/.bashrc)
-- 
-- If you use a C shell (e.g., csh, tcsh), source the
-- /auto/soft/amber/amber20//amber.csh file in your shell. Consider adding the line
--   test -f /auto/soft/amber/amber20//amber.csh &amp;&amp; source /auto/soft/amber/amber20//amber.csh
-- to your startup file (e.g., ~/.cshrc)
-- 
-- Amber will be installed to /auto/soft/amber/amber20/
-- Configuring done
-- Generating done
-- Build files have been written to: /auto/soft/amber/20/build

If the cmake3 build report looks OK, you should now do the following:

    make install
    source /auto/soft/amber/amber20/amber.sh

Consider adding the last line to your login startup script, e.g. ~/.bashrc

</pre>
<p><br />
Source dans /auto/soft/amber/16
</p><p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://github.com/dksenthil/Amber16-installation-simulation">https://github.com/dksenthil/Amber16-installation-simulation</a>
</p><p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://archive.ambermd.org/201701/0286.html">http://archive.ambermd.org/201701/0286.html</a>
</p><p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://jswails.wikidot.com/installing-amber14-and-ambertools14">http://jswails.wikidot.com/installing-amber14-and-ambertools14</a>
</p>
<pre>
export AMBERHOME=/auto/soft/amber/16/gnu-5.2.0-cuda9/
</pre>
<pre>
./update_amber --update 
Preparing to apply updates... please wait.
Downloading updates for AmberTools 17
Downloading AmberTools 17/update.9 (2.39 KB)
Applying AmberTools 17/update.9
/auto/soft/amber/src-amber16/updateutils/patch.py:298: PatchingWarning: Previously applied patch detected. Skipping.
  PatchingWarning)
Downloading AmberTools 17/update.10 (880 Bytes)
Applying AmberTools 17/update.10
Downloading updates for Amber 16
Downloading Amber 16/update.13 (12.01 KB)
Applying Amber 16/update.13
Downloading Amber 16/update.14 (2.81 KB)
Applying Amber 16/update.14
Downloading Amber 16/update.15 (1.00 KB)
Applying Amber 16/update.15

NOTE: update_amber only updates the raw source code! You must recompile if you want 
      any changes to take effect!


</pre>
<p><br />
</p>
<pre>
module load openmpi/3.0.0_gnu-5.2.0
module load compiler/gnu-5.2.0
module load cuda/9.0

export LD_LIBRARY_PATH="/auto/soft/cuda/9.0/lib:${LD_LIBRARY_PATH}"

[tmssoft@gpu4-02 gnu-5.2.0-cuda9]$ ./configure gnu
[tmssoft@gpu4-02 gnu-5.2.0-cuda9]$ make install

[tmssoft@gpu4-02 gnu-5.2.0-cuda9]$ ./configure -cuda -mpi gnu
[tmssoft@gpu4-02 gnu-5.2.0-cuda9]$ make install
</pre>
<h2><span class="mw-headline" id="Plumed">Plumed</span></h2>
<pre>

amber14

PLUMED can be incorporated into amber (sander module) using the standard patching procedure. Patching must be done in the root directory of amber before compilation.

To enable PLUMED in a sander simulation one should use add to the cntrl input namelist these two fields:

plumed=1 , plumedfile='plumed.dat'

The first is switching plumed on, the second is specifying the name of the plumed input file.

This patch is compatible with the MPI version of sander and support multisander. However, replica exchange is not supported. Multisander can thus only be used for multiple walkers metadynamics or for ensemble restraints.

For more information on amber you should visit http://ambermd.org

</pre>
<p>To patch your MD code, you should have already installed PLUMED properly
</p>
<pre>
export PLUMED_KERNEL=/auto/soft/plumed/2.7.0/lib/libplumedKernel.so
</pre>
<h2><span class="mw-headline" id="Conseil">Conseil</span></h2>
<ul><li> Avant de lancer un calcul sur GPU, il est nécessaire de lancer un premier calcul sur CPU.</li></ul>
<ul><li> Erreur typique&#160;: utiliser la partie GPU (cuda) sur un système mal optimisé. Tout faire avec la partie GPU n'est pas possible.</li></ul>
<pre>
Attention avec pmemd cuda.
NTPR =&gt; freq de sauvegarde de l'énergie de la température des forces ( par défaut 1000)
NTWX =&gt; freq save des frames


PARTIE GPU:  pmemd.CUDA ne calcule que les forces

Partie non GPU =&gt; affichage
</pre>
<p>Quand pb avec CUDA, on passe le NTPR à 10 pour vérifier les forces et que la géométrie est bien optimisée
</p><p>On utilise que pmemd.CUDA une fois la géom bonne.
</p>
<pre>
1 - Minimsation
2 - augmente la temp progressivement
3 - 1 x bien optim =&gt; partie GPU
</pre>
<ul><li> Tableau synthétique des principaux programmes et de leur principales caractéristiques </li></ul>
<table class="wikitable">
<tr>
<th>
</th>
<th>version other than serial
</th>
<th>Supported features
</th>
<th> Use case
</th></tr>
<tr>
<td>pmemd
</td>
<td>cuda, mpi
</td>
<td><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://ambermd.org/gpus/#Features">http://ambermd.org/gpus/#Features</a>
</td>
<td> MD
</td></tr>
<tr>
<td>sander
</td>
<td>mpi
</td>
<td>
</td>
<td>QMMM
</td></tr>
<tr>
<td>cpptraj
</td>
<td>openmp
</td>
<td>
</td>
<td>
</td></tr></table>
<ul><li> Pour des calculs QM-MM, utiliser sander</li>
<li> pour des partie dynamique moléculaire, utiliser pmemd</li></ul>
<h2><span class="mw-headline" id="Quick_example_with_a_SLURM_script">Quick example with a SLURM script</span></h2>
<pre>
#!/bin/bash
#
#SBATCH --comment=amber-test
#SBATCH --job-name=amber-test
#SBATCH --output=output.%j.amber-test
#SBATCH --error=output.%j.amber-test
#SBATCH --time=01:00:00
#SBATCH -N 1
#SBATCH --ntasks=40
#SBATCH --gres=gpu:8
#SBATCH -p k80

module purge
module load amber/16/gnu-5.2.0

mpirun -np 8 pmemd.cuda.MPI -O -i mdin -c eq1.x -o  test.out
</pre>
<h2><span class="mw-headline" id="Small_example">Small example</span></h2>
<h3><span class="mw-headline" id="Sander_inputs">Sander inputs</span></h3>
<ul><li> parameters and system topology </li></ul>
<p>You can generate interactively Amber inputs with xleap or tleap.
</p><p>On other way could be to generate your inputs from a "src-tleap.dat" input file fr tleap.
</p>
<pre>
$ cat &gt; src-tleap.dat &lt;&lt; EOF
# Load a protein and nucleic acid force field
source leaprc.ff14SB
# Build alanine dipeptide
foo = sequence { ACE ALA NME }
# Solvate alanine dipeptide
solvatebox foo TIP3PBOX 10.0
# Save the Amber prmtop (parameters and system topology) and inpcrd (input coordinates) input files
saveamberparm foo prmtop inpcrd
quit
EOF

$ tleap -f src-tleap.dat
</pre>
<p>Now we have two files&#160;: <b>prmtop</b> and <b>inpcrd</b>
</p>
<ul><li>  Prepare Amber MD sander input file to run a minimization</li></ul>
<pre>
cat &gt; 01_Min.in &lt;&lt; EOF
Minimize
 &amp;cntrl
  imin=1,
  ntx=1,
  irest=0,
  maxcyc=2000,
  ncyc=1000,
  ntpr=100,
  ntwx=0,
  cut=8.0,
 /
EOF
</pre>
<p>Now we have a file&#160;: <b>01_Min.in</b>
</p><p><br />
</p>
<h3><span class="mw-headline" id="Amber_script">Amber script</span></h3>
<pre>


# the actual amber run starts here
export DO_PARALLEL=""
export DO_PARALLEL="mpirun -np 2"
export BEGIN_PARALLEL=""
export END_PARALLEL=""

# Serial run
#AMBEREXE=sander

# Parallel run on CPU
AMBEREXE=sander.MPI

# Run minimization
FILE=01_Min
TOP=prmtop
INCRD=inpcrd
$BEGIN_PARALLEL
$DO_PARALLEL $AMBEREXE -O \
        -i ${FILE}.in \
        -o ${FILE}.out \
        -p ${TOP} \
        -c ${INCRD} \
        -r ${FILE}.rst \
        -x ${FILE}.mdcrd  \
        -inf ${FILE}.mdinfo
$END_PARALLEL
</pre>




</body></html>