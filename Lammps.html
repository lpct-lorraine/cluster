<html>
<head><title>Lammps</title></head>
<body>
<h1>Lammps</h1><p><br />
Lammps
LAMMPS is a classical molecular dynamics code with a focus on materials modeling. It's an acronym for Large-scale Atomic/Molecular Massively Parallel Simulator.
</p><p>LAMMPS has potentials for solid-state materials (metals, semiconductors) and soft matter (biomolecules, polymers) and coarse-grained or mesoscopic systems. It can be used to model atoms or, more generically, as a parallel particle simulator at the atomic, meso, or continuum scale.
</p><p>LAMMPS runs on single processors or in parallel using message-passing techniques and a spatial-decomposition of the simulation domain. Many of its models have versions that provide accelerated performance on CPUs, GPUs, and Intel Xeon Phis. The code is designed to be easy to modify or extend with new functionality.
</p><p>LAMMPS is distributed as an open source code under the terms of the GPL. The current version can be downloaded here. Links are also included to older versions. All LAMMPS development is done via GitHub, so all versions can also be accessed there. Periodic releases are also posted to SourceForge.
</p><p>LAMMPS is distributed by Sandia National Laboratories, a US Department of Energy laboratory. The main authors of LAMMPS are listed on this page along with contact info and other contributors. Funding for LAMMPS development has come primarily from DOE (OASCR, OBER, ASCI, LDRD, Genomes-to-Life) and is acknowledged here.
</p><p>The LAMMPS web site is hosted by Sandia, which has this Privacy and Security statement.
</p><p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Module"><span class="tocnumber">1</span> <span class="toctext">Module</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Web_site"><span class="tocnumber">2</span> <span class="toctext">Web site</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Compilation_of_the_latest_version"><span class="tocnumber">3</span> <span class="toctext">Compilation of the latest version</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Compilation_de_Lammps_with_GPU_support_on_EXPLOR"><span class="tocnumber">4</span> <span class="toctext">Compilation de Lammps with GPU support on EXPLOR</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Test"><span class="tocnumber">5</span> <span class="toctext">Test</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Module">Module</span></h1>
<p>lammps/dec2020
</p>
<h1><span class="mw-headline" id="Web_site">Web site</span></h1>
<p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://lammps.sandia.gov/">https://lammps.sandia.gov/</a>
</p><p>Basics of running LAMMPS  <a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://lammps.sandia.gov/doc/Run_basics.html">https://lammps.sandia.gov/doc/Run_basics.html</a>
</p><p>Package details <a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://lammps.sandia.gov/doc/Packages_details.html">https://lammps.sandia.gov/doc/Packages_details.html</a>
</p><p><br />
</p><p><br />
</p>
<h1><span class="mw-headline" id="Compilation_of_the_latest_version">Compilation of the latest version</span></h1>
<pre>module load compiler/intel19u5
</pre>
<pre>

git clone -b stable https://github.com/lammps/lammps.git lammps
cd lammps 
mkdir build&#160;; cd build

cmake3 ../cmake/ \
-DCMAKE_INSTALL_PREFIX=/auto/soft/lammps/dec2020 \
-DPKG_RIGID=yes \
-DPKG_MOLECULE=yes \
-DPKG_KSPACE=yes \
-DBUILD_TOOLS=yes \
-DFFT=MKL \
-DBUILD_LAMMPS_SHELL=no \
-DBUILD_MPI=on \
-DLAMMPS_MACHINE=mpi \
-DPKG_BODY=on \
-DPKG_MANYBODY=on \
-DPKG_MC=on \
-DPKG_QEQ=on \
-DPKG_DIPOLE=on \
-DPKG_USER-QMMM=on \
-DPKG_USER-MISC=on \
-DPKG_USER-REACTION=on \
-DCMAKE_C_COMPILER=mpicc -DCMAKE_CXX_COMPILER=mpiicpc -DCMAKE_Fortran_COMPILER=mpiifort

make -j 32
make install

ls /auto/soft/lammps/dec2020/bin/
cat /auto/soft/lammps/dec2020/etc/profile.d/lammps.sh
</pre>
<p>cmake output&#160;:
</p>
<pre>

-- Appending /auto/soft/compiler/intel/psxe-19u5/compilers_and_libraries_2019.5.281/linux/mpi/intel64/libfabric/lib:/auto/soft/compiler/intel/psxe-19u5/compilers_and_libraries_2019.5.281/linux/mpi/intel64/lib/release:/auto/soft/compiler/intel/psxe-19u5/compilers_and_libraries_2019.5.281/linux/mpi/intel64/lib:/auto/soft/compiler/intel/psxe-19u3/intelpython3/lib/libfabric:/auto/soft/compiler/intel/psxe-19u3/clck/2019.5/lib/intel64:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/mpi/intel64/libfabric/lib:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/ipp/lib/intel64:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/compiler/lib/intel64_lin:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/mkl/lib/intel64_lin:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/tbb/lib/intel64/gcc4.7:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/daal/lib/intel64_lin:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/tbb/lib/intel64_lin/gcc4.4 to CMAKE_LIBRARY_PATH: /auto/soft/compiler/intel/psxe-19u5/compilers_and_libraries_2019.5.281/linux/mpi/intel64/libfabric/lib:/auto/soft/compiler/intel/psxe-19u5/compilers_and_libraries_2019.5.281/linux/mpi/intel64/lib/release:/auto/soft/compiler/intel/psxe-19u5/compilers_and_libraries_2019.5.281/linux/mpi/intel64/lib:/auto/soft/compiler/intel/psxe-19u3/intelpython3/lib/libfabric:/auto/soft/compiler/intel/psxe-19u3/clck/2019.5/lib/intel64:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/mpi/intel64/libfabric/lib:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/ipp/lib/intel64:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/compiler/lib/intel64_lin:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/mkl/lib/intel64_lin:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/tbb/lib/intel64/gcc4.7:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/daal/lib/intel64_lin:/auto/soft/compiler/intel/psxe-19u3/compilers_and_libraries_2019.5.281/linux/tbb/lib/intel64_lin/gcc4.4
-- Running check for auto-generated files from make-based build system
-- Could NOT find FFMPEG (missing: FFMPEG_EXECUTABLE) 
-- Checking for module 'fftw3'
--   No package 'fftw3' found
-- Generating style headers...
-- Generating package headers...
-- Generating lmpinstalledpkgs.h...
-- The following tools and libraries have been found and configured:
 * Git
 * MPI
 * OpenMP
 * PkgConfig
 * MKL

-- &lt;&lt;&lt; Build configuration &gt;&gt;&gt;
   Operating System: Linux
   Build type:       RelWithDebInfo
   Install path:     /auto/soft/lammps/dec2020
   Generator:        Unix Makefiles using /bin/gmake
-- Enabled packages: BODY;DIPOLE;KSPACE;MANYBODY;MC;MOLECULE;QEQ;RIGID;USER-MISC;USER-QMMM;USER-REACTION
-- &lt;&lt;&lt; Compilers and Flags: &gt;&gt;&gt;
-- C++ Compiler:     /auto/soft/compiler/intel/psxe-19u5/compilers_and_libraries_2019.5.281/linux/mpi/intel64/bin/mpiicpc
      Type:          Intel
      Version:       19.0.5.20190815
      C++ Flags:     -restrict -O2 -g -DNDEBUG
      Defines:       LAMMPS_SMALLBIG;LAMMPS_MEMALIGN=64;LAMMPS_OMP_COMPAT=4;LAMMPS_GZIP;FFT_MKL;FFT_MKL_THREADS
      Options:       -xHost
-- Fortran Compiler: /auto/soft/compiler/intel/psxe-19u5/compilers_and_libraries_2019.5.281/linux/mpi/intel64/bin/mpiifort
      Type:          Intel
      Version:       19.0.5.20190815
      Fortran Flags: -O2 -g
-- C compiler:       /auto/soft/compiler/intel/psxe-19u5/compilers_and_libraries_2019.5.281/linux/mpi/intel64/bin/mpicc
      Type:          GNU
      Version:       4.8.5
      C Flags:       -O2 -g -DNDEBUG
-- &lt;&lt;&lt; Linker flags: &gt;&gt;&gt;
-- Executable name:  lmp_mpi
-- Static library flags:    
-- &lt;&lt;&lt; MPI flags &gt;&gt;&gt;
-- MPI_defines:      MPICH_SKIP_MPICXX;OMPI_SKIP_MPICXX;_MPICC_H
-- MPI includes:     
-- MPI libraries:   &#160;;
-- &lt;&lt;&lt; FFT settings &gt;&gt;&gt;
-- Primary FFT lib:  MKL
-- Using double precision FFTs
-- Using threaded FFTs
-- &lt;&lt;&lt; Building Tools &gt;&gt;&gt;
-- Configuring done
-- Generating done
-- Build files have been written to: /auto/store/tmssoft/lammps/build

</pre>
<h1><span class="mw-headline" id="Compilation_de_Lammps_with_GPU_support_on_EXPLOR">Compilation de Lammps with GPU support on EXPLOR</span></h1>
<p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://lammps.sandia.gov/doc/Build_extras.html#gpu">https://lammps.sandia.gov/doc/Build_extras.html#gpu</a>
</p>
<pre>
srun -N1 -n 24 --gres=gpu:1 -t 1:00:00 -p freet4 --pty bash

module load cmake/3.15.5

module load intelmpi/2017.4.196 intel/2017.4.196 mkl/2017.4.196

module load cuda/9.2



cmake ../cmake/ \
-DCMAKE_INSTALL_PREFIX=/home/lhz20/shared/lammps/dec2020 \
-DPKG_RIGID=yes \
-DPKG_MOLECULE=yes \
-DPKG_KSPACE=yes \
-DBUILD_TOOLS=yes \
-DFFT=MKL \
-DBUILD_LAMMPS_SHELL=no \
-DBUILD_MPI=on \
-DLAMMPS_MACHINE=mpi \
-DPKG_BODY=on \
-DPKG_MANYBODY=on \
-DPKG_MC=on \
-DPKG_QEQ=on \
-DPKG_DIPOLE=on \
-DPKG_USER-QMMM=on \
-DPKG_USER-MISC=on \
-DPKG_USER-REACTION=on \
-DCMAKE_C_COMPILER=mpicc -DCMAKE_CXX_COMPILER=mpiicpc -DCMAKE_Fortran_COMPILER=mpiifort \
-D GPU_API=cuda \
-D GPU_ARCH=sm_60 \
-D HIP_ARCH=sm_60  \
-DPKG_GPU=on
</pre>
<h1><span class="mw-headline" id="Test">Test</span></h1>
<p>For example, on lecce4 partition, you can use the following slurm submission script&#160;:
</p>
<pre>
#!/bin/bash

#SBATCH --output=job-test.out
#SBATCH --error=job-test.err
#SBATCH --time=00:05:00
#SBATCH -p lecce4
#SBATCH -N 1
#SBATCH --ntasks=4

module load  lammps/dec2020

export FI_PROVIDER=tcp
export I_MPI_TMI_PROVIDER=sockets

export OMP_NUM_THREADS=2

cp  /auto/soft/lammps/dec2020/examples/body/in.body /auto/soft/lammps/dec2020/examples/body/data.body  .

mpirun -n ${SLURM_NTASKS} lmp_mpi -in in.body

date
</pre>
<p>output:
</p>
<pre>
LAMMPS (29 Oct 2020)
  using 2 OpenMP thread(s) per MPI task
Reading data file ...
  orthogonal box = (-15.532225 -15.532225 -0.5) to (15.532225 15.532225 0.5)
  2 by 2 by 1 MPI processor grid
  reading atoms ...
  100 atoms
  100 bodies
  read_data CPU = 0.004 seconds
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.5
  ghost atom cutoff = 5.5
  binsize = 2.75, bins = 12 12 1
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair body/nparticle, perpetual
      attributes: half, newton on
      pair build: half/bin/atomonly/newton
      stencil: half/bin/2d/newton
      bin: standard
Setting up Verlet run ...
  Unit style   &#160;: lj
  Current step &#160;: 0
  Time step    &#160;: 0.005
Per MPI rank memory allocation (min/avg/max) = 6.649 | 6.650 | 6.650 Mbytes
Step Temp E_pair E_mol TotEng Press 
       0         1.44  -0.63799525            0   0.78760475  -0.15028724 
     100    1.6423719   -1.0000887            0   0.62585944   0.16114494 
     200    1.4801421   -1.2477955            0   0.21754516   0.35460225 
     300    1.4721362   -1.3202194            0   0.13719545   0.45493231 
     400    1.5115209   -1.5945239            0 -0.098118188   0.12925852 
     500    1.5441731   -1.6325738            0  -0.10384248   0.12026629 
     600    1.6336853   -1.6622365            0 -0.044887973   0.40313875 
     700    1.6044966   -1.6659752            0 -0.077523555   0.06415431 
     800    1.6519588   -1.6452284            0 -0.009789235   0.30930348 
     900    1.6039096    -1.569159            0  0.018711572   0.40699173 
    1000    1.4984467    -1.522988            0 -0.039525745     0.562232 
    1100     1.738782   -1.5555601            0   0.16583406   0.15436291 
    1200    1.6425088   -1.5386995            0  0.087384226   0.30107994 
    1300    1.5175524   -1.7222262            0  -0.21984924   0.19056801 
    1400    1.6568576   -1.7552112            0  -0.11492214    0.1330313 
    1500    1.7188444    -1.723013            0 -0.021357072  0.060165423 
    1600    1.6471813   -1.6360675            0 -0.0053580441   0.13730195 
    1700    1.6943753   -1.6846983            0 -0.0072668248   0.24132632 
    1800    1.5219992   -1.5208668            0 -0.014087562   0.47910869 
    1900     1.676155   -1.7366108            0 -0.077217423   0.37231949 
    2000    1.7955188   -1.7748845            0 0.0026791299   0.13206868 
    2100    1.7007182   -1.9082725            0  -0.22456144   0.18095949 
    2200    1.7430177   -1.8808501            0  -0.15526261   0.17344982 
    2300    1.8664575   -1.6853968            0   0.16239612   0.34186136 
    2400    1.7006234   -1.6683488            0  0.015268412   0.18212424 
    2500    1.7367047    -1.721193            0 -0.0018553452  0.035372924 
    2600    1.7182691   -1.5961396            0   0.10494686   0.39743348 
    2700    1.6444143   -1.5901239            0  0.037846257  0.091852656 
    2800    1.6822374   -1.6390062            0  0.026408809  0.098066016 
    2900    1.5872165   -1.5306117            0  0.040732642   0.42268601 
    3000    1.4342618   -1.5839686            0  -0.16404942   0.48600816 
    3100    1.7087456   -1.7389789            0 -0.047320801   0.11952256 
    3200    1.6193106   -1.7631681            0   -0.1600506    0.3996631 
    3300    1.8165109   -1.8063895            0 -0.0080436478   0.29877041 
    3400    1.6441148   -1.6818603            0 -0.054186625   0.42364967 
    3500    1.7145181   -1.8529741            0   -0.1556012   0.11916837 
    3600    1.6145526   -1.6973129            0 -0.098905844    0.2632208 
    3700    1.5718969   -1.7816014            0  -0.22542345   0.10614018 
    3800    1.6603276   -1.7316389            0 -0.087914561   0.19244203 
    3900    1.4072548   -1.6150127            0  -0.22183051   0.14699435 
    4000    1.4915897   -1.5989497            0  -0.12227584  0.080526501 
    4100    1.7782266   -1.6925639            0  0.067880387   0.31973307 
    4200    1.6955118   -1.5072179            0   0.17133877    0.4911667 
    4300    1.7614254   -1.5872089            0   0.15660228   0.27057611 
    4400    1.7937908   -1.6414422            0   0.13441068  0.099956616 
    4500    1.7657347   -1.6623328            0  0.085744634    0.1746363 
    4600     1.701892   -1.7198702            0 -0.034997108  0.092759767 
    4700    1.6560877   -1.6895625            0 -0.050035672   0.51694429 
    4800    1.6849257   -1.7255713            0 -0.057494902   0.19332955 
    4900     1.584699   -1.5300809            0  0.038771171   0.36640997 
    5000    1.6718625   -1.6028373            0  0.052306566    0.1672525 
    5100    1.9086383    -1.816628            0  0.072923932    0.2083225 
    5200    1.9666126   -1.8240037            0   0.12294271   0.18856866 
    5300    1.8086178    -1.850142            0 -0.059610341   0.28374849 
    5400    1.7719079   -1.7341349            0  0.020053909   0.10925489 
    5500    1.7041317   -1.6039591            0  0.083131224    0.1044462 
    5600    1.6743351    -1.702167            0 -0.044575266    0.2601732 
    5700    1.5272642   -1.6907389            0   -0.1787473   0.41824527 
    5800    1.7455539   -1.6221891            0   0.10590919   0.41742518 
    5900    1.7854713   -1.7214968            0  0.046119785   0.15072954 
    6000    1.6511251   -1.6213333            0  0.013280484  0.084761016 
    6100    1.4778135   -1.3676263            0  0.095409063   0.51958537 
    6200    1.5769434   -1.4635341            0  0.097639865   0.35293773 
    6300    1.7173278   -1.6283803            0  0.071774204   0.25499285 
    6400    1.4772839   -1.5917553            0  -0.12924423   0.33576317 
    6500    1.8862695   -1.6938701            0   0.17353669   0.33758339 
    6600    1.7851057   -1.8003907            0 -0.033136006   0.25274813 
    6700    1.7653198   -1.7410704            0 0.0065962205  0.095989614 
    6800    1.7013094   -1.8288385            0  -0.14454216   0.45726765 
    6900    1.7499299   -1.8652006            0  -0.13277002   0.22014999 
    7000    1.7016809    -1.626385            0  0.058279133    0.4047101 
    7100    1.6548718   -1.7422909            0  -0.10396774  0.059039348 
    7200    1.6091051   -1.6951408            0  -0.10212674  0.081147774 
    7300    1.6155736    -1.745185            0  -0.14576711  0.098898358 
    7400     1.758833   -1.7366509            0 0.0045937728   0.13561001 
    7500    1.6672428   -1.7138771            0 -0.063306803   0.29831119 
    7600    1.6341431   -1.6273936            0 -0.0095919872   0.32266582 
    7700     1.602128   -1.7447225            0  -0.15861577   0.25981991 
    7800     1.628091    -1.723939            0  -0.11212894   0.40987853 
    7900    1.7203692   -1.6362501            0  0.066915447   0.19264925 
    8000    1.5954919   -1.5817866            0 -0.0022496573   0.26441772 
    8100    1.8040012   -1.6367723            0    0.1491889   0.18628792 
    8200    1.7710351   -1.5848881            0    0.1684366   0.43972389 
    8300    1.7185402   -1.7345605            0 -0.033205675   0.17058864 
    8400    1.5904032   -1.5072281            0  0.067271076   0.42898101 
    8500    1.7377249   -1.7018016            0  0.018546097   0.17962644 
    8600    1.7219351   -1.7128625            0 -0.0081467637   0.21869089 
    8700    1.8665934   -1.6257275            0    0.2221999   0.20126052 
    8800    1.7111544   -1.6098746            0  0.084168267   0.23872216 
    8900    1.6342243   -1.6698505            0 -0.051968504   0.35520445 
    9000    1.6077646   -1.6435068            0 -0.051819908  0.012206668 
    9100    1.5308011   -1.5519473            0  -0.03645419   0.16694413 
    9200    1.4549745   -1.4479947            0 -0.0075698595   0.39920139 
    9300    1.3710905   -1.5324289            0  -0.17504934   0.17800019 
    9400    1.5163095   -1.6212111            0   -0.1200647   0.25772472 
    9500    1.6432285   -1.6450497            0 -0.018253438   0.23977368 
    9600    1.7542848   -1.5967098            0   0.14003217   0.37480898 
    9700    1.7529703   -1.6852581            0  0.050182517 -0.023840576 
    9800    1.8391497   -1.7201383            0   0.10061986   0.25593631 
    9900    1.6811859   -1.8407713            0  -0.17639721    0.2634069 
   10000    1.7824213   -1.8434909            0 -0.078893835   0.37449148 
Loop time of 0.601769 on 8 procs for 10000 steps with 100 atoms

Performance: 7178837.025 tau/day, 16617.678 timesteps/s
100.0% CPU use with 4 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg|&#160;%total
---------------------------------------------------------------
Pair    | 0.30211    | 0.3594     | 0.42158    |   7.1 | 59.72
Neigh   | 0.0023344  | 0.0024826  | 0.0026717  |   0.2 |  0.41
Comm    | 0.1096     | 0.17424    | 0.23186    |  10.5 | 28.96
Output  | 0.00091709 | 0.001001   | 0.0012047  |   0.4 |  0.17
Modify  | 0.041722   | 0.044567   | 0.047076   |   0.9 |  7.41
Other   |            | 0.02008    |            |       |  3.34

Nlocal:        25.0000 ave          30 max          21 min
Histogram: 1 0 1 0 0 1 0 0 0 1
Nghost:        40.5000 ave          43 max          39 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:        116.750 ave         165 max          90 min
Histogram: 1 1 1 0 0 0 0 0 0 1

Total # of neighbors = 467
Ave neighs/atom = 4.6700000
Neighbor list builds = 476
Dangerous builds = 0
Total wall time: 0:00:00
Thu Jan  7 17:54:54 CET 2021

</pre>




</body></html>