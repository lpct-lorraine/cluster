<html>
<head><title>SIESTA</title></head>
<body>
<h1>SIESTA</h1><p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#official_web_site"><span class="tocnumber">1</span> <span class="toctext">official web site</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Module_environment"><span class="tocnumber">2</span> <span class="toctext">Module environment</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#SLURM_submission_script_example"><span class="tocnumber">3</span> <span class="toctext">SLURM submission script example</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Parallel_on_two_nodes"><span class="tocnumber">3.1</span> <span class="toctext">Parallel on two nodes</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#Compilation"><span class="tocnumber">4</span> <span class="toctext">Compilation</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#v1"><span class="tocnumber">4.1</span> <span class="toctext">v1</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#v2"><span class="tocnumber">4.2</span> <span class="toctext">v2</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Doc"><span class="tocnumber">4.3</span> <span class="toctext">Doc</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#v3"><span class="tocnumber">4.4</span> <span class="toctext">v3</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#SCALAPACK_.2B_MPICH_.2B_gnu_5.2.0"><span class="tocnumber">4.5</span> <span class="toctext">SCALAPACK + MPICH + gnu 5.2.0</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Intel_12_MKL"><span class="tocnumber">4.6</span> <span class="toctext">Intel 12  MKL</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#V.C3.A9rification_des_ex.C3.A9cutables_disponibles"><span class="tocnumber">5</span> <span class="toctext">Vérification des exécutables disponibles</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#script_de_soumission"><span class="tocnumber">5.1</span> <span class="toctext">script de soumission</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#cas_de_h3po4_3"><span class="tocnumber">5.2</span> <span class="toctext">cas de h3po4_3</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#cas_nanotube-c-5-0"><span class="tocnumber">5.3</span> <span class="toctext">cas nanotube-c-5-0</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16"><a href="#Erreur_openmpi"><span class="tocnumber">6</span> <span class="toctext">Erreur openmpi</span></a>
<ul>
<li class="toclevel-2 tocsection-17"><a href="#ssh_agent"><span class="tocnumber">6.1</span> <span class="toctext">ssh agent</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="#Erreur_Gros_systeme_multi_noeud_Chiara"><span class="tocnumber">7</span> <span class="toctext">Erreur Gros systeme multi noeud Chiara</span></a>
<ul>
<li class="toclevel-2 tocsection-19"><a href="#petit_cas_qui_marche:_h3PO4"><span class="tocnumber">7.1</span> <span class="toctext">petit cas qui marche: h3PO4</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#cas_intermediaire_qui_marche"><span class="tocnumber">7.2</span> <span class="toctext">cas intermediaire qui marche</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#gros_cas_qui_ne_marche_pas"><span class="tocnumber">7.3</span> <span class="toctext">gros cas qui ne marche pas</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="official_web_site">official web site</span></h1>
<p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://departments.icmab.es/leem/siesta/">http://departments.icmab.es/leem/siesta/</a>
</p>
<h1><span class="mw-headline" id="Module_environment">Module environment</span></h1>
<p>Last one compile with tools and mpi support&#160;:
</p>
<ul><li> How to load siesta environment&#160;?</li></ul>
<pre>
module load siesta/4.0b-485-intel12/std
</pre>
<ul><li> Directory&#160;:</li></ul>
<pre>
/auto/soft/siesta/4.0b-485-intel12/std/
├── Docs
├── Examples
├── Pseudo
├── Pseudos
├── Tests
├── Tutorials
└── Util
</pre>
<ul><li> Utils&#160;:</li></ul>
<pre>
ls /auto/soft/siesta/4.0b-485-intel12/std/Util/bin/
countJobs    fractional  kind_explorer  orbmol_proj  rho2xsf   vibra
denchar      getResults  macroave       pdosxml      runJobs   wfs2wfsx
eig2bxsf     horizontal  md2axsf        pi3          simplex   wfsx2wfs
eigfat2plot  hs2hsx      mixps          plstm        swarm     xml2psf
fcbuild      hsx2hs      mprop          readwf       test-xml  xv2xsf
fmpdos       info_wfsx   new.gnubands   readwfx      vib2xsf
</pre>
<h1><span class="mw-headline" id="SLURM_submission_script_example">SLURM submission script example</span></h1>
<h2><span class="mw-headline" id="Parallel_on_two_nodes">Parallel on two nodes</span></h2>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
#!/bin/bash

#SBATCH -p taras
#SBATCH -N 2
#SBATCH -n 64
#SBATCH -J test_siesta
#SBATCH -o slurm.log 
#SBATCH -e slurm.log 


module load openmpi/1.10.2-local-gnu-4.4.7/std
module load siesta/4.0b-485-local-gnu-4.4.7-openmpi-1.10.2/par


mpirun  -np 64 siesta &lt; dye.fdf &gt; dye.out

</pre><a href="page_not_existing.html" style='color:red' class="new" title="En cours (page does not exist)">En_cours</a>
<p><a href="page_not_existing.html" style='color:red' class="new" title="Ajout de la fonction parallèle sur plusieurs noeuds (page does not exist)">Ajout de la fonction parallèle sur plusieurs noeuds</a>
</p><p><a href="page_not_existing.html" style='color:red' class="new" title="1 (page does not exist)">1</a>
</p>
<h1><span class="mw-headline" id="Compilation">Compilation</span></h1>
<pre>
ssh tmssoft@tejo

qrsh -q bolo@bolo09 -pe parallel 4

tar -zxf siesta-4.0b-485.tgz 
cd siesta-4.0b-485/Obj
../Src/obj_setup.sh
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="v1">v1</span></h2>
<pre>cat &gt; arch.make &lt;&lt; EOF
...
EOF
</pre>
<pre>
.SUFFIXES:
.SUFFIXES: .f .F .o .a .f90 .F90

SIESTA_ARCH=x86_64-westmere-gnu-openmpi

FPP=
FPP_OUTPUT=
FC=mpif90
RANLIB=ranlib

SYS=nag

SP_KIND=4
DP_KIND=8
KINDS=$(SP_KIND) $(DP_KIND)

FFLAGS=-g -O2
FPPFLAGS= -DFC_HAVE_FLUSH -DFC_HAVE_ABORT -DGRID_DP -DPHI_GRID_SP -DMPI
LDFLAGS=

ARFLAGS_EXTRA=

FCFLAGS_fixed_f=
FCFLAGS_free_f90=
FPPFLAGS_fixed_F=
FPPFLAGS_free_F90=

LIBPATH=/home/tmssoft/include

#BLAS_LIBS= -L$(LIBPATH) -lblas
#LAPACK_LIBS= -L$(LIBPATH) -llapack
#BLACS_LIBS= -L$(LIBPATH) -lblacsF77 -lblacsC -lblacs
#SCALAPACK_LIBS=-lscalapack

BLAS_LIBS= -L/home/tmssoft/include/ /home/tmssoft/include/ -lblas
LAPACK_LIBS=liblapack.a
BLACS_LIBS=
SCALAPACK_LIBS=/home/tmssoft/include/libscalapack.a

COMP_LIBS=

NETCDF_LIBS=
NETCDF_INTERFACE=

LIBS=$(SCALAPACK_LIBS) $(BLACS_LIBS) $(LAPACK_LIBS) $(BLAS_LIBS) $(NETCDF_LIBS) -lpthread

#SIESTA needs an F90 interface to MPI
#This will give you SIESTA's own implementation
#If your compiler vendor offers an alternative, you may change
#to it here.
MPI_INTERFACE=libmpi_f90.a
MPI_INCLUDE=./include

#Dependency rules are created by autoconf according to whether
#discrete preprocessing is necessary or not.
.F.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS) $(FPPFLAGS) $(FPPFLAGS_fixed_F)  $&lt;
.F90.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS) $(FPPFLAGS) $(FPPFLAGS_free_F90) $&lt;
.f.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS) $(FCFLAGS_fixed_f)  $&lt;
.f90.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS) $(FCFLAGS_free_f90)  $&lt;
</pre>
<h2><span class="mw-headline" id="v2">v2</span></h2>
<pre>
SIESTA_ARCH=westmere-openmpi
#
#
FC=mpif90
#
FC_ASIS=$(FC)
#
FFLAGS=-O2
FFLAGS_DEBUG= -g -Wall -Wextra -O0 -g -fbacktrace -fbounds-check
LDFLAGS=
RANLIB=echo
LIBS=  
SYS=nag
#
# --- Edit the location of your netcdf files
#
#NETCDF_ROOT=$(HOME)/lib/netcdf-3.6.2-gfortran
#INCFLAGS=-I$(NETCDF_ROOT)/include
#DEFS_CDF=-DCDF
#
DEFS=-DGFORTRAN  -DFC_HAVE_FLUSH -DFC_HAVE_ABORT -DDEBUG    # Note this&#160;!!
COMP_LIBS=
#
#NETCDF_LIBS= -L$(NETCDF_ROOT)/lib -lnetcdf
#
MPI_INTERFACE=libmpi_f90.a
MPI_INCLUDE=.      # Note . for no-op
DEFS_MPI=-DMPI
#
# Specify full paths to avoid picking up the veclib versions..
#
METIS=
LIBPATH=/home/tmssoft/include

#BLAS_LIBS= -L$(LIBPATH) -lblas
##LAPACK_LIBS= -L$(LIBPATH) -llapack
##BLACS_LIBS= -L$(LIBPATH) -lblacsF77 -lblacsC -lblacs
##SCALAPACK_LIBS=-lscalapack
#
#BLAS_LIBS= -L/home/tmssoft/include/ /home/tmssoft/include/ -lblas
#LAPACK_LIBS=liblapack.a
#BLACS_LIBS=
#SCALAPACK_LIBS=/home/tmssoft/include/libscalapack.a

DEFS:=$(DEFS_MPI) $(DEFS_CDF) $(DEFS)
LIBS= $(SCALAPACK) $(LAPACK) $(BLAS) $(NETCDF_LIBS) $(METIS)

#
.F.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS)  $(DEFS) $&lt;
.f.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS)   $&lt;
.F90.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS)  $(DEFS) $&lt;
.f90.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS)   $&lt;
#
</pre>
<h2><span class="mw-headline" id="Doc">Doc</span></h2>
<p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://dft-blog.natanzon.eu/2007/02/compiling-siesta-in-parallel-with.html">http://dft-blog.natanzon.eu/2007/02/compiling-siesta-in-parallel-with.html</a>
</p>
<h2><span class="mw-headline" id="v3">v3</span></h2>
<p>Version ou j'ai recompilé les librairies BLAS, LAPACK, SCALAPACK en local sur bolo09.
</p><p>Fichier arch.make dans le répertoire   /home/tmssoft/siesta-4.0b-485/Obj sur blo09
</p>
<pre>
SIESTA_ARCH=westmere-openmpi
#
#
FC=mpif90
#
FC_ASIS=$(FC)
#
FFLAGS=-O2
FFLAGS_DEBUG= -g -Wall -Wextra -O0 -g -fbacktrace -fbounds-check
LDFLAGS=
RANLIB=echo
LIBS=  
SYS=nag
DUMMY_FOX=--disable-dummy
#
# --- Edit the location of your netcdf files
#
#NETCDF_ROOT=$(HOME)/lib/netcdf-3.6.2-gfortran
#INCFLAGS=-I$(NETCDF_ROOT)/include
#DEFS_CDF=-DCDF
#
DEFS=-DGFORTRAN  -DFC_HAVE_FLUSH -DFC_HAVE_ABORT -DDEBUG    # Note this&#160;!!
COMP_LIBS=
#
#NETCDF_LIBS= -L$(NETCDF_ROOT)/lib -lnetcdf
#
MPI_INTERFACE=libmpi_f90.a
MPI_INCLUDE=.      # Note . for no-op
DEFS_MPI=-DMPI
#
# Specify full paths to avoid picking up the veclib versions..
#
METIS=
LIBPATH=/home/tmssoft/include

BLAS_LIBS=-L$(LIBPATH) -lblas
LAPACK_LIBS=-L$(LIBPATH) -llapack
BLACS_LIBS=-L$(LIBPATH) -lblacsF77 -lblacsC -lblacs
SCALAPACK_LIBS=-L$(LIBPATH) -lscalapack


DEFS:=$(DEFS_MPI) $(DEFS_CDF) $(DEFS)
LIBS=$(SCALAPACK_LIBS) $(LAPACK_LIBS) $(BLAS_LIBS) $(NETCDF_LIBS) $(METIS)

#
.F.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS)  $(DEFS) $&lt;
.f.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS)   $&lt;
.F90.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS)  $(DEFS) $&lt;
.f90.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS)   $&lt;
#

</pre>
<p><br />
Ensuite&#160;:
</p>
<pre>make -j4 siesta
</pre>
<h2><span class="mw-headline" id="SCALAPACK_.2B_MPICH_.2B_gnu_5.2.0">SCALAPACK + MPICH + gnu 5.2.0</span></h2>
<p><a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://www.pa.msu.edu/people/tomanek/SIESTA-installation.html">http://www.pa.msu.edu/people/tomanek/SIESTA-installation.html</a>
</p>
<pre>
wget http://www.netlib.org/scalapack/scalapack-2.0.2.tgz

wget http://www.mpich.org/static/downloads/3.2/mpich-3.2.tar.gz

wget http://www.netlib.org/blacs/mpiblacs.tgz
wget http://www.netlib.org/blacs/mpiblacs-patch03.tgz

</pre>
<p><br />
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
module load compiler/gnu-5.2.0/std
tar -zxf mpich-3.2.tar.gz
cd mpich-3.2
mkdir -p /auto/soft/mpich/3.2-gnu-5.2.0/std
unset F90
./configure --prefix=/auto/soft/mpich/3.2-gnu-5.2.0/std --enable-fast=O3,ndebug --disable-error-checking --without-timing --without-mpit-pvars --enable-f77 --enable-f90 2&gt;&amp;1 | tee c.txt

make -j4 2&gt;&amp;1 | tee m.txt 
make install 2&gt;&amp;1 | tee mi.txt
cp c.txt m.txt mi.txt  /auto/soft/mpich/3.2-gnu-5.2.0/std/
</pre>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
module load compiler/gnu-5.2.0/std
tar -zxf scalapack-2.0.2.tgz
cd scalapack-2.0.2
mkdir -p /auto/soft/scalapack/2.0.2-gnu-5.2.0/std
module load blas/3.6.0-gnu-5.2.0/std
module load lapack/3.6.0-gnu-5.2.0/std
module load mpich/3.2-gnu-5.2.0/std

cat SLmake.inc
...
BLASLIB       = -L/auto/soft/blas/3.6.0-gnu-5.2.0/std/ -lblas
LAPACKLIB     = -L/auto/soft/lapack/3.6.0-gnu-5.2.0/std/ -llapack
LIBS          = $(LAPACKLIB) $(BLASLIB)

make -j4 2&gt;&amp;1 | tee m.txt 
cp libscalapack.a m.txt /auto/soft/scalapack/2.0.2-gnu-5.2.0/std/
</pre>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
module load compiler/gnu-5.2.0/std blas/3.6.0-gnu-5.2.0/std lapack/3.6.0-gnu-5.2.0/std mpich/3.2-gnu-5.2.0/std 
tar -zxf mpiblacs.tgz
tar -zxf mpiblacs-patch03.tgz
cd BLACS
cat &gt; Bmake.inc &lt;&lt; EOF
   SHELL = /bin/sh
   BTOPdir = $(HOME)/BLACS
   COMMLIB = MPI
   PLAT = LINUX
   BLACSdir    = $(BTOPdir)/LIB
   BLACSDBGLVL = 0
   BLACSFINIT  = $(BLACSdir)/blacsF77init_$(COMMLIB)-$(PLAT)-$(BLACSDBGLVL).a
   BLACSCINIT  = $(BLACSdir)/blacsCinit_$(COMMLIB)-$(PLAT)-$(BLACSDBGLVL).a
   BLACSLIB    = $(BLACSdir)/blacs_$(COMMLIB)-$(PLAT)-$(BLACSDBGLVL).a
   MPIdir = /auto/soft/mpich/3.2-gnu-5.2.0/std/
   MPILIBdir = $(MPIdir)/lib/
   MPIINCdir = $(MPIdir)/include
   MPILIB = $(MPILIBdir)/libmpi.a
   BTLIBS = $(BLACSFINIT) $(BLACSLIB) $(BLACSFINIT) $(MPILIB) 
   INSTdir = $(BTOPdir)/INSTALL/EXE
   TESTdir = $(BTOPdir)/TESTING/EXE
   FTESTexe = $(TESTdir)/xFbtest_$(COMMLIB)-$(PLAT)-$(BLACSDBGLVL)
   CTESTexe = $(TESTdir)/xCbtest_$(COMMLIB)-$(PLAT)-$(BLACSDBGLVL)
 
   SYSINC = -I$(MPIINCdir)
   INTFACE = -Df77IsF2C
   SENDIS =
   BUFF = 
  TRANSCOMM = -DCSameF77
   WHATMPI =
   SYSERRORS =
   DEBUGLVL = -DBlacsDebugLvl=$(BLACSDBGLVL)
   DEFS1 = -DSYSINC $(SYSINC) $(INTFACE) $(DEFBSTOP) $(DEFCOMBTOP) $(DEBUGLVL)
   BLACSDEFS = $(DEFS1) $(SENDIS) $(BUFF) $(TRANSCOMM) $(WHATMPI) $(SYSERRORS)
 
   F77            = mpif77
   F77NO_OPTFLAGS = -O0
   F77FLAGS       = $(F77NO_OPTFLAGS) -O
   F77LOADER      = $(F77)
   F77LOADFLAGS   = 
   CC             = mpicc
   CCFLAGS        = -O3
   CCLOADER       = $(CC)
   CCLOADFLAGS    = 
   ARCH      = ar
   ARCHFLAGS = r
   RANLIB    = ranlib
EOF
make mpi
</pre>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
tar -zxf siesta-4.0b-485.tgz
cd siesta-4.0b-485/Obj
../Src/obj_setup.sh

cat &gt; arch.make &lt;&lt; EOF
# 
# This file is part of the SIESTA package.
#
# Copyright (c) Fundacion General Universidad Autonoma de Madrid:
# E.Artacho, J.Gale, A.Garcia, J.Junquera, P.Ordejon, D.Sanchez-Portal
# and J.M.Soler, 1996- .
# 
# Use of this software constitutes agreement with the full conditions
# given in the SIESTA license, as signed by all legitimate users.
#
.SUFFIXES:
.SUFFIXES: .f .F .o .a .f90 .F90

SIESTA_ARCH=x86_64-unknown-linux-gnu--Gfortran

FPP=
FPP_OUTPUT= 
FC=mpif90
RANLIB=ranlib

SYS=nag

SP_KIND=4
DP_KIND=8
KINDS=$(SP_KIND) $(DP_KIND)

FFLAGS=-g -O2
FPPFLAGS= -DFC_HAVE_FLUSH -DFC_HAVE_ABORT
LDFLAGS=

ARFLAGS_EXTRA=

FCFLAGS_fixed_f=
FCFLAGS_free_f90=
FPPFLAGS_fixed_F=
FPPFLAGS_free_F90=

BLAS_LIBS=/auto/soft/blas/3.6.0-gnu-5.2.0/std/libblas.a
LAPACK_LIBS=/auto/soft/lapack/3.6.0-gnu-5.2.0/std/liblapack.a
BLACS_LIBS=
SCALAPACK_LIBS=/auto/soft/scalapack/2.0.2-gnu-5.2.0/std/libscalapack.a

COMP_LIBS=

DUMMY_FOX = --enable-dummy

NETCDF_LIBS=
NETCDF_INTERFACE=


MPI_LIBS = -L/auto/soft/mpich/3.2-gnu-5.2.0/std/lib -lmpi

MPI_INTERFACE = libmpi_f90.a
MPI_INCLUDE   =/auto/soft/mpich/3.2-gnu-5.2.0/std/include

INCFLAGS = $(NETCDF_INCFLAGS) $(MPI_INCLUDE) $(MKL_INCLUDE)
FPPFLAGS_MPI = -I/home/tmssoft/siesta-4.0b-485/Obj/MPI
FPPFLAGS = $(FPPFLAGS_CDF) $(FPPFLAGS_MPI)

LIBS=$(SCALAPACK_LIBS) $(BLACS_LIBS) $(LAPACK_LIBS) $(BLAS_LIBS) $(NETCDF_LIBS) $(MPI_LIBS)

#Dependency rules are created by autoconf according to whether
#discrete preprocessing is necessary or not.
.F.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS) $(FPPFLAGS) $(FPPFLAGS_fixed_F)  $&lt; 
.F90.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS) $(FPPFLAGS) $(FPPFLAGS_free_F90) $&lt; 
.f.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS) $(FCFLAGS_fixed_f)  $&lt;
.f90.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS) $(FCFLAGS_free_f90)  $&lt;
EOF
</pre>
<pre>
SIESTA_ARCH=westmere-openmpi
#
#
FC=mpif90
#
FC_ASIS=$(FC)
#
FFLAGS=-O2
FFLAGS_DEBUG= -g -Wall -Wextra -O0 -g -fbacktrace -fbounds-check
LDFLAGS=
RANLIB=echo
LIBS=
SYS=nag
DUMMY_FOX=--disable-dummy
#
# --- Edit the location of your netcdf files
#
#NETCDF_ROOT=$(HOME)/lib/netcdf-3.6.2-gfortran
#INCFLAGS=-I$(NETCDF_ROOT)/include
#DEFS_CDF=-DCDF
#
DEFS=-DGFORTRAN  -DFC_HAVE_FLUSH -DFC_HAVE_ABORT -DDEBUG    # Note this&#160;!!
COMP_LIBS=
#
#NETCDF_LIBS= -L$(NETCDF_ROOT)/lib -lnetcdf
#
MPI_INTERFACE=libmpi_f90.a
MPI_INCLUDE=.      # Note . for no-op
DEFS_MPI=-DMPI
#
# Specify full paths to avoid picking up the veclib versions..
#
METIS=
LIBPATH=/home/tmssoft/include

BLAS_LIBS=-L/auto/soft/blas/3.6.0-gnu-5.2.0/std/ -L$(LIBPATH) -lblas
LAPACK_LIBS=-L/auto/soft/lapack/3.6.0-gnu-5.2.0/std/ -L$(LIBPATH) -llapack
BLACS_LIBS=-L$(LIBPATH) -lblacsF77 -lblacsC -lblacs
SCALAPACK_LIBS=-L/auto/soft/scalapack/2.0.2-gnu-5.2.0/std/ -L$(LIBPATH) -lscalapack


DEFS:=$(DEFS_MPI) $(DEFS_CDF) $(DEFS)
LIBS=$(SCALAPACK_LIBS) $(LAPACK_LIBS) $(BLAS_LIBS) $(NETCDF_LIBS) $(METIS)

#
.F.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS)  $(DEFS) $&lt;
.f.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS)   $&lt;
.F90.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS)  $(DEFS) $&lt;
.f90.o:
	 $(FC) -c $(FFLAGS) $(INCFLAGS)   $&lt;
#
</pre>
<p><br />
Fichier arch.make
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 

.SUFFIXES:
.SUFFIXES: .f .F .o .a .f90 .F90

SIESTA_ARCH=x86_64-haswell--Gfortran

FPP=
FPP_OUTPUT= 
FC=mpif90
RANLIB=ranlib

SYS=nag

SP_KIND=4
DP_KIND=8
KINDS=$(SP_KIND) $(DP_KIND)

FFLAGS=-g -O2
FPPFLAGS= -DFC_HAVE_FLUSH -DFC_HAVE_ABORT
LDFLAGS=

ARFLAGS_EXTRA=

FCFLAGS_fixed_f=
FCFLAGS_free_f90=
FPPFLAGS_fixed_F=
FPPFLAGS_free_F90=

BLAS_LIBS=/auto/soft/blas/3.6.0-gnu-5.2.0/std/libblas.a
LAPACK_LIBS=/auto/soft/lapack/3.6.0-gnu-5.2.0/std/liblapack.a
BLACS_LIBS=
SCALAPACK_LIBS=/auto/soft/scalapack/2.0.2-gnu-5.2.0/std/libscalapack.a

COMP_LIBS=

DUMMY_FOX = --enable-dummy

NETCDF_LIBS=
NETCDF_INTERFACE=


MPI_LIBS = -L/auto/soft/mpich/3.2-gnu-5.2.0/std/lib -lmpi

MPI_INTERFACE = libmpi_f90.a
MPI_INCLUDE   =/auto/soft/mpich/3.2-gnu-5.2.0/std/include

INCFLAGS = $(NETCDF_INCFLAGS) $(MPI_INCLUDE) $(MKL_INCLUDE)
FPPFLAGS_MPI = -I/auto/soft/siesta/4.0b-485-gnu-5.2.0-mpich3.2/Obj/MPI -DMPI  -DGFORTRAN  -DFC_HAVE_FLUSH -DFC_HAVE_ABORT -DDEBUG
FPPFLAGS = $(FPPFLAGS_CDF) $(FPPFLAGS_MPI)

LIBS=$(SCALAPACK_LIBS) $(BLACS_LIBS) $(LAPACK_LIBS) $(BLAS_LIBS) $(NETCDF_LIBS) $(MPI_LIBS)

#Dependency rules are created by autoconf according to whether
#discrete preprocessing is necessary or not.
.F.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS) $(FPPFLAGS) $(FPPFLAGS_fixed_F)  $&lt; 
.F90.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS) $(FPPFLAGS) $(FPPFLAGS_free_F90) $&lt; 
.f.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS) $(FCFLAGS_fixed_f)  $&lt;
.f90.o:
	$(FC) -c $(FFLAGS) $(INCFLAGS) $(FCFLAGS_free_f90)  $&lt;

</pre>
<h2><span class="mw-headline" id="Intel_12_MKL">Intel 12  MKL</span></h2>
<ul><li> Connexion au noeud + chargement compilo Intel</li></ul>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
ssh tmssoft@tejo
ssh bolo09
cd
source /opt/intel/composer_xe_2011_sp1/bin/compilervars.sh intel64
source /opt/intel/composer_xe_2011_sp1/mkl/bin/mklvars.sh intel64
</pre>
<ul><li> Compilation openmpi</li></ul>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
tar -jxf openmpi-1.10.2.tar.bz2

cd openmpi-1.10.2

mkdir build

cd build/

CC=icc \ 
CXX=icpc \
CXXFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
CPP='icc -E' \
CXXCPP='icpc -E' \
F9X=ifort \
F77=ifort \
FFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
FC=ifort \
FCFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
../configure --prefix=$HOME/openmpi-1.10.2_intel12 \
--enable-shared --enable-static --with-sge

make all -j 8

make check

make install

export PATH=$HOME/openmpi-1.10.2_intel12/bin:$PATH
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$HOME/openmpi-1.10.2_intel12/lib 
export INCLUDE=$HOME/openmpi-1.10.2_intel12/include\:$INCLUDE

[tmssoft@bolo09 openmpi-1.10.2]$ which mpif90
~/openmpi-1.10.2_intel12/bin/mpif90
[tmssoft@bolo09 openmpi-1.10.2]$ which mpirun
~/openmpi-1.10.2_intel12/bin/mpirun

mpirun -np 18 -machinefile machines.LINUX  -launch-agent ssh -mca plm_rsh_agent  -V -x LD_LIBRARY_PATH -x PATH -x INCLUDE /bin/hostname


</pre>
<ul><li> zlib</li></ul>
<p>zlib is a library for data compression used by HDF5 and netCDF packages bellow.
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
wget http://zlib.net/zlib-1.2.8.tar.gz

tar -xzf zlib-1.2.8.tar.gz

cd zlib-1.2.8/

CC=icc \
CFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
./configure --prefix=$HOME/zlib-1.2.8_intel12

make -j 8

make test

make install

export LD_LIBRARY_PATH=$HOME/zlib-1.2.8_intel12/lib\:$LD_LIBRARY_PATH
export INCLUDE=$HOME/zlib-1.2.8_intel12/include\:$INCLUDE
</pre>
<ul><li> HDF5</li></ul>
<p>HDF5 is a data model, library, and file format for storing and managing data, used by netCDF packages bellow. 
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
wget https://www.hdfgroup.org/ftp/HDF5/releases/hdf5-1.8.16/src/hdf5-1.8.16.tar.gz
cd

tar -xzf hdf5-1.8.16.tar.gz 

cd hdf5-1.8.16

mkdir build

cd build

CC=mpicc \ 
CFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
CXX=mpicxx \
CXXFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
CPP='icc -E' \
CXXCPP='icpc -E' \
F9X=mpif90 \
FC=mpif90 \
FCFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
LDFLAGS="-L$HOME/zlib-1.2.8_intel12/lib -Wl,-rpath=$HOME/zlib-1.2.8_intel12/lib" \
../configure --prefix=$HOME/hdf5-1.8.16_intel12 \
--enable-shared --enable-static --enable-fortran --enable-parallel \
--with-zlib=$HOME/zlib-1.2.8_intel12

make -j 8

make check

make install

export PATH=$HOME/hdf5-1.8.16_intel12/bin\:$PATH
export LD_LIBRARY_PATH=$HOME/hdf5-1.8.16_intel12/lib\:$LD_LIBRARY_PATH
export INCLUDE=$HOME/hdf5-1.8.16_intel12/include\:$INCLUDE
</pre>
<ul><li> Netcdf, voir <a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="https://software.intel.com/en-us/articles/performance-tools-for-software-developers-building-netcdf-with-the-intel-compilers/">https://software.intel.com/en-us/articles/performance-tools-for-software-developers-building-netcdf-with-the-intel-compilers/</a> et <a target="_blank" rel="nofollow noreferrer noopener" class="external free" href="http://dipc.ehu.es/mediawiki/index.php/Intel_compiling_guide">http://dipc.ehu.es/mediawiki/index.php/Intel_compiling_guide</a></li></ul>
<p><br />
</p><p>netCDF is a set of software libraries and self-describing, machine-independent data formats that support the creation, access, and sharing of array-oriented scientific data. 
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
cd

tar -zxf netcdf-4.4.0.tar.gz 

cd netcdf-4.4.0

mkdir build

cd build

CC=mpicc \ 
CFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
CXX=mpicxx \
CXXFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
CPP='icc -E' \
CXXCPP='icpc -E' \
CPPFLAGS="-I$HOME/hdf5-1.8.16_intel12/include -I$HOME/zlib-1.2.8_intel12/include" \
LDFLAGS="-L$HOME/hdf5-1.8.16_intel12/lib -Wl,-rpath=$HOME/hdf5-1.8.16_intel12/lib -L$HOME/zlib-1.2.8_intel12/lib -Wl,-rpath=$HOME/zlib-1.2.8_intel12/lib" \
../configure --prefix=$HOME/netcdf-4.4.0_intel12 \
--enable-shared --enable-static --enable-netcdf-4 --disable-dap

make -j 8

make check

make install

export PATH=$HOME/netcdf-4.4.0_intel12/bin\:$PATH
export LD_LIBRARY_PATH=$HOME/netcdf-4.4.0_intel12/lib\:$LD_LIBRARY_PATH
export INCLUDE=$HOME/netcdf-4.4.0_intel12/include\:$INCLUDE
</pre>
<ul><li> netCDF - Fortran</li></ul>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
cd

wget ftp://ftp.unidata.ucar.edu/pub/netcdf/netcdf-fortran-4.4.4.tar.gz

tar -zxf netcdf-fortran-4.4.4.tar.gz

cd netcdf-fortran-4.4.4

mkdir build

cd build

CC=mpicc CFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
CXX=mpicxx CXXFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
F77=mpif77 FFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
F90=mpif90 FC=mpif90 FCFLAGS='-O3 -xHost -ip -no-prec-div -static-intel' \
CPP='icc -E' CXXCPP='icpc -E' \
CPPFLAGS="-DgFortran -I$HOME/hdf5-1.8.16_intel12/include -I$HOME/zlib-1.2.8_intel12/include -I$HOME/netcdf-4.4.0_intel12/include" \
LIBS="-L$HOME/hdf5-1.8.16_intel12/lib -Wl,-rpath=$HOME/hdf5-1.8.16_intel12/lib -L$HOME/zlib-1.2.8_intel12/lib -Wl,-rpath=$HOME/zlib-1.2.8_intel12/lib -L$HOME/netcdf-4.4.0_intel12/lib -Wl,-rpath=$HOME/netcdf-4.4.0_intel12/lib -lnetcdf -lhdf5hl_fortran -lhdf5_fortran -lhdf5_hl -lhdf5 -lz" \
../configure --prefix=$HOME/netcdf-fortran-4.4.4_intel12 \
--enable-shared --enable-static 

make -j 8

make check

make install

export PATH=$HOME/netcdf-fortran-4.4.4_intel12/bin\:$PATH
export LD_LIBRARY_PATH=$HOME/netcdf-fortran-4.4.4_intel12/lib\:$LD_LIBRARY_PATH
export INCLUDE=$HOME/netcdf-fortran-4.4.4_intel12/include\:$INCLUDE
</pre>
<ul><li> SIESTA</li></ul>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
cd

tar -zxvf siesta-4.0b-485.tgz

cd siesta-4.0b-485/Obj/

sh ../Src/obj_setup.sh

make clean

make # to create a SIESTA executable or

</pre>
<p>Ficher arch.make généré
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
$ cat arch.make 

.SUFFIXES: 
.SUFFIXES: .f .F .o .a .f90 .F90

SIESTA_ARCH = x86_64-unknown-linux

FC = mpif90

FC_SERIAL = ifort

FFLAGS = -O2 -xHost -ip -no-prec-div -static-intel -fpp \
#         -warn unused,truncated_source,uncalled,declarations,usage

RANLIB = ranlib

SYS = nag


# Used only at the linking stage. For example, you might neeed "-static".
LDFLAGS = -shared-intel -static-libgcc

ARFLAGS_EXTRA =
AR = xiar

MKL              = /opt/intel/mkl
INTEL_LIBS       = $(MKL)/lib/intel64/libmkl_intel_lp64.a \
                   $(MKL)/lib/intel64/libmkl_sequential.a \
                   $(MKL)/lib/intel64/libmkl_core.a \
                   $(MKL)/lib/intel64/libmkl_blacs_openmpi_lp64.a \
                   $(MKL)/lib/intel64/libmkl_scalapack_lp64.a
MKL_LIBS         = -Wl,--start-group $(INTEL_LIBS) \
                   -Wl,--end-group -lpthread -lm
MKL_INCLUDE      = -I$(MKL)/include

MPI_LIBS = -L$(HOME)/openmpi-1.10.2_intel12/lib -lmpi

MPI_INTERFACE = libmpi_f90.a
MPI_INCLUDE   = -I$(HOME)/openmpi-1.10.2_intel12/include

DUMMY_FOX = --enable-dummy

NETCDF_ROOT      = $(HOME)/netcdf-fortran-4.4.4_intel12
NETCDF_LIBS      = -L$(NETCDF_ROOT)/lib -lnetcdff
NETCDF_INCFLAGS  = -I$(NETCDF_ROOT)/include

FPPFLAGS_CDF = -DFC_HAVE_FLUSH -DFC_HAVE_ABORT -DCDF
FPPFLAGS_MPI = -DMPI

FPPFLAGS = $(FPPFLAGS_CDF) $(FPPFLAGS_MPI)

INCFLAGS = $(NETCDF_INCFLAGS) $(MPI_INCLUDE) $(MKL_INCLUDE)

LIBS = $(MKL_LIBS) $(NETCDF_LIBS) $(MPI_LIBS) $(COMP_LIBS)

FFLAGS_DEBUG = -O0 -xSSE4.2 -ip -mp1 -fpp
#
atom.o: atom.F
	$(FC) $(FFLAGS_DEBUG) -c $(INCFLAGS) $(FPPFLAGS) $&lt;

.F.o:
	$(FC) $(FFLAGS) -c $(INCFLAGS) $(FPPFLAGS) $(FPPFLAGS_fixed_F) $&lt;
.F90.o:
	$(FC) $(FFLAGS) -c $(INCFLAGS) $(FPPFLAGS) $(FPPFLAGS_free_F90) $&lt;
.f.o:
	$(FC) $(FFLAGS) -c $(INCFLAGS) $(FCFLAGS_fixed_f) $&lt;
.f90.o:
	$(FC) $(FFLAGS) -c $(INCFLAGS) $(FCFLAGS_free_f90) $&lt;
#
</pre>
<h1><span class="mw-headline" id="V.C3.A9rification_des_ex.C3.A9cutables_disponibles">Vérification des exécutables disponibles</span></h1>
<p>Connexion sur tejo sous le compte fpascale.
</p><p><b>/auto/store/fpascale/test_siesta4</b>
</p><p>Tests&#160;:
</p>
<pre>/auto/soft/siesta/4.0b-485-local-gnu-4.4.7/seq/Tests/32_h2o
/auto/soft/siesta/4.0b-485-local-gnu-4.4.7/seq/Tests/si64
/auto/soft/siesta/4.0b-485-local-gnu-4.4.7/seq/Tests/h3po4_3
/auto/soft/siesta/4.0b-485-local-gnu-4.4.7/seq/Tests/nanotube-c-5-0
</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="script_de_soumission">script de soumission</span></h2>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
cat &gt; sge_siesta.sh &lt;&lt; EOF 
#!/bin/bash
#
#$ -S /bin/bash
#$ -cwd
#
#$ -q bolo@bolo02
#$ -pe parallel 12 
##$ -N si64
##$ -N h3po4_3
##$ -N h2o_32
##$ -N nanotube-c-5-0
#$ -N dye
##$ -l h_rt=00:20:00,s_rt=0:18:00
#$ -j y
#$ -o sge.out
#$ -e sge.out
#$ -V

set -x

. /etc/profile.d/z00_lmod.sh
module load openmpi/1.10.2-local-gnu-4.4.7/std
module load siesta/4.0b-485-local-gnu-4.4.7-openmpi-1.10.2/par

if [[ "x$TEMPORARYDIR" == "x" ]]; then
    export TEMPORARYDIR="/home/${USER}/tmp/${JOB_ID}"
    echo "Setting TEMPORARYDIR to $TEMPORARYDIR because it was previously unspecified."
else
    echo "Using TEMPORARYDIR: $TEMPORARYDIR specified from the command line."
fi

# set up function. this isn't called/run here. It's used if the job is canceled via a signal.
cleanup_scratch() {
    echo "Deleting inside signal handler, meaning I probably either hit the walltime, or deleted the job using qdel"

    ##NOTE: IF YOU WANT TO KEEP ANY OF THE FILES FROM $TEMPORARYDIR WHEN THE JOB IS DELETED
    # BY SBATCH OR KILLED BECAUSE OF WALLTIME, USE A COMMAND LIKE THIS:
    # cp -v "$TEMPORARYDIR/${JOB_NAME}"*.mo "$SGE_O_WORKDIR"

    cd "$SGE_O_WORKDIR"
    # rm -rfv "$TEMPORARYDIR"
    echo "---"
    echo "Signal handler ending time:"
    date
    exit 0
}

# Associate the function "cleanup_scratch" with the TERM signal, which is usually how jobs get killed
trap 'cleanup_scratch' TERM


# basic diagnostic output
echo "---"
echo "Beginning-of-job Diagnostic information:"
echo "---"
echo "Sun GrigEngine Queue:"
echo $PE
echo "---"
echo "Cores assigned: $NSLOTS, Nodes assigned:"
cat ${PE_HOSTFILE}
echo "---"
echo "Temporary Directory:"
echo "$TEMPORARYDIR"
echo "---"
echo "Job Source Directory:"
echo "${SGE_O_WORKDIR}"
echo "---"
echo "Current Time:"
date
echo "---"

# create temporary directory
LIST=`cat $PE_HOSTFILE | awk '{printf "%s ", $1}'`
for i in $LIST; do
 echo "Creating Temporary directory at $TEMPORARYDIR"
 #ssh $i mkdir -p $WRK
 ssh $i mkdir -pv $TEMPORARYDIR
done
echo "---"


# copy working data information from ${SGE_O_WORKDIR}/${JOB_NAME}* to $TEMPORARYDIR
echo "Copying working data information from ${SGE_O_WORKDIR}/${JOB_NAME}* to $TEMPORARYDIR"
cp -v "${SGE_O_WORKDIR}/${JOB_NAME}/"* "$TEMPORARYDIR"
for i in `cat ${JOB_NAME}/${JOB_NAME}.pseudos`; do 
 #if [! -f $TEMPORARYDIR/$i.psf]&#160;; then
   cp -v "/auto/soft/siesta/4.0b-485-local-gnu-4.4.7/seq/Tests/Pseudos/$i.psf" "$TEMPORARYDIR/"; 
 #fi
done
echo "---"

# changing directory to $TEMPORARYDIR
echo "Changing directory to temporary dir at $TEMPORARYDIR"
cd $TEMPORARYDIR
echo "---"

# Print environment context
echo "Print environment context"
env
echo "---"


echo "Starting Siesta Run at:"
date

# the actual siesta run starts here
mpirun -np $NSLOTS  siesta &lt; ${JOB_NAME}.fdf &gt; ${JOB_NAME}.out

echo "---"
echo "Siesta Run ended at:"
date
echo "---"

echo "Copying resulting data (${JOB_NAME}*.out) to ${SGE_O_WORKDIR}"
cp -v "$TEMPORARYDIR/${JOB_NAME}.out" "${SGE_O_WORKDIR}"
echo "---"

echo "Changing directory back to submission directory at $SGE_O_WORKDIR"
cd "$SGE_O_WORKDIR"

# delete directory
echo "Deleting directories at end of script"
#rm -rfv "$TEMPORARYDIR"

echo "---"
echo "Job ending time:"
date
echo "---"
EOF
</pre>
<h2><span class="mw-headline" id="cas_de_h3po4_3">cas de h3po4_3</span></h2>
<p>Modification du script de soumission
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
##$ -N dye
#$ -N h3po4_3
</pre>
<ul><li> Calcul sur 12 coeurs&#160;:</li></ul>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
grep -e "(Free)" -e parallel -e "Start of run" -e "End of run" h3po4_3.out 
* Running on   12 nodes in parallel

(Free)E + p*V (eV/cell)                    -1965.2715
(Free)E+ p_basis*V_orbitals  =             -1963.636264
(Free)Eharris+ p_basis*V_orbitals  =       -1963.636264

&gt;&gt; Start of run:  11-APR-2016  10:38:35
&gt;&gt; End of run:  11-APR-2016    10:38:38
</pre>
<p>Calcul sur 2 coeurs&#160;:
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
grep -e "(Free)" -e parallel -e "Start of run" -e "End of run" h3po4_3.out 
* Running on    2 nodes in parallel

(Free)E + p*V (eV/cell)                    -1965.2715
(Free)E+ p_basis*V_orbitals  =             -1963.636264
(Free)Eharris+ p_basis*V_orbitals  =       -1963.636264

&gt;&gt; Start of run:  11-APR-2016  10:44:35
&gt;&gt; End of run:  11-APR-2016    10:44:41
</pre>
<h2><span class="mw-headline" id="cas_nanotube-c-5-0">cas nanotube-c-5-0</span></h2>
<p>Modification du script de soumission
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
##$ -N dye
#$ -N nanotube-c-5-0
</pre>
<p>Inputs&#160;:
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
cat &gt; nanotube-c-5-0/nanotube-c-5-0.fdf  &lt;&lt; EOF
#  C(5,0)

SystemName          c50tube
SystemLabel         nanotube-c-5-0 

NumberOfAtoms       20
NumberOfSpecies     1

%block ChemicalSpeciesLabel
 1  6   C_2
%endblock ChemicalSpeciesLabel

LatticeConstant    25.0 Ang   # Lattice constant alat

%block LatticeVectors               # Lattice vectors, in units of alat
 1.0      0.0000     0.0
-0.50     0.86602540378444   0.00
 0.0      0.0       0.1704      # distance along z ==&gt; dCC=1.42  AA
%endblock LatticeVectors

%block kgrid_Monkhorst_Pack
 1 0 0   0.0
 0 1 0   0.0
 0 0 50   0.5
%endblock kgrid_Monkhorst_Pack

%block PAO.Basis                 # Define Basis set
C_2           3   0.010            # Label, l-shells, ionic net charge
 n=2   0   2                         # n, l, Nzeta
   6.099      4.192
   1.000      1.000
 n=2   1   2                         # n, l, Nzeta
   4.994      3.105
   1.000      1.000
 n=3   2   1                         # n, l, Nzeta
   4.192
   1.000
%endblock PAO.Basis

MeshCutoff           300. Ry         # OK for carbon (see Emilio)
LongOutput   true

# SCF options
MaxSCFIterations      100       # Maximum number of SCF iter
DM.NumberPulay         3            # One Pulay every 5 iter
DM.MixingWeight       0.15          # New DM amount for next SCF cycle
DM.Tolerance          5.d-4         # Tolerance in maximum difference
DM.UseSaveDM          true            # to use continuae..ion files
SolutionMethod        diagon        # OrderN or Diagon
ElectronicTemperature  25 meV       # Temp. for Fermi smearing

MD.NumCGsteps        0



AtomicCoordinatesFormat    Ang  # Format for inates
%block AtomicCoordinatesAndAtomicSpecies
    2.05815253    0.00000005   -0.00514455   1  C          1
    1.66460705    1.21076605    0.71453767   1  C          2
    1.66460711    1.21076647    2.12546263   1  C          3
    2.05815296    0.00000047    2.84514465   1  C          4
    0.63688939    1.95916716   -0.00500262   1  C          5
   -0.63688894    1.95916590    0.71500218   1  C          6
   -0.63688917    1.95916561    2.12499787   1  C          7
    0.63688896    1.95916634    2.84500249   1  C          8
   -1.66460648    1.21076599   -0.00453819   1  C          9
   -2.05815276    0.00000073    0.71514444   1  C         10
   -2.05815258    0.00000022    2.12485528   1  C         11
   -1.66460743    1.21076602    2.84453725   1  C         12
   -1.66460700   -1.21076524   -0.00453762   1  C         13
   -0.63688959   -1.95916680    0.71500261   1  C         14
   -0.63688943   -1.95916713    2.12499762   1  C         15
   -1.66460732   -1.21076587    2.84453747   1  C         16
    0.63688916   -1.95916651   -0.00500246   1  C         17
    1.66460721   -1.21076640    0.71453747   1  C         18
    1.66460716   -1.21076570    2.12546235   1  C         19
    0.63688907   -1.95916543    2.84500187   1  C         20
EOF

cat &gt; nanotube-c-5-0/nanotube-c-5-0.pseudos &lt;&lt; EOF
C_2
EOF
</pre>
<p>Calcul sur 12 coeurs&#160;:
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
grep -e "(Free)" -e parallel -e "Start of run" -e "End of run" nanotube-c-5-0.out 
* Running on   12 nodes in parallel

(Free)E + p*V (eV/cell)                    -3102.7393
(Free)E+ p_basis*V_orbitals  =             -3086.323213
(Free)Eharris+ p_basis*V_orbitals  =       -3086.323203

&gt;&gt; Start of run:  11-APR-2016  10:47:20
&gt;&gt; End of run:    11-APR-2016  10:48:14
</pre>
<p>Calcul sur 2 coeurs&#160;:
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
* Running on    2 nodes in parallel

(Free)E + p*V (eV/cell)                    -3102.7393
(Free)E+ p_basis*V_orbitals  =             -3086.323213
(Free)Eharris+ p_basis*V_orbitals  =       -3086.323203

&gt;&gt; Start of run:  11-APR-2016  10:50:20
&gt;&gt; End of run:    11-APR-2016  10:52:44
</pre>
<h1><span class="mw-headline" id="Erreur_openmpi">Erreur openmpi</span></h1>
<h2><span class="mw-headline" id="ssh_agent">ssh agent</span></h2>
<pre>
+ mpirun -np 6 --mca pls_gridengine_verbose 1 -launch-agent ssh -v siesta

Unknown mac type 'ca'

</pre>
<h1><span class="mw-headline" id="Erreur_Gros_systeme_multi_noeud_Chiara">Erreur Gros systeme multi noeud Chiara</span></h1>
<h2><span class="mw-headline" id="petit_cas_qui_marche:_h3PO4">petit cas qui marche: h3PO4</span></h2>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
[fpascale@lisboa test_siesta]$ pwd
/auto/store/fpascale/test_siesta
</pre>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
[fpascale@lisboa test_siesta]$ cat h3po4_3/h3po4_3.fdf 
SystemName          H3PO4 molecule
SystemLabel         h3po4_3
NumberOfAtoms       8
NumberOfSpecies     3

%block ChemicalSpeciesLabel
 3 15  P      # Species index, atomic number, species label
 2  1  H
 1  8  O
%endblock ChemicalSpeciesLabel


AtomicCoordinatesFormat  Ang
%block AtomicCoordinatesAndAtomicSpecies
0.549093        2.155440        -0.338300  2
0.000046        0.000003        -0.000046  3 
-1.526503       -0.441092       -0.288371  1
-1.720758       -1.263279       0.227476   2
0.635084        -0.274540       1.296081   1
0.844830        -0.588106       -1.248646  1
-0.252131       1.559335        -0.390172  1
0.378031        -0.630812       -2.132000  2
%endblock AtomicCoordinatesAndAtomicSpecies

PAO.BasisType split
%Block PAO.Basis
P    3      0.05192
 n=3   0   2   E     0.00000     0.28668
     4.95334     1.96730
     1.00000     1.00000
 n=4   0   1   E     0.00000     0.29518
     5.01640
     1.00000
 n=3   1   2   E    16.50988     0.30118
     6.79353     2.82182
     1.00000     1.00000
H    2      0.12297
 n=1   0   2   E     6.06330     0.29177
     4.94850     1.95400
     1.00000     1.00000
 n=2   1   1   E    98.08976     0.08782
     5.04168
     1.00000
O    3      0.02995
 n=2   0   2   E     0.00000     0.20804
     5.74313     2.50161
     1.00000     1.00000
 n=2   1   2   E     0.00000     0.00000
     7.61022     2.31283
     1.00000     1.00000
 n=3   2   1   E    28.29197     0.00000
     4.87171
     1.00000
%EndBlock PAO.Basis

DM.MixingWeight 0.3
DM.NumberPulay  7
</pre>
<p>Description du systeme&#160;:
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
siesta: System type = molecule  
initatomlists: Number of atoms, orbitals, and projectors:      8    76   101
redata: Dynamics option                  =     Single-point calculation
Total number of electrons:    32.000000
Total ionic charge:    32.000000
* ProcessorY, Blocksize:    4   3
* Orbital distribution balance (max,min):     6     3
outcell: Cell volume (Ang**3)       &#160;:   1557.4423
InitMesh: MESH =    72 x    72 x    72 =      373248
InitMesh: (bp) =    36 x    36 x    36 =       46656
InitMesh: Mesh cutoff (required, used) =   100.000   102.861 Ry
ExtMesh (bp) on 0 =    88 x    61 x    58 =      311344
New grid distribution:   3
           1      14:   36    1:   21    1:    3
           2      14:   36    1:    5    4:   22
           3       1:   21    1:    7   30:   36
           4       1:   21    1:   17   23:   29
           5      22:   36    1:   17   23:   29
           6       1:   13    1:    5    5:   22
           7       1:   13   22:   36    1:    5
           8      14:   36    6:   21    4:   22
           9       1:   13    6:   21    5:   22
          10       1:   13   32:   36    6:   22
          11      22:   36    8:   17   30:   36
          12       1:   21    8:   17   30:   36
          13       1:   13    1:   21    1:    4
          14      14:   36   22:   31    5:   22
          15      15:   36   31:   36   30:   36
          16       1:   14   18:   36   23:   28
          17      15:   36   18:   36   23:   29
          18       1:   14   30:   36   29:   36
          19      14:   36   22:   36    1:    4
          20      14:   36   32:   36    5:   22
          21       1:   13   22:   31    6:   22
          22      22:   36    1:    7   30:   36
          23       1:   14   18:   29   29:   36
          24      15:   36   18:   30   30:   36
Setting up quadratic distribution...
ExtMesh (bp) on 0 =    78 x    55 x    56 =      240240
PhiOnMesh: Number of (b)points on node 0 =                  312
PhiOnMesh: nlist on node 0 =                 6161
</pre>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
[fpascale@lisboa test_siesta]$ cat sge_siesta.sh 
#!/bin/bash
#
#$ -S /bin/bash
#$ -cwd
#$ -q bolo
#$ -pe mpich2  24
#$ -N h3po4_3
#$ -j y
#$ -o sge.out
#$ -e sge.out
#$ -V
#$ -v MODULEPATH

. /etc/profile.d/z00_lmod.sh
module load siesta/4.0b-485-gnu-5.2.0/std
module load mpich/3.2-gnu-5.2.0/std
module load compiler/gnu-5.2.0/std

export HYDRA_DEBUG=1

export TEMPORARYDIR="/home/${USER}/tmp/${JOB_ID}"

LIST=`cat $PE_HOSTFILE | awk '{printf "%s ", $1}'`
for i in $LIST; do
 echo "Creating Temporary directory at $TEMPORARYDIR on node $i"
 ssh $i mkdir -pv $TEMPORARYDIR
 scp -v "${SGE_O_WORKDIR}/${JOB_NAME}/*" $i:"$TEMPORARYDIR/"
done
echo "---"

cp -v "${SGE_O_WORKDIR}/${JOB_NAME}/"* "$TEMPORARYDIR"
for i in `cat ${JOB_NAME}/${JOB_NAME}.pseudos`; do 
   cp -v "/auto/soft/siesta/4.0b-485-local-gnu-4.4.7/seq/Tests/Pseudos/$i.psf" "$TEMPORARYDIR/" 
done

cd $TEMPORARYDIR

mpirun -np $NSLOTS -launcher ssh -v siesta &lt; ${JOB_NAME}.fdf &gt; ${JOB_NAME}.out

cp -v "$TEMPORARYDIR/${JOB_NAME}.out" "${SGE_O_WORKDIR}"
cd "$SGE_O_WORKDIR"
rm -rfv "$TEMPORARYDIR"

</pre>
<pre>
[fpascale@lisboa test_siesta]$ grep -A10 "Final energy (eV):" h3po4_3.out 
siesta: Final energy (eV):
siesta:  Band Struct. =    -462.214016
siesta:       Kinetic =    1396.909024
siesta:       Hartree =    2836.242398
siesta:    Ext. field =       0.000000
siesta:   Exch.-corr. =    -450.863190
siesta:  Ion-electron =   -6940.912453
siesta:       Ion-ion =    1191.443079
siesta:       Ekinion =       0.000000
siesta:         Total =   -1967.181143

[fpascale@lisboa test_siesta]$ grep -i "in parallel" h3po4_3.out 
* Running on   24 nodes in parallel

[fpascale@lisboa test_siesta]$ grep -i finalize_ack h3po4_3.out |sort -n |uniq -c
     12 [proxy:0:0@bolo12] PMI response: cmd=finalize_ack
     12 [proxy:0:1@bolo10] PMI response: cmd=finalize_ack
</pre>
<h2><span class="mw-headline" id="cas_intermediaire_qui_marche">cas intermediaire qui marche</span></h2>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
siesta: System type = molecule
initatomlists: Number of atoms, orbitals, and projectors:   2202 23488 30094
redata: Dynamics option                  =     Single-point calculation
Total number of electrons: 10276.000000
Total ionic charge: 10276.000000
</pre>
<p><br />
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 


</pre>
<p><br />
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
</pre>
<p><br />
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
$ cat dye.fdf 
SystemName         dye  
SystemLabel        dye
NumberOfAtoms      315 
NumberOfSpecies    7 

%block ChemicalSpeciesLabel
 1  22  Ti 
 2  8   O      # Species index, atomic number, species label
 3  6   C 
 4  1   H 
 5  44  Ru
 6  7   N
 7  15  P
%endblock ChemicalSpeciesLabel

PAO.BasisType  split 

%block    PAO.BasisSizes
               Ti      DZ
               O       DZ
               C       DZ
               H       DZ
               Ru      DZ
               N       DZ
               P      DZ
%endblock PAO.BasisSizes


PAO.EnergyShift 200 meV
 # Default value: 0.02 Ry

PAO.SplitNorm           0.30
 # Default value: 0.15

AtomicCoordinatesFormat NotScaledCartesianAng
%block  AtomicCoordinatesAndAtomicSpecies 
   -6.897078   -3.661485    5.409675    3   
   -6.942345   -2.991370    6.643186    3   
  -7.639222   -3.538180    7.709623     6   
   -8.251528   -4.749809    7.561543    3   
   -8.234573   -5.442841    6.350886    3   
   -7.553880   -4.886731    5.254763    3   
   -6.273363   -1.709366    6.909332    3   
  -6.251144   -1.328792    8.238423     6   
   -5.592733   -0.181532    8.587913    3   
   -5.039109    0.673377    7.634260    3   
   -5.142340    0.340758    6.274413    3   
   -5.726246   -0.881624    5.917469    3   
  -7.774088   -2.285660    9.394269     5   
  -6.656869   -3.608557   10.556545     6   
   -7.384082   -4.505372   11.323070    3   
   -6.729368   -5.454190   12.124026    3   
   -5.331358   -5.495995   12.151397    3   
   -4.604287   -4.589221   11.361967    3   
   -5.291682   -3.664060   10.576213    3   
   -8.840122   -4.356695   11.225930    3   
  -9.262935   -3.333843   10.390953     6   
  -10.601273   -3.081820   10.263889    3   
  -11.558416   -3.852820   10.923195    3   
  -11.142161   -4.912498   11.747645    3   
   -9.773655   -5.155603   11.904197    3   
  -11.872292   -5.528572   12.271806    4   
   -4.816414   -6.225107   12.775980    4   
   -4.776924    1.022158    5.510350    4   
   -7.526516   -5.406254    4.297141    4   
  -7.816730   -0.651205   10.747802     6   
   -8.193535    0.537069   10.147291    3   
   -8.003831    1.765262   10.803207    3   
   -7.417949    1.776009   12.075977    3   
   -7.101360    0.564499   12.709031    3   
   -7.321631   -0.633345   12.020019    3   
   -8.670401    0.418256    8.760274    3   
  -8.926796   -0.867085    8.304943     6   
   -9.358573   -1.041936    7.024261    3   
   -9.366924    0.002970    6.086960    3   
   -8.936914    1.263856    6.504093    3   
   -8.692473    1.492600    7.879634    3   
  -6.812920    3.415650   12.795478     7   
   -6.447358    4.181783   11.339159    2   
  -5.671807    6.038360   11.136495     1   
   -4.266424    5.459419   12.223109    2   
  -3.228098    6.953543   12.558453     1   
   -1.890850    6.721842   11.163248    2   
  -1.325894    6.645410    9.319922     1   
   -0.870290    8.592177    9.376499    2   
  -2.346619    9.506434    8.326228     1   
   -1.311274   10.988071    8.656796    2   
  -0.009330   10.259830    9.813119     1   
    1.762320   10.356026   10.564544    2   
   2.896522    9.562228    9.381337     1   
    2.451949    7.692133    9.285195    2   
   4.092819    7.052442   10.417368     1   
    3.705427    6.920798   12.244510    2   
   2.249311    6.818702   13.381095     1   
    0.803365    7.736118   12.592460    2   
  -0.171494    6.233187   12.167019     1   
    1.223434    5.309864   12.995346    2   
  -8.335485    2.817517    5.612666     7   
   -8.217846    3.187519    3.978607    2   
  -7.338895    5.088430    3.483284     1   
   -6.249610    4.650410    2.047257    2   
  -5.296949    4.754521    0.511813     1   
   -4.603552    4.614639   -1.602582    2   
  -3.059062    4.412017   -2.566795     1   
   -3.464453    3.980200   -4.355352    2   
  -5.006846    4.648028   -5.088591     1   
   -5.824187    5.365610   -6.644184    2   
  -5.950804    7.147728   -6.125074     1   
   -4.605036    8.390936   -6.495990    2   
  -3.467506    8.085487   -5.024694     1   
   -4.597719    6.528783   -4.775942    2   
   -6.767086    2.657369    6.214404    2   
   -9.518516    3.785565    6.349442    2   
  -9.141016    5.701022    6.755002     1   
   -8.447579    5.774706    4.994130    2   
 -10.020589    6.349721    3.802851     1   
   -8.912660    5.547958    2.570896    2   
   -8.081113    4.302633   13.571911    2   
  -7.829117    6.124976   14.185928     1   
   -9.263030    6.041116   15.465731    2   
 -10.554999    6.965072   14.581801     1   
   -9.447191    7.001222   13.112078    2   
  -8.668446    6.979517   11.279866     1   
   -8.344103    8.911376   11.249446    2   
  -7.387898   10.397906   11.769336     1   
   -8.286902   10.378633   13.542375    2   
  -6.704880    9.905902   14.779610     1   
   -5.731610   11.504376   15.183258    2   
  -4.217644   10.804822   15.917283     1   
  -2.263674   10.437135   18.425977     1   
   -2.465204    8.541352   18.007869    2   
  -3.368367    6.822939   18.158849     1   
   -5.039440    6.997996   17.436193    2   
  -5.284909    7.217347   15.578815     1   
   -6.117402    5.526604   15.036694    2   
   -5.706185    3.114105   13.974795    2   
   -6.975257    7.851672   14.841154    2   
   -7.118061    6.511531   12.433267    2   
   -5.075876    9.149498   15.744918    2   
   -3.690498    7.011216   14.601653    2   
  -1.717006    6.564651   15.326058     1   
   -1.044909    8.334879   15.513084    2   
   0.796551    7.719699   16.311481     1   
    1.020848    9.574210   16.189170    2   
  -0.597715   10.236280   15.581700     1   
   -0.400787   10.985081   13.955356    2   
  -1.941035   10.600847   12.878935     1   
   -2.830277    8.905260   12.638686    2   
  -4.390338    9.731061   11.596944     1   
   -3.724380    9.724776    9.727579    2   
  -5.366860   10.061844    8.625064     1   
   -3.987212   10.051197    7.236344    2   
  -3.475154    9.613236    5.402240     1   
   -2.083347    9.595191    3.978330    2   
  -0.472311    9.040285    5.066468     1   
    0.585980   10.555810    5.437688    2   
   1.900392    9.794138    6.451985     1   
    3.371046    9.733126    5.079822    2   
   3.895794    9.271094    3.314670     1   
    2.650016   10.084132    2.262765    2   
   1.490136    8.619534    1.899051     1   
    2.152451    8.382648    0.080274    2   
   3.179750    8.586310   -1.425886     1   
    4.905387    9.152234   -0.953687    2   
   6.003654    8.364261    0.308326     1   
    7.568204    8.613213    1.307213    2   
   6.918568    8.399658    3.074315     1   
    8.409258    7.734381    3.987208    2   
   7.793269    6.087133    4.621863     1   
    7.277903    4.411482    3.994769    2   
   5.704896    4.783718    3.053087     1   
    6.131694    4.019442    1.385315    2   
   5.030707    4.976133    0.252918     1   
    4.125245    5.511623    1.774397    2   
   2.617169    5.723607    3.032024     1   
    1.644516    4.257435    2.413194    2   
   0.244033    5.109942    1.530659     1   
    1.094677    5.089777   -0.264237    2   
  -0.572308    5.325023   -1.495245     1   
   -0.317990    7.349179   -1.537326    2   
  -2.000983    8.074867   -2.500792     1   
   -1.105051    9.662194   -2.066221    2   
   0.325263    9.063034   -1.086746     1   
    1.808768    9.547732   -2.168560    2   
   -2.654310   10.649647   14.980680    2   
   -3.847626   11.064410   17.743388    2   
   -0.938990   10.634059   11.353255    2   
   -3.551163   11.282554   12.214025    2   
    1.303458   10.069734    8.185636    2   
    3.700587    9.767370    7.528110    2   
   4.904387    9.072979    6.222231     1   
    6.312311    8.505780    7.198389    2   
   5.949025    6.614511    7.479760     1   
    5.538772    6.634988    9.242686    2   
    4.356736    8.932184   10.308702    2   
    5.733347    9.243816    4.356769    2   
    4.387677    7.236810    6.197310    2   
   3.645235    5.486118    5.987143     1   
    2.220259    5.485517    7.231820    2   
   1.710061    5.982772    9.050303     1   
    0.293770    5.888732   10.324949    2   
    6.281137    6.602766    3.399303    2   
    5.197906    8.752465    1.943039    2   
    4.203113    4.835012    4.200457    2   
    5.070540    4.968037    6.977884    2   
   0.599380    6.183518    6.131200     1   
    2.030778    5.861528    4.815141    2   
    7.456502    6.175187    6.357134    2   
   -8.264934    7.422556    7.228413    2   
  -6.724028    6.518859    8.189063     1   
   -5.082843    5.872132    9.271040    2   
  -3.706840    5.921519    7.898184     1   
   -3.151234    5.448377    6.045410    2   
  -1.779739    5.450485    4.680258     1   
   -0.876106    7.056416    5.009721    2   
 -12.057540    6.817358    6.906862     1   
  -13.431634    7.454477    5.909591    2   
 -12.995377    9.328297    5.675530     1   
  -12.560581    9.331719    3.907284    2   
 -11.131525    8.881252    2.742323     1   
  -10.105461   10.497221    3.192624    2   
  -8.748568    9.841287    4.190037     1   
   -7.154579    9.132907    5.316700    2   
  -5.837960    8.790198    3.950121     1   
   -6.211748    6.806929    3.871046    2   
  -4.799210    6.054018    4.963263     1   
   -3.421784    5.689219    3.571291    2   
  -2.792600    5.547328    1.713817     1   
   -1.156522    5.018811    2.836093    2   
   -7.752944    5.029516    7.814116    2   
  -10.629511    5.992767    8.064368    2   
 -11.131274    6.463740    9.834892     1   
  -10.201156    8.004288   10.114679    2   
  -9.756392    9.947222   10.204146     1   
  -11.261320   10.968285    9.029212    2   
 -10.690198   10.343365    7.240196     1   
  -12.060280   10.935880    6.210837    2   
  -10.867070    6.172286    5.593465    2   
  -7.734885    9.341635    7.131627     1   
   -6.703345   10.851217    7.641616    2   
   -9.148537    9.795121    8.423931    2   
   -6.246417    8.473497    8.230743    2   
   -9.243287   10.278300    6.011806    2   
  -11.275403   10.209288   11.441055    2   
 -12.781267   11.046119   10.152543     1   
  -13.215869   11.782680   11.830421    2   
 -12.190580   10.741616   12.959265     1   
  -13.111395    9.166577   13.276252    2   
 -13.306051    7.403428   12.801395     1   
  -14.847927    7.247122   11.751494    2   
 -14.123183    7.479110   10.012003     1   
  -15.567566    8.219375    9.072429    2   
 -14.871050    9.855166    8.500423     1   
  -14.322044   11.495421    9.187573    2   
   -8.717523   11.349550   10.877607    2   
  -11.027191   11.349089   14.255615    2   
  -9.575196   10.331481   14.897874     1   
   -8.145732   10.269159   16.028521    2   
  -10.472707    8.738963   15.044273    2   
  -12.315840    6.516803   14.082816    2   
  -12.458284    6.999339   11.191052    2   
  -12.958796    6.624352    8.742972    2   
  -13.414676    9.257624    9.749810    2   
  -11.512079    8.639583    6.997111    2   
  -14.508822    9.811654    6.766315    2   
   -5.841107    4.475489    4.784444    2   
   -4.284979    7.974449    5.018315    2   
   -5.357752    6.258010    6.822261    2   
   -4.816195   10.339609    4.408586    2   
   -1.775430    9.276195    6.434442    2   
   -5.226122    8.692957    2.107961    2   
  -6.869480    9.351061    1.085559     1   
   -7.942552    7.931512    0.640961    2   
  -9.261313    8.951142   -0.220369     1   
   -8.130210   10.378216    0.176635    2   
   -7.320525    9.732810    2.912171    2   
  -3.915845    8.379182    0.752026     1   
   -4.345905    6.424059    0.760155    2   
   -2.337159    7.547888    1.776476    2   
  -1.547455    9.195458    2.159519     1   
   -0.086157    9.292007    0.780141    2   
   -2.873075    9.919628    1.143224    2   
   -5.466685    9.218944   -0.268245    2   
  -5.157308    8.691958   -2.038584     1   
   -3.823014    8.904434   -3.441686    2   
   -3.352603    8.181070   -1.136826    2   
    0.159017    8.907624    3.207064    2   
   -7.325568    6.656181   10.015996    2   
   -2.823723    7.519874    8.254133    2   
   -2.335342    5.121064    8.823702    2   
    1.093693    8.147812    6.054258    2   
    2.985096    7.697244    3.069111    2   
    1.109877    6.675337    1.997298    2   
    3.103012    6.836308   -1.982357    2   
   2.331371    5.189449   -1.667288     1   
    0.875984    4.984833   -2.745080    2   
    3.864092    4.312222   -1.008294    2   
    5.861043    6.587258   -0.126459    2   
   -9.893715    5.568906   10.820729    2   
   -9.568680    8.194191    3.909369    2   
  -11.440807    7.009137    2.819216    2   
  -7.739227    7.782965   -3.103646     1   
   -7.274928    7.622873   -5.028967    2   
   -6.588526    9.335308   -2.944168    2   
   -6.005367    7.017722   -2.190943    2   
  -6.615641    5.166691   -2.219150     1   
   -6.220976    4.245423   -3.867727    2   
   -2.194914    6.068340   -2.486655    2   
   -1.776184    7.836373   -4.463198    2   
   -1.296501    5.409745    0.350458    2   
   -1.541922    3.723014   -1.820568    2   
   -5.979048   10.402275   10.478634    2   
   -5.911643    9.876733   12.955641    2   
   -4.754614    7.767488   11.511967    2   
  -10.725646    8.995368    0.893865    2   
   -9.078870    8.484162   -2.021161    2   
   -8.147481    5.967879   -2.890179    2   
   -3.667607    4.025581    1.137367    2   
   -6.872806    4.526052   -0.558659    2   
   -0.404250    4.674047    5.636319    2   
    0.031292    6.391188    7.925457    2   
    3.143642    5.400506    9.982042    2   
   -1.571259    6.155662   13.504505    2   
   -1.073437   11.039326   17.264408    2   
   -1.378316    9.746794   19.953019    2   
  -1.069464    8.015384   19.353555     1   
    0.293676    7.700523   18.232746    2   
   -2.311499    6.681518   19.724958    2   
   -2.601454    5.886580   16.869428    2   
   -0.083599    6.064139   15.943167    2   
    2.214190    7.246308   15.176649    2   
   -8.426342    2.495801    8.215863    4   
   -7.066931   -1.598823   12.451471    4   
   -6.638588    0.565196   13.697931    4   
   -8.241690    2.713275   10.317733    4   
   -9.630301   -2.057436    6.740193    4   
   -9.655248   -0.193441    5.053585    4   
   -5.796410   -1.156457    4.866553    4   
   -4.580627    1.607787    7.952515    4   
   -5.557965    0.058209    9.648945    4   
   -6.340763   -3.234594    4.577672    4   
   -8.743983   -6.402478    6.270729    4   
   -8.774162   -5.135184    8.434738    4   
   -6.049029    3.680740    5.457546    4   
   -5.762340    4.565899   14.821975    4   
   -4.778480   -2.945419    9.941750    4   
   -3.514985   -4.597488   11.353445    4   
   -7.302237   -6.153962   12.729098    4   
   -9.439530   -5.960433   12.556041    4   
  -12.615896   -3.623243   10.794074    4   
  -10.864558   -2.243891    9.622339    4   
%endblock AtomicCoordinatesAndAtomicSpecies

# DFT, Grid, SCF

XC.functional           GGA         # Exchange-correlation functional type
XC.authors              PBE          # Particular parametrization of xc func
SpinPolarized           .false.     # Spin unpolarized calculation
MeshCutoff              100. Ry     # Equivalent planewave cutoff for the grid #default 100 Ry
MaxSCFIterations        100         # Maximum number of SCF iterations per step
DM.MixingWeight         0.10        # New DM amount for next SCF cycle
DM.Tolerance            1.d-4       # Tolerance in maximum difference
                                    # between input and output DM
DM.NumberPulay          3           # Number of SCF steps between pulay mixing

# Eigenvalue problem: order-N or diagonalization

SolutionMethod          Diagon      # OrderN per Natom &gt; 100 or Diagon per Natom &lt; 100
ElectronicTemperature   0.1  K        # Temp. for Fermi smearing

# Molecular dynamics and relaxations

MD.TypeOfRun CG #coordinate optimization by conjugated gradient
MOBD.MaxForce.Tol 0.03 eV/Ang  #default 0.04 eV/Ang
MD.NumCGsteps 250 #default 0

# Occupation of electronic states
OccupationFunction  FD  # Default: usual Fermi-Dirac occupation
# Output options

kgrid_ cutoff 0.0 Bohor #default value: only gamma point

WriteCoorInitial     
WriteCoorStep       
WriteForces         
WriteKpoints            .false.
WriteEigenvalues        .true.
WriteKbands             .true.
WriteBands              .true.
WriteMullikenPop        1            # Write Mulliken Population Analysis
WriteCoorXmol           .true.
WriteMDCoorXmol         .false.
WriteMDhistory          .true.
WriteCoorXmol           .true.

</pre>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
siesta: System type = molecule
initatomlists: Number of atoms, orbitals, and projectors:    315  2708  3296
redata: Dynamics option                  =     CG coord. optimization
Total number of electrons:  1540.000000
Total ionic charge:  1540.000000
* ProcessorY, Blocksize:    4  16
* Orbital distribution balance (max,min):    32    16
outcell: Cell volume (Ang**3)       &#160;:  32588.0724
InitMesh: MESH =   216 x   160 x   240 =     8294400
InitMesh: (bp) =   108 x    80 x   120 =     1036800
InitMesh: Mesh cutoff (required, used) =   100.000   101.401 Ry
ExtMesh (bp) on 0 =   160 x    72 x    55 =      633600
New grid distribution:   3
           1      21:   74    1:   15    1:   11
           2      23:   74    1:   17   18:   22
           3      21:   36   16:   24    8:   17
           4       1:   20    1:   12    9:   17
           5       1:   59    1:   17   36:   42
           6      21:   74    1:   15   12:   17
           7      23:   74   18:   24   18:   23
           8       1:   20   13:   24    1:    6
           9      23:   64    1:   17   23:   35
          10      83:   94    1:   13   46:   67
          11      65:   74    1:   17   23:   35
          12       1:   24   25:   30    1:   10
          13       1:   14    1:   16  112:  120
          14      83:   94   14:   25   36:   45
          15       1:   59    1:   17   43:   53
...
         165      19:   82   26:   32   49:   59
         166      75:   81   39:   80   13:   20
         167     102:  108   17:   25   98:  120
         168     101:  108   14:   27    7:   17
Setting up quadratic distribution...
ExtMesh (bp) on 0 =   117 x    70 x    62 =      507780
kvsname=kvs_48362_0 key=P59-businesscard PhiOnMesh: Number of (b)points on node 0 =                11700
PhiOnMesh: nlist on node 0 =                34579

</pre>
<p>Output du calcul
</p>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 
$ grep -e "siesta: E_KS" -e "move =" -e "converg" -e "DM_out - DM_in" dye.out  -i

                        Begin CG opt. move =      0
SCF Convergence by dMax criterion
max |DM_out - DM_in|:     0.00009582
SCF cycle converged after   35 iterations
siesta: E_KS(eV) =           -93426.2258
siesta: E_KS - E_eggbox =    -93426.2258
                        Begin CG opt. move =      1
SCF Convergence by dMax criterion
max |DM_out - DM_in|:     0.00006625
SCF cycle converged after   12 iterations
siesta: E_KS(eV) =           -93432.9233
                        Begin CG opt. move =      2
SCF Convergence by dMax criterion
max |DM_out - DM_in|:     0.00006630
SCF cycle converged after   13 iterations
siesta: E_KS(eV) =           -93442.2468
                        Begin CG opt. move =      3
SCF Convergence by dMax criterion
max |DM_out - DM_in|:     0.00007337
SCF cycle converged after   13 iterations
siesta: E_KS(eV) =           -93450.3353
                        Begin CG opt. move =      4
</pre>
<h2><span class="mw-headline" id="gros_cas_qui_ne_marche_pas">gros cas qui ne marche pas</span></h2>
<pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;"> 

+ mpirun -np 24 -launcher ssh -v siesta
[proxy:0:0@bolo06] HYD_pmcd_pmip_control_cmd_cb (pm/pmiserv/pmip_cb.c:937): process reading stdin too slowly; can't keep up
[proxy:0:0@bolo06] HYDT_dmxu_poll_wait_for_event (tools/demux/demux_poll.c:76): callback returned error status
[proxy:0:0@bolo06] main (pm/pmiserv/pmip.c:206): demux engine error waiting for event
[mpiexec@bolo06] control_cb (pm/pmiserv/pmiserv_cb.c:200): assert (!closed) failed
[mpiexec@bolo06] HYDT_dmxu_poll_wait_for_event (tools/demux/demux_poll.c:76): callback returned error status
[mpiexec@bolo06] HYD_pmci_wait_for_completion (pm/pmiserv/pmiserv_pmci.c:198): error waiting for event
[mpiexec@bolo06] main (ui/mpich/mpiexec.c:344): process manager error waiting for completion

</pre>




</body></html>